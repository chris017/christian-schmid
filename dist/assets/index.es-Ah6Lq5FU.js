import{i as Zv,e as Xv,f as ew,h as tw,j as rw,k as iw,m as nw,o as sw,p as aw,q as ow,s as Ra,r as Ca,t as $a,u as Da,v as cw,w as ns,x as ne,y as Qr,z as uw,A as Pf,B as Ua,C as Of,H as hw,D as ja,E as Nf,F as Tf,G as La,I as lw,J as da,K as fw,L as Jc,M as dw,_ as pw}from"./index-vBIxONE0.js";import{s as ss,a as qa,d as gw,i as fl,c as mw,b as yw,f as Yc,p as vw,J as li,e as Zc,g as Xc,h as eu,j as Si,k as hi,l as es,m as ww,n as bw,H as Oi}from"./http-iO_t8qmT.js";function tu(s){return globalThis.Buffer!=null?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):s}function Af(s=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?tu(globalThis.Buffer.allocUnsafe(s)):new Uint8Array(s)}function jc(s,t){t||(t=s.reduce((o,l)=>o+l.length,0));const r=Af(t);let n=0;for(const o of s)r.set(o,n),n+=o.length;return tu(r)}const dl={...Zv,...Xv,...ew,...tw,...rw,...iw,...nw,...sw,...aw,...ow};function Rf(s,t,r,n){return{name:s,prefix:t,encoder:{name:s,prefix:t,encode:r},decoder:{decode:n}}}const pl=Rf("utf8","u",s=>"u"+new TextDecoder("utf8").decode(s),s=>new TextEncoder().encode(s.substring(1))),gc=Rf("ascii","a",s=>{let t="a";for(let r=0;r<s.length;r++)t+=String.fromCharCode(s[r]);return t},s=>{s=s.substring(1);const t=Af(s.length);for(let r=0;r<s.length;r++)t[r]=s.charCodeAt(r);return t}),Cf={utf8:pl,"utf-8":pl,hex:dl.base16,latin1:gc,ascii:gc,binary:gc,...dl};function nr(s,t="utf8"){const r=Cf[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?tu(globalThis.Buffer.from(s,"utf-8")):r.decoder.decode(`${r.prefix}${s}`)}function Jt(s,t="utf8"){const r=Cf[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(s.buffer,s.byteOffset,s.byteLength).toString("utf8"):r.encoder.encode(s).substring(1)}const _w={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe"}};var Ew={};(function(s){const t=$a,r=Da,n=Ra,o=Ca,l=u=>u==null,y=Symbol("encodeFragmentIdentifier");function b(u){switch(u.arrayFormat){case"index":return d=>(m,g)=>{const p=m.length;return g===void 0||u.skipNull&&g===null||u.skipEmptyString&&g===""?m:g===null?[...m,[E(d,u),"[",p,"]"].join("")]:[...m,[E(d,u),"[",E(p,u),"]=",E(g,u)].join("")]};case"bracket":return d=>(m,g)=>g===void 0||u.skipNull&&g===null||u.skipEmptyString&&g===""?m:g===null?[...m,[E(d,u),"[]"].join("")]:[...m,[E(d,u),"[]=",E(g,u)].join("")];case"colon-list-separator":return d=>(m,g)=>g===void 0||u.skipNull&&g===null||u.skipEmptyString&&g===""?m:g===null?[...m,[E(d,u),":list="].join("")]:[...m,[E(d,u),":list=",E(g,u)].join("")];case"comma":case"separator":case"bracket-separator":{const d=u.arrayFormat==="bracket-separator"?"[]=":"=";return m=>(g,p)=>p===void 0||u.skipNull&&p===null||u.skipEmptyString&&p===""?g:(p=p===null?"":p,g.length===0?[[E(m,u),d,E(p,u)].join("")]:[[g,E(p,u)].join(u.arrayFormatSeparator)])}default:return d=>(m,g)=>g===void 0||u.skipNull&&g===null||u.skipEmptyString&&g===""?m:g===null?[...m,E(d,u)]:[...m,[E(d,u),"=",E(g,u)].join("")]}}function P(u){let d;switch(u.arrayFormat){case"index":return(m,g,p)=>{if(d=/\[(\d*)\]$/.exec(m),m=m.replace(/\[\d*\]$/,""),!d){p[m]=g;return}p[m]===void 0&&(p[m]={}),p[m][d[1]]=g};case"bracket":return(m,g,p)=>{if(d=/(\[\])$/.exec(m),m=m.replace(/\[\]$/,""),!d){p[m]=g;return}if(p[m]===void 0){p[m]=[g];return}p[m]=[].concat(p[m],g)};case"colon-list-separator":return(m,g,p)=>{if(d=/(:list)$/.exec(m),m=m.replace(/:list$/,""),!d){p[m]=g;return}if(p[m]===void 0){p[m]=[g];return}p[m]=[].concat(p[m],g)};case"comma":case"separator":return(m,g,p)=>{const N=typeof g=="string"&&g.includes(u.arrayFormatSeparator),x=typeof g=="string"&&!N&&O(g,u).includes(u.arrayFormatSeparator);g=x?O(g,u):g;const Q=N||x?g.split(u.arrayFormatSeparator).map(se=>O(se,u)):g===null?g:O(g,u);p[m]=Q};case"bracket-separator":return(m,g,p)=>{const N=/(\[\])$/.test(m);if(m=m.replace(/\[\]$/,""),!N){p[m]=g&&O(g,u);return}const x=g===null?[]:g.split(u.arrayFormatSeparator).map(Q=>O(Q,u));if(p[m]===void 0){p[m]=x;return}p[m]=[].concat(p[m],x)};default:return(m,g,p)=>{if(p[m]===void 0){p[m]=g;return}p[m]=[].concat(p[m],g)}}}function _(u){if(typeof u!="string"||u.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function E(u,d){return d.encode?d.strict?t(u):encodeURIComponent(u):u}function O(u,d){return d.decode?r(u):u}function U(u){return Array.isArray(u)?u.sort():typeof u=="object"?U(Object.keys(u)).sort((d,m)=>Number(d)-Number(m)).map(d=>u[d]):u}function H(u){const d=u.indexOf("#");return d!==-1&&(u=u.slice(0,d)),u}function M(u){let d="";const m=u.indexOf("#");return m!==-1&&(d=u.slice(m)),d}function W(u){u=H(u);const d=u.indexOf("?");return d===-1?"":u.slice(d+1)}function ie(u,d){return d.parseNumbers&&!Number.isNaN(Number(u))&&typeof u=="string"&&u.trim()!==""?u=Number(u):d.parseBooleans&&u!==null&&(u.toLowerCase()==="true"||u.toLowerCase()==="false")&&(u=u.toLowerCase()==="true"),u}function ce(u,d){d=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},d),_(d.arrayFormatSeparator);const m=P(d),g=Object.create(null);if(typeof u!="string"||(u=u.trim().replace(/^[?#&]/,""),!u))return g;for(const p of u.split("&")){if(p==="")continue;let[N,x]=n(d.decode?p.replace(/\+/g," "):p,"=");x=x===void 0?null:["comma","separator","bracket-separator"].includes(d.arrayFormat)?x:O(x,d),m(O(N,d),x,g)}for(const p of Object.keys(g)){const N=g[p];if(typeof N=="object"&&N!==null)for(const x of Object.keys(N))N[x]=ie(N[x],d);else g[p]=ie(N,d)}return d.sort===!1?g:(d.sort===!0?Object.keys(g).sort():Object.keys(g).sort(d.sort)).reduce((p,N)=>{const x=g[N];return x&&typeof x=="object"&&!Array.isArray(x)?p[N]=U(x):p[N]=x,p},Object.create(null))}s.extract=W,s.parse=ce,s.stringify=(u,d)=>{if(!u)return"";d=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},d),_(d.arrayFormatSeparator);const m=x=>d.skipNull&&l(u[x])||d.skipEmptyString&&u[x]==="",g=b(d),p={};for(const x of Object.keys(u))m(x)||(p[x]=u[x]);const N=Object.keys(p);return d.sort!==!1&&N.sort(d.sort),N.map(x=>{const Q=u[x];return Q===void 0?"":Q===null?E(x,d):Array.isArray(Q)?Q.length===0&&d.arrayFormat==="bracket-separator"?E(x,d)+"[]":Q.reduce(g(x),[]).join("&"):E(x,d)+"="+E(Q,d)}).filter(x=>x.length>0).join("&")},s.parseUrl=(u,d)=>{d=Object.assign({decode:!0},d);const[m,g]=n(u,"#");return Object.assign({url:m.split("?")[0]||"",query:ce(W(u),d)},d&&d.parseFragmentIdentifier&&g?{fragmentIdentifier:O(g,d)}:{})},s.stringifyUrl=(u,d)=>{d=Object.assign({encode:!0,strict:!0,[y]:!0},d);const m=H(u.url).split("?")[0]||"",g=s.extract(u.url),p=s.parse(g,{sort:!1}),N=Object.assign(p,u.query);let x=s.stringify(N,d);x&&(x=`?${x}`);let Q=M(u.url);return u.fragmentIdentifier&&(Q=`#${d[y]?E(u.fragmentIdentifier,d):u.fragmentIdentifier}`),`${m}${x}${Q}`},s.pick=(u,d,m)=>{m=Object.assign({parseFragmentIdentifier:!0,[y]:!1},m);const{url:g,query:p,fragmentIdentifier:N}=s.parseUrl(u,m);return s.stringifyUrl({url:g,query:o(p,d),fragmentIdentifier:N},m)},s.exclude=(u,d,m)=>{const g=Array.isArray(d)?p=>!d.includes(p):(p,N)=>!d(p,N);return s.pick(u,g,m)}})(Ew);function Iw(s,t=[]){const r=[];return Object.keys(s).forEach(n=>{if(t.length&&!t.includes(n))return;const o=s[n];r.push(...o.accounts)}),r}const Sw={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function xw(s,t){const{message:r,code:n}=Sw[s];return{message:t?`${r} ${t}`:r,code:n}}function Lc(s,t){return Array.isArray(s)?typeof t<"u"&&s.length?s.every(t):!0:!1}const Pw=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,Ow=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,Nw=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function Tw(s,t){if(s==="__proto__"||s==="constructor"&&t&&typeof t=="object"&&"prototype"in t){Aw(s);return}return t}function Aw(s){console.warn(`[destr] Dropping "${s}" key to prevent prototype pollution.`)}function pa(s,t={}){if(typeof s!="string")return s;const r=s.trim();if(s[0]==='"'&&s.at(-1)==='"'&&!s.includes("\\"))return r.slice(1,-1);if(r.length<=9){const n=r.toLowerCase();if(n==="true")return!0;if(n==="false")return!1;if(n==="undefined")return;if(n==="null")return null;if(n==="nan")return Number.NaN;if(n==="infinity")return Number.POSITIVE_INFINITY;if(n==="-infinity")return Number.NEGATIVE_INFINITY}if(!Nw.test(s)){if(t.strict)throw new SyntaxError("[destr] Invalid JSON");return s}try{if(Pw.test(s)||Ow.test(s)){if(t.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(s,Tw)}return JSON.parse(s)}catch(n){if(t.strict)throw n;return s}}function Rw(s){return!s||typeof s.then!="function"?Promise.resolve(s):s}function zt(s,...t){try{return Rw(s(...t))}catch(r){return Promise.reject(r)}}function Cw(s){const t=typeof s;return s===null||t!=="object"&&t!=="function"}function $w(s){const t=Object.getPrototypeOf(s);return!t||t.isPrototypeOf(Object)}function ba(s){if(Cw(s))return String(s);if($w(s)||Array.isArray(s))return JSON.stringify(s);if(typeof s.toJSON=="function")return ba(s.toJSON());throw new Error("[unstorage] Cannot stringify value!")}function $f(){if(typeof Buffer===void 0)throw new TypeError("[unstorage] Buffer is not supported!")}const qc="base64:";function Dw(s){if(typeof s=="string")return s;$f();const t=Buffer.from(s).toString("base64");return qc+t}function Uw(s){return typeof s!="string"||!s.startsWith(qc)?s:($f(),Buffer.from(s.slice(qc.length),"base64"))}function dr(s){return s?s.split("?")[0].replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""):""}function jw(...s){return dr(s.join(":"))}function ga(s){return s=dr(s),s?s+":":""}const Lw="memory",qw=()=>{const s=new Map;return{name:Lw,options:{},hasItem(t){return s.has(t)},getItem(t){return s.get(t)??null},getItemRaw(t){return s.get(t)??null},setItem(t,r){s.set(t,r)},setItemRaw(t,r){s.set(t,r)},removeItem(t){s.delete(t)},getKeys(){return Array.from(s.keys())},clear(){s.clear()},dispose(){s.clear()}}};function Mw(s={}){const t={mounts:{"":s.driver||qw()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=_=>{for(const E of t.mountpoints)if(_.startsWith(E))return{base:E,relativeKey:_.slice(E.length),driver:t.mounts[E]};return{base:"",relativeKey:_,driver:t.mounts[""]}},n=(_,E)=>t.mountpoints.filter(O=>O.startsWith(_)||E&&_.startsWith(O)).map(O=>({relativeBase:_.length>O.length?_.slice(O.length):void 0,mountpoint:O,driver:t.mounts[O]})),o=(_,E)=>{if(t.watching){E=dr(E);for(const O of t.watchListeners)O(_,E)}},l=async()=>{if(!t.watching){t.watching=!0;for(const _ in t.mounts)t.unwatch[_]=await gl(t.mounts[_],o,_)}},y=async()=>{if(t.watching){for(const _ in t.unwatch)await t.unwatch[_]();t.unwatch={},t.watching=!1}},b=(_,E,O)=>{const U=new Map,H=M=>{let W=U.get(M.base);return W||(W={driver:M.driver,base:M.base,items:[]},U.set(M.base,W)),W};for(const M of _){const W=typeof M=="string",ie=dr(W?M:M.key),ce=W?void 0:M.value,u=W||!M.options?E:{...E,...M.options},d=r(ie);H(d).items.push({key:ie,value:ce,relativeKey:d.relativeKey,options:u})}return Promise.all([...U.values()].map(M=>O(M))).then(M=>M.flat())},P={hasItem(_,E={}){_=dr(_);const{relativeKey:O,driver:U}=r(_);return zt(U.hasItem,O,E)},getItem(_,E={}){_=dr(_);const{relativeKey:O,driver:U}=r(_);return zt(U.getItem,O,E).then(H=>pa(H))},getItems(_,E){return b(_,E,O=>O.driver.getItems?zt(O.driver.getItems,O.items.map(U=>({key:U.relativeKey,options:U.options})),E).then(U=>U.map(H=>({key:jw(O.base,H.key),value:pa(H.value)}))):Promise.all(O.items.map(U=>zt(O.driver.getItem,U.relativeKey,U.options).then(H=>({key:U.key,value:pa(H)})))))},getItemRaw(_,E={}){_=dr(_);const{relativeKey:O,driver:U}=r(_);return U.getItemRaw?zt(U.getItemRaw,O,E):zt(U.getItem,O,E).then(H=>Uw(H))},async setItem(_,E,O={}){if(E===void 0)return P.removeItem(_);_=dr(_);const{relativeKey:U,driver:H}=r(_);H.setItem&&(await zt(H.setItem,U,ba(E),O),H.watch||o("update",_))},async setItems(_,E){await b(_,E,async O=>{O.driver.setItems&&await zt(O.driver.setItems,O.items.map(U=>({key:U.relativeKey,value:ba(U.value),options:U.options})),E),O.driver.setItem&&await Promise.all(O.items.map(U=>zt(O.driver.setItem,U.relativeKey,ba(U.value),U.options)))})},async setItemRaw(_,E,O={}){if(E===void 0)return P.removeItem(_,O);_=dr(_);const{relativeKey:U,driver:H}=r(_);if(H.setItemRaw)await zt(H.setItemRaw,U,E,O);else if(H.setItem)await zt(H.setItem,U,Dw(E),O);else return;H.watch||o("update",_)},async removeItem(_,E={}){typeof E=="boolean"&&(E={removeMeta:E}),_=dr(_);const{relativeKey:O,driver:U}=r(_);U.removeItem&&(await zt(U.removeItem,O,E),(E.removeMeta||E.removeMata)&&await zt(U.removeItem,O+"$",E),U.watch||o("remove",_))},async getMeta(_,E={}){typeof E=="boolean"&&(E={nativeOnly:E}),_=dr(_);const{relativeKey:O,driver:U}=r(_),H=Object.create(null);if(U.getMeta&&Object.assign(H,await zt(U.getMeta,O,E)),!E.nativeOnly){const M=await zt(U.getItem,O+"$",E).then(W=>pa(W));M&&typeof M=="object"&&(typeof M.atime=="string"&&(M.atime=new Date(M.atime)),typeof M.mtime=="string"&&(M.mtime=new Date(M.mtime)),Object.assign(H,M))}return H},setMeta(_,E,O={}){return this.setItem(_+"$",E,O)},removeMeta(_,E={}){return this.removeItem(_+"$",E)},async getKeys(_,E={}){_=ga(_);const O=n(_,!0);let U=[];const H=[];for(const M of O){const ie=(await zt(M.driver.getKeys,M.relativeBase,E)).map(ce=>M.mountpoint+dr(ce)).filter(ce=>!U.some(u=>ce.startsWith(u)));H.push(...ie),U=[M.mountpoint,...U.filter(ce=>!ce.startsWith(M.mountpoint))]}return _?H.filter(M=>M.startsWith(_)&&!M.endsWith("$")):H.filter(M=>!M.endsWith("$"))},async clear(_,E={}){_=ga(_),await Promise.all(n(_,!1).map(async O=>{if(O.driver.clear)return zt(O.driver.clear,O.relativeBase,E);if(O.driver.removeItem){const U=await O.driver.getKeys(O.relativeBase||"",E);return Promise.all(U.map(H=>O.driver.removeItem(H,E)))}}))},async dispose(){await Promise.all(Object.values(t.mounts).map(_=>ml(_)))},async watch(_){return await l(),t.watchListeners.push(_),async()=>{t.watchListeners=t.watchListeners.filter(E=>E!==_),t.watchListeners.length===0&&await y()}},async unwatch(){t.watchListeners=[],await y()},mount(_,E){if(_=ga(_),_&&t.mounts[_])throw new Error(`already mounted at ${_}`);return _&&(t.mountpoints.push(_),t.mountpoints.sort((O,U)=>U.length-O.length)),t.mounts[_]=E,t.watching&&Promise.resolve(gl(E,o,_)).then(O=>{t.unwatch[_]=O}).catch(console.error),P},async unmount(_,E=!0){_=ga(_),!(!_||!t.mounts[_])&&(t.watching&&_ in t.unwatch&&(t.unwatch[_](),delete t.unwatch[_]),E&&await ml(t.mounts[_]),t.mountpoints=t.mountpoints.filter(O=>O!==_),delete t.mounts[_])},getMount(_=""){_=dr(_)+":";const E=r(_);return{driver:E.driver,base:E.base}},getMounts(_="",E={}){return _=dr(_),n(_,E.parents).map(U=>({driver:U.driver,base:U.mountpoint}))}};return P}function gl(s,t,r){return s.watch?s.watch((n,o)=>t(n,r+o)):()=>{}}async function ml(s){typeof s.dispose=="function"&&await zt(s.dispose)}function Bi(s){return new Promise((t,r)=>{s.oncomplete=s.onsuccess=()=>t(s.result),s.onabort=s.onerror=()=>r(s.error)})}function Df(s,t){const r=indexedDB.open(s);r.onupgradeneeded=()=>r.result.createObjectStore(t);const n=Bi(r);return(o,l)=>n.then(y=>l(y.transaction(t,o).objectStore(t)))}let mc;function as(){return mc||(mc=Df("keyval-store","keyval")),mc}function yl(s,t=as()){return t("readonly",r=>Bi(r.get(s)))}function zw(s,t,r=as()){return r("readwrite",n=>(n.put(t,s),Bi(n.transaction)))}function Fw(s,t=as()){return t("readwrite",r=>(r.delete(s),Bi(r.transaction)))}function Hw(s=as()){return s("readwrite",t=>(t.clear(),Bi(t.transaction)))}function kw(s,t){return s.openCursor().onsuccess=function(){this.result&&(t(this.result),this.result.continue())},Bi(s.transaction)}function Kw(s=as()){return s("readonly",t=>{if(t.getAllKeys)return Bi(t.getAllKeys());const r=[];return kw(t,n=>r.push(n.key)).then(()=>r)})}const Vw="idb-keyval";var Bw=(s={})=>{const t=s.base&&s.base.length>0?`${s.base}:`:"",r=o=>t+o;let n;return s.dbName&&s.storeName&&(n=Df(s.dbName,s.storeName)),{name:Vw,options:s,async hasItem(o){return!(typeof await yl(r(o),n)>"u")},async getItem(o){return await yl(r(o),n)??null},setItem(o,l){return zw(r(o),l,n)},removeItem(o){return Fw(r(o),n)},getKeys(){return Kw(n)},clear(){return Hw(n)}}};const Gw="WALLET_CONNECT_V2_INDEXED_DB",Ww="keyvaluestorage";let Qw=class{constructor(){this.indexedDb=Mw({driver:Bw({dbName:Gw,storeName:Ww})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(t=>[t.key,t.value])}async getItem(t){const r=await this.indexedDb.getItem(t);if(r!==null)return r}async setItem(t,r){await this.indexedDb.setItem(t,ss(r))}async removeItem(t){await this.indexedDb.removeItem(t)}};var yc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},_a={exports:{}};(function(){let s;function t(){}s=t,s.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},s.prototype.setItem=function(r,n){this[r]=String(n)},s.prototype.removeItem=function(r){delete this[r]},s.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(n){r[n]=void 0,delete r[n]})},s.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},s.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof yc<"u"&&yc.localStorage?_a.exports=yc.localStorage:typeof window<"u"&&window.localStorage?_a.exports=window.localStorage:_a.exports=new t})();function Jw(s){var t;return[s[0],qa((t=s[1])!=null?t:"")]}let Yw=class{constructor(){this.localStorage=_a.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(Jw)}async getItem(t){const r=this.localStorage.getItem(t);if(r!==null)return qa(r)}async setItem(t,r){this.localStorage.setItem(t,ss(r))}async removeItem(t){this.localStorage.removeItem(t)}};const Zw="wc_storage_version",vl=1,Xw=async(s,t,r)=>{const n=Zw,o=await t.getItem(n);if(o&&o>=vl){r(t);return}const l=await s.getKeys();if(!l.length){r(t);return}const y=[];for(;l.length;){const b=l.shift();if(!b)continue;const P=b.toLowerCase();if(P.includes("wc@")||P.includes("walletconnect")||P.includes("wc_")||P.includes("wallet_connect")){const _=await s.getItem(b);await t.setItem(b,_),y.push(b)}}await t.setItem(n,vl),r(t),eb(s,y)},eb=async(s,t)=>{t.length&&t.forEach(async r=>{await s.removeItem(r)})};let tb=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const t=new Yw;this.storage=t;try{const r=new Qw;Xw(t,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(t){return await this.initialize(),this.storage.getItem(t)}async setItem(t,r){return await this.initialize(),this.storage.setItem(t,r)}async removeItem(t){return await this.initialize(),this.storage.removeItem(t)}async initialize(){this.initialized||await new Promise(t=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),t())},20)})}};var wn={},Hn={},vc={},kn={};class Gi{}const rb=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Gi},Symbol.toStringTag,{value:"Module"})),ib=cw(rb);var wl;function nb(){if(wl)return kn;wl=1,Object.defineProperty(kn,"__esModule",{value:!0}),kn.IHeartBeat=void 0;const s=ib;class t extends s.IEvents{constructor(n){super()}}return kn.IHeartBeat=t,kn}var bl;function Uf(){return bl||(bl=1,function(s){Object.defineProperty(s,"__esModule",{value:!0}),ns.__exportStar(nb(),s)}(vc)),vc}var wc={},Hi={},_l;function sb(){if(_l)return Hi;_l=1,Object.defineProperty(Hi,"__esModule",{value:!0}),Hi.HEARTBEAT_EVENTS=Hi.HEARTBEAT_INTERVAL=void 0;const s=ne;return Hi.HEARTBEAT_INTERVAL=s.FIVE_SECONDS,Hi.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Hi}var El;function jf(){return El||(El=1,function(s){Object.defineProperty(s,"__esModule",{value:!0}),ns.__exportStar(sb(),s)}(wc)),wc}var Il;function ab(){if(Il)return Hn;Il=1,Object.defineProperty(Hn,"__esModule",{value:!0}),Hn.HeartBeat=void 0;const s=ns,t=Qr,r=ne,n=Uf(),o=jf();class l extends n.IHeartBeat{constructor(b){super(b),this.events=new t.EventEmitter,this.interval=o.HEARTBEAT_INTERVAL,this.interval=(b==null?void 0:b.interval)||o.HEARTBEAT_INTERVAL}static init(b){return s.__awaiter(this,void 0,void 0,function*(){const P=new l(b);return yield P.init(),P})}init(){return s.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(b,P){this.events.on(b,P)}once(b,P){this.events.once(b,P)}off(b,P){this.events.off(b,P)}removeListener(b,P){this.events.removeListener(b,P)}initialize(){return s.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(o.HEARTBEAT_EVENTS.pulse)}}return Hn.HeartBeat=l,Hn}(function(s){Object.defineProperty(s,"__esModule",{value:!0});const t=ns;t.__exportStar(ab(),s),t.__exportStar(Uf(),s),t.__exportStar(jf(),s)})(wn);var Ne={},bc,Sl;function ob(){if(Sl)return bc;Sl=1;function s(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}bc=t;function t(r,n,o){var l=o&&o.stringify||s,y=1;if(typeof r=="object"&&r!==null){var b=n.length+y;if(b===1)return r;var P=new Array(b);P[0]=l(r);for(var _=1;_<b;_++)P[_]=l(n[_]);return P.join(" ")}if(typeof r!="string")return r;var E=n.length;if(E===0)return r;for(var O="",U=1-y,H=-1,M=r&&r.length||0,W=0;W<M;){if(r.charCodeAt(W)===37&&W+1<M){switch(H=H>-1?H:0,r.charCodeAt(W+1)){case 100:case 102:if(U>=E||n[U]==null)break;H<W&&(O+=r.slice(H,W)),O+=Number(n[U]),H=W+2,W++;break;case 105:if(U>=E||n[U]==null)break;H<W&&(O+=r.slice(H,W)),O+=Math.floor(Number(n[U])),H=W+2,W++;break;case 79:case 111:case 106:if(U>=E||n[U]===void 0)break;H<W&&(O+=r.slice(H,W));var ie=typeof n[U];if(ie==="string"){O+="'"+n[U]+"'",H=W+2,W++;break}if(ie==="function"){O+=n[U].name||"<anonymous>",H=W+2,W++;break}O+=l(n[U]),H=W+2,W++;break;case 115:if(U>=E)break;H<W&&(O+=r.slice(H,W)),O+=String(n[U]),H=W+2,W++;break;case 37:H<W&&(O+=r.slice(H,W)),O+="%",H=W+2,W++,U--;break}++U}++W}return H===-1?r:(H<M&&(O+=r.slice(H)),O)}return bc}var _c,xl;function cb(){if(xl)return _c;xl=1;const s=ob();_c=o;const t=g().console||{},r={mapHttpRequest:M,mapHttpResponse:M,wrapRequestSerializer:W,wrapResponseSerializer:W,wrapErrorSerializer:W,req:M,res:M,err:U};function n(p,N){return Array.isArray(p)?p.filter(function(Q){return Q!=="!stdSerializers.err"}):p===!0?Object.keys(N):!1}function o(p){p=p||{},p.browser=p.browser||{};const N=p.browser.transmit;if(N&&typeof N.send!="function")throw Error("pino: transmit option must have a send function");const x=p.browser.write||t;p.browser.write&&(p.browser.asObject=!0);const Q=p.serializers||{},se=n(p.browser.serialize,Q);let Ee=p.browser.serialize;Array.isArray(p.browser.serialize)&&p.browser.serialize.indexOf("!stdSerializers.err")>-1&&(Ee=!1);const Te=["error","fatal","warn","info","debug","trace"];typeof x=="function"&&(x.error=x.fatal=x.warn=x.info=x.debug=x.trace=x),p.enabled===!1&&(p.level="silent");const tt=p.level||"info",L=Object.create(x);L.log||(L.log=ie),Object.defineProperty(L,"levelVal",{get:Me}),Object.defineProperty(L,"level",{get:Ae,set:ee});const V={transmit:N,serialize:se,asObject:p.browser.asObject,levels:Te,timestamp:H(p)};L.levels=o.levels,L.level=tt,L.setMaxListeners=L.getMaxListeners=L.emit=L.addListener=L.on=L.prependListener=L.once=L.prependOnceListener=L.removeListener=L.removeAllListeners=L.listeners=L.listenerCount=L.eventNames=L.write=L.flush=ie,L.serializers=Q,L._serialize=se,L._stdErrSerialize=Ee,L.child=Y,N&&(L._logEvent=O());function Me(){return this.level==="silent"?1/0:this.levels.values[this.level]}function Ae(){return this._level}function ee(J){if(J!=="silent"&&!this.levels.values[J])throw Error("unknown level "+J);this._level=J,l(V,L,"error","log"),l(V,L,"fatal","error"),l(V,L,"warn","error"),l(V,L,"info","log"),l(V,L,"debug","log"),l(V,L,"trace","log")}function Y(J,Z){if(!J)throw new Error("missing bindings for child Pino");Z=Z||{},se&&J.serializers&&(Z.serializers=J.serializers);const ht=Z.serializers;if(se&&ht){var ke=Object.assign({},Q,ht),Fr=p.browser.serialize===!0?Object.keys(ke):se;delete J.serializers,P([J],Fr,ke,this._stdErrSerialize)}function be(St){this._childLevel=(St._childLevel|0)+1,this.error=_(St,J,"error"),this.fatal=_(St,J,"fatal"),this.warn=_(St,J,"warn"),this.info=_(St,J,"info"),this.debug=_(St,J,"debug"),this.trace=_(St,J,"trace"),ke&&(this.serializers=ke,this._serialize=Fr),N&&(this._logEvent=O([].concat(St._logEvent.bindings,J)))}return be.prototype=this,new be(this)}return L}o.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},o.stdSerializers=r,o.stdTimeFunctions=Object.assign({},{nullTime:ce,epochTime:u,unixTime:d,isoTime:m});function l(p,N,x,Q){const se=Object.getPrototypeOf(N);N[x]=N.levelVal>N.levels.values[x]?ie:se[x]?se[x]:t[x]||t[Q]||ie,y(p,N,x)}function y(p,N,x){!p.transmit&&N[x]===ie||(N[x]=function(Q){return function(){const Ee=p.timestamp(),Te=new Array(arguments.length),tt=Object.getPrototypeOf&&Object.getPrototypeOf(this)===t?t:this;for(var L=0;L<Te.length;L++)Te[L]=arguments[L];if(p.serialize&&!p.asObject&&P(Te,this._serialize,this.serializers,this._stdErrSerialize),p.asObject?Q.call(tt,b(this,x,Te,Ee)):Q.apply(tt,Te),p.transmit){const V=p.transmit.level||N.level,Me=o.levels.values[V],Ae=o.levels.values[x];if(Ae<Me)return;E(this,{ts:Ee,methodLevel:x,methodValue:Ae,transmitLevel:V,transmitValue:o.levels.values[p.transmit.level||N.level],send:p.transmit.send,val:N.levelVal},Te)}}}(N[x]))}function b(p,N,x,Q){p._serialize&&P(x,p._serialize,p.serializers,p._stdErrSerialize);const se=x.slice();let Ee=se[0];const Te={};Q&&(Te.time=Q),Te.level=o.levels.values[N];let tt=(p._childLevel|0)+1;if(tt<1&&(tt=1),Ee!==null&&typeof Ee=="object"){for(;tt--&&typeof se[0]=="object";)Object.assign(Te,se.shift());Ee=se.length?s(se.shift(),se):void 0}else typeof Ee=="string"&&(Ee=s(se.shift(),se));return Ee!==void 0&&(Te.msg=Ee),Te}function P(p,N,x,Q){for(const se in p)if(Q&&p[se]instanceof Error)p[se]=o.stdSerializers.err(p[se]);else if(typeof p[se]=="object"&&!Array.isArray(p[se]))for(const Ee in p[se])N&&N.indexOf(Ee)>-1&&Ee in x&&(p[se][Ee]=x[Ee](p[se][Ee]))}function _(p,N,x){return function(){const Q=new Array(1+arguments.length);Q[0]=N;for(var se=1;se<Q.length;se++)Q[se]=arguments[se-1];return p[x].apply(this,Q)}}function E(p,N,x){const Q=N.send,se=N.ts,Ee=N.methodLevel,Te=N.methodValue,tt=N.val,L=p._logEvent.bindings;P(x,p._serialize||Object.keys(p.serializers),p.serializers,p._stdErrSerialize===void 0?!0:p._stdErrSerialize),p._logEvent.ts=se,p._logEvent.messages=x.filter(function(V){return L.indexOf(V)===-1}),p._logEvent.level.label=Ee,p._logEvent.level.value=Te,Q(Ee,p._logEvent,tt),p._logEvent=O(L)}function O(p){return{ts:0,messages:[],bindings:p||[],level:{label:"",value:0}}}function U(p){const N={type:p.constructor.name,msg:p.message,stack:p.stack};for(const x in p)N[x]===void 0&&(N[x]=p[x]);return N}function H(p){return typeof p.timestamp=="function"?p.timestamp:p.timestamp===!1?ce:u}function M(){return{}}function W(p){return p}function ie(){}function ce(){return!1}function u(){return Date.now()}function d(){return Math.round(Date.now()/1e3)}function m(){return new Date(Date.now()).toISOString()}function g(){function p(N){return typeof N<"u"&&N}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return p(self)||p(window)||p(this)||{}}}return _c}var ki={},Pl;function Lf(){return Pl||(Pl=1,Object.defineProperty(ki,"__esModule",{value:!0}),ki.PINO_CUSTOM_CONTEXT_KEY=ki.PINO_LOGGER_DEFAULTS=void 0,ki.PINO_LOGGER_DEFAULTS={level:"info"},ki.PINO_CUSTOM_CONTEXT_KEY="custom_context"),ki}var ir={},Ol;function ub(){if(Ol)return ir;Ol=1,Object.defineProperty(ir,"__esModule",{value:!0}),ir.generateChildLogger=ir.formatChildLoggerContext=ir.getLoggerContext=ir.setBrowserLoggerContext=ir.getBrowserLoggerContext=ir.getDefaultLoggerOptions=void 0;const s=Lf();function t(b){return Object.assign(Object.assign({},b),{level:(b==null?void 0:b.level)||s.PINO_LOGGER_DEFAULTS.level})}ir.getDefaultLoggerOptions=t;function r(b,P=s.PINO_CUSTOM_CONTEXT_KEY){return b[P]||""}ir.getBrowserLoggerContext=r;function n(b,P,_=s.PINO_CUSTOM_CONTEXT_KEY){return b[_]=P,b}ir.setBrowserLoggerContext=n;function o(b,P=s.PINO_CUSTOM_CONTEXT_KEY){let _="";return typeof b.bindings>"u"?_=r(b,P):_=b.bindings().context||"",_}ir.getLoggerContext=o;function l(b,P,_=s.PINO_CUSTOM_CONTEXT_KEY){const E=o(b,_);return E.trim()?`${E}/${P}`:P}ir.formatChildLoggerContext=l;function y(b,P,_=s.PINO_CUSTOM_CONTEXT_KEY){const E=l(b,P,_),O=b.child({context:E});return n(O,E,_)}return ir.generateChildLogger=y,ir}(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.pino=void 0;const t=ns,r=t.__importDefault(cb());Object.defineProperty(s,"pino",{enumerable:!0,get:function(){return r.default}}),t.__exportStar(Lf(),s),t.__exportStar(ub(),s)})(Ne);class hb extends Gi{constructor(t){super(),this.opts=t,this.protocol="wc",this.version=2}}let lb=class extends Gi{constructor(t,r){super(),this.core=t,this.logger=r,this.records=new Map}},fb=class{constructor(t,r){this.logger=t,this.core=r}},db=class extends Gi{constructor(t,r){super(),this.relayer=t,this.logger=r}},pb=class extends Gi{constructor(t){super()}},gb=class{constructor(t,r,n,o){this.core=t,this.logger=r,this.name=n}};class mb extends Gi{constructor(t,r){super(),this.relayer=t,this.logger=r}}let yb=class extends Gi{constructor(t,r){super(),this.core=t,this.logger=r}},vb=class{constructor(t,r){this.projectId=t,this.logger=r}},wb=class{constructor(t){this.opts=t,this.protocol="wc",this.version=2}},bb=class{constructor(t){this.client=t}};var ru={},qf={};(function(s){Object.defineProperty(s,"__esModule",{value:!0});var t=uw,r=Pf;s.DIGEST_LENGTH=64,s.BLOCK_SIZE=128;var n=function(){function b(){this.digestLength=s.DIGEST_LENGTH,this.blockSize=s.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return b.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},b.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},b.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},b.prototype.update=function(P,_){if(_===void 0&&(_=P.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var E=0;if(this._bytesHashed+=_,this._bufferLength>0){for(;this._bufferLength<s.BLOCK_SIZE&&_>0;)this._buffer[this._bufferLength++]=P[E++],_--;this._bufferLength===this.blockSize&&(l(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(_>=this.blockSize&&(E=l(this._tempHi,this._tempLo,this._stateHi,this._stateLo,P,E,_),_%=this.blockSize);_>0;)this._buffer[this._bufferLength++]=P[E++],_--;return this},b.prototype.finish=function(P){if(!this._finished){var _=this._bytesHashed,E=this._bufferLength,O=_/536870912|0,U=_<<3,H=_%128<112?128:256;this._buffer[E]=128;for(var M=E+1;M<H-8;M++)this._buffer[M]=0;t.writeUint32BE(O,this._buffer,H-8),t.writeUint32BE(U,this._buffer,H-4),l(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,H),this._finished=!0}for(var M=0;M<this.digestLength/8;M++)t.writeUint32BE(this._stateHi[M],P,M*8),t.writeUint32BE(this._stateLo[M],P,M*8+4);return this},b.prototype.digest=function(){var P=new Uint8Array(this.digestLength);return this.finish(P),P},b.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},b.prototype.restoreState=function(P){return this._stateHi.set(P.stateHi),this._stateLo.set(P.stateLo),this._bufferLength=P.bufferLength,P.buffer&&this._buffer.set(P.buffer),this._bytesHashed=P.bytesHashed,this._finished=!1,this},b.prototype.cleanSavedState=function(P){r.wipe(P.stateHi),r.wipe(P.stateLo),P.buffer&&r.wipe(P.buffer),P.bufferLength=0,P.bytesHashed=0},b}();s.SHA512=n;var o=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function l(b,P,_,E,O,U,H){for(var M=_[0],W=_[1],ie=_[2],ce=_[3],u=_[4],d=_[5],m=_[6],g=_[7],p=E[0],N=E[1],x=E[2],Q=E[3],se=E[4],Ee=E[5],Te=E[6],tt=E[7],L,V,Me,Ae,ee,Y,J,Z;H>=128;){for(var ht=0;ht<16;ht++){var ke=8*ht+U;b[ht]=t.readUint32BE(O,ke),P[ht]=t.readUint32BE(O,ke+4)}for(var ht=0;ht<80;ht++){var Fr=M,be=W,St=ie,z=ce,q=u,D=d,h=m,A=g,ae=p,de=N,ve=x,Re=Q,$e=se,Se=Ee,xt=Te,wt=tt;if(L=g,V=tt,ee=V&65535,Y=V>>>16,J=L&65535,Z=L>>>16,L=(u>>>14|se<<18)^(u>>>18|se<<14)^(se>>>9|u<<23),V=(se>>>14|u<<18)^(se>>>18|u<<14)^(u>>>9|se<<23),ee+=V&65535,Y+=V>>>16,J+=L&65535,Z+=L>>>16,L=u&d^~u&m,V=se&Ee^~se&Te,ee+=V&65535,Y+=V>>>16,J+=L&65535,Z+=L>>>16,L=o[ht*2],V=o[ht*2+1],ee+=V&65535,Y+=V>>>16,J+=L&65535,Z+=L>>>16,L=b[ht%16],V=P[ht%16],ee+=V&65535,Y+=V>>>16,J+=L&65535,Z+=L>>>16,Y+=ee>>>16,J+=Y>>>16,Z+=J>>>16,Me=J&65535|Z<<16,Ae=ee&65535|Y<<16,L=Me,V=Ae,ee=V&65535,Y=V>>>16,J=L&65535,Z=L>>>16,L=(M>>>28|p<<4)^(p>>>2|M<<30)^(p>>>7|M<<25),V=(p>>>28|M<<4)^(M>>>2|p<<30)^(M>>>7|p<<25),ee+=V&65535,Y+=V>>>16,J+=L&65535,Z+=L>>>16,L=M&W^M&ie^W&ie,V=p&N^p&x^N&x,ee+=V&65535,Y+=V>>>16,J+=L&65535,Z+=L>>>16,Y+=ee>>>16,J+=Y>>>16,Z+=J>>>16,A=J&65535|Z<<16,wt=ee&65535|Y<<16,L=z,V=Re,ee=V&65535,Y=V>>>16,J=L&65535,Z=L>>>16,L=Me,V=Ae,ee+=V&65535,Y+=V>>>16,J+=L&65535,Z+=L>>>16,Y+=ee>>>16,J+=Y>>>16,Z+=J>>>16,z=J&65535|Z<<16,Re=ee&65535|Y<<16,W=Fr,ie=be,ce=St,u=z,d=q,m=D,g=h,M=A,N=ae,x=de,Q=ve,se=Re,Ee=$e,Te=Se,tt=xt,p=wt,ht%16===15)for(var ke=0;ke<16;ke++)L=b[ke],V=P[ke],ee=V&65535,Y=V>>>16,J=L&65535,Z=L>>>16,L=b[(ke+9)%16],V=P[(ke+9)%16],ee+=V&65535,Y+=V>>>16,J+=L&65535,Z+=L>>>16,Me=b[(ke+1)%16],Ae=P[(ke+1)%16],L=(Me>>>1|Ae<<31)^(Me>>>8|Ae<<24)^Me>>>7,V=(Ae>>>1|Me<<31)^(Ae>>>8|Me<<24)^(Ae>>>7|Me<<25),ee+=V&65535,Y+=V>>>16,J+=L&65535,Z+=L>>>16,Me=b[(ke+14)%16],Ae=P[(ke+14)%16],L=(Me>>>19|Ae<<13)^(Ae>>>29|Me<<3)^Me>>>6,V=(Ae>>>19|Me<<13)^(Me>>>29|Ae<<3)^(Ae>>>6|Me<<26),ee+=V&65535,Y+=V>>>16,J+=L&65535,Z+=L>>>16,Y+=ee>>>16,J+=Y>>>16,Z+=J>>>16,b[ke]=J&65535|Z<<16,P[ke]=ee&65535|Y<<16}L=M,V=p,ee=V&65535,Y=V>>>16,J=L&65535,Z=L>>>16,L=_[0],V=E[0],ee+=V&65535,Y+=V>>>16,J+=L&65535,Z+=L>>>16,Y+=ee>>>16,J+=Y>>>16,Z+=J>>>16,_[0]=M=J&65535|Z<<16,E[0]=p=ee&65535|Y<<16,L=W,V=N,ee=V&65535,Y=V>>>16,J=L&65535,Z=L>>>16,L=_[1],V=E[1],ee+=V&65535,Y+=V>>>16,J+=L&65535,Z+=L>>>16,Y+=ee>>>16,J+=Y>>>16,Z+=J>>>16,_[1]=W=J&65535|Z<<16,E[1]=N=ee&65535|Y<<16,L=ie,V=x,ee=V&65535,Y=V>>>16,J=L&65535,Z=L>>>16,L=_[2],V=E[2],ee+=V&65535,Y+=V>>>16,J+=L&65535,Z+=L>>>16,Y+=ee>>>16,J+=Y>>>16,Z+=J>>>16,_[2]=ie=J&65535|Z<<16,E[2]=x=ee&65535|Y<<16,L=ce,V=Q,ee=V&65535,Y=V>>>16,J=L&65535,Z=L>>>16,L=_[3],V=E[3],ee+=V&65535,Y+=V>>>16,J+=L&65535,Z+=L>>>16,Y+=ee>>>16,J+=Y>>>16,Z+=J>>>16,_[3]=ce=J&65535|Z<<16,E[3]=Q=ee&65535|Y<<16,L=u,V=se,ee=V&65535,Y=V>>>16,J=L&65535,Z=L>>>16,L=_[4],V=E[4],ee+=V&65535,Y+=V>>>16,J+=L&65535,Z+=L>>>16,Y+=ee>>>16,J+=Y>>>16,Z+=J>>>16,_[4]=u=J&65535|Z<<16,E[4]=se=ee&65535|Y<<16,L=d,V=Ee,ee=V&65535,Y=V>>>16,J=L&65535,Z=L>>>16,L=_[5],V=E[5],ee+=V&65535,Y+=V>>>16,J+=L&65535,Z+=L>>>16,Y+=ee>>>16,J+=Y>>>16,Z+=J>>>16,_[5]=d=J&65535|Z<<16,E[5]=Ee=ee&65535|Y<<16,L=m,V=Te,ee=V&65535,Y=V>>>16,J=L&65535,Z=L>>>16,L=_[6],V=E[6],ee+=V&65535,Y+=V>>>16,J+=L&65535,Z+=L>>>16,Y+=ee>>>16,J+=Y>>>16,Z+=J>>>16,_[6]=m=J&65535|Z<<16,E[6]=Te=ee&65535|Y<<16,L=g,V=tt,ee=V&65535,Y=V>>>16,J=L&65535,Z=L>>>16,L=_[7],V=E[7],ee+=V&65535,Y+=V>>>16,J+=L&65535,Z+=L>>>16,Y+=ee>>>16,J+=Y>>>16,Z+=J>>>16,_[7]=g=J&65535|Z<<16,E[7]=tt=ee&65535|Y<<16,U+=128,H-=128}return U}function y(b){var P=new n;P.update(b);var _=P.digest();return P.clean(),_}s.hash=y})(qf);(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.convertSecretKeyToX25519=s.convertPublicKeyToX25519=s.verify=s.sign=s.extractPublicKeyFromSecretKey=s.generateKeyPair=s.generateKeyPairFromSeed=s.SEED_LENGTH=s.SECRET_KEY_LENGTH=s.PUBLIC_KEY_LENGTH=s.SIGNATURE_LENGTH=void 0;const t=Ua,r=qf,n=Pf;s.SIGNATURE_LENGTH=64,s.PUBLIC_KEY_LENGTH=32,s.SECRET_KEY_LENGTH=64,s.SEED_LENGTH=32;function o(z){const q=new Float64Array(16);if(z)for(let D=0;D<z.length;D++)q[D]=z[D];return q}const l=new Uint8Array(32);l[0]=9;const y=o(),b=o([1]),P=o([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),_=o([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),E=o([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),O=o([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),U=o([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function H(z,q){for(let D=0;D<16;D++)z[D]=q[D]|0}function M(z){let q=1;for(let D=0;D<16;D++){let h=z[D]+q+65535;q=Math.floor(h/65536),z[D]=h-q*65536}z[0]+=q-1+37*(q-1)}function W(z,q,D){const h=~(D-1);for(let A=0;A<16;A++){const ae=h&(z[A]^q[A]);z[A]^=ae,q[A]^=ae}}function ie(z,q){const D=o(),h=o();for(let A=0;A<16;A++)h[A]=q[A];M(h),M(h),M(h);for(let A=0;A<2;A++){D[0]=h[0]-65517;for(let de=1;de<15;de++)D[de]=h[de]-65535-(D[de-1]>>16&1),D[de-1]&=65535;D[15]=h[15]-32767-(D[14]>>16&1);const ae=D[15]>>16&1;D[14]&=65535,W(h,D,1-ae)}for(let A=0;A<16;A++)z[2*A]=h[A]&255,z[2*A+1]=h[A]>>8}function ce(z,q){let D=0;for(let h=0;h<32;h++)D|=z[h]^q[h];return(1&D-1>>>8)-1}function u(z,q){const D=new Uint8Array(32),h=new Uint8Array(32);return ie(D,z),ie(h,q),ce(D,h)}function d(z){const q=new Uint8Array(32);return ie(q,z),q[0]&1}function m(z,q){for(let D=0;D<16;D++)z[D]=q[2*D]+(q[2*D+1]<<8);z[15]&=32767}function g(z,q,D){for(let h=0;h<16;h++)z[h]=q[h]+D[h]}function p(z,q,D){for(let h=0;h<16;h++)z[h]=q[h]-D[h]}function N(z,q,D){let h,A,ae=0,de=0,ve=0,Re=0,$e=0,Se=0,xt=0,wt=0,at=0,Ue=0,Je=0,Ye=0,ot=0,ze=0,Ze=0,Ce=0,Ke=0,lt=0,Le=0,Pt=0,Dt=0,Ft=0,Ht=0,Lt=0,Yt=0,ar=0,Hr=0,Zt=0,Jr=0,di=0,Ni=0,ft=D[0],rt=D[1],dt=D[2],pt=D[3],ct=D[4],it=D[5],Ot=D[6],Nt=D[7],gt=D[8],Tt=D[9],mt=D[10],bt=D[11],yt=D[12],Qe=D[13],At=D[14],Rt=D[15];h=q[0],ae+=h*ft,de+=h*rt,ve+=h*dt,Re+=h*pt,$e+=h*ct,Se+=h*it,xt+=h*Ot,wt+=h*Nt,at+=h*gt,Ue+=h*Tt,Je+=h*mt,Ye+=h*bt,ot+=h*yt,ze+=h*Qe,Ze+=h*At,Ce+=h*Rt,h=q[1],de+=h*ft,ve+=h*rt,Re+=h*dt,$e+=h*pt,Se+=h*ct,xt+=h*it,wt+=h*Ot,at+=h*Nt,Ue+=h*gt,Je+=h*Tt,Ye+=h*mt,ot+=h*bt,ze+=h*yt,Ze+=h*Qe,Ce+=h*At,Ke+=h*Rt,h=q[2],ve+=h*ft,Re+=h*rt,$e+=h*dt,Se+=h*pt,xt+=h*ct,wt+=h*it,at+=h*Ot,Ue+=h*Nt,Je+=h*gt,Ye+=h*Tt,ot+=h*mt,ze+=h*bt,Ze+=h*yt,Ce+=h*Qe,Ke+=h*At,lt+=h*Rt,h=q[3],Re+=h*ft,$e+=h*rt,Se+=h*dt,xt+=h*pt,wt+=h*ct,at+=h*it,Ue+=h*Ot,Je+=h*Nt,Ye+=h*gt,ot+=h*Tt,ze+=h*mt,Ze+=h*bt,Ce+=h*yt,Ke+=h*Qe,lt+=h*At,Le+=h*Rt,h=q[4],$e+=h*ft,Se+=h*rt,xt+=h*dt,wt+=h*pt,at+=h*ct,Ue+=h*it,Je+=h*Ot,Ye+=h*Nt,ot+=h*gt,ze+=h*Tt,Ze+=h*mt,Ce+=h*bt,Ke+=h*yt,lt+=h*Qe,Le+=h*At,Pt+=h*Rt,h=q[5],Se+=h*ft,xt+=h*rt,wt+=h*dt,at+=h*pt,Ue+=h*ct,Je+=h*it,Ye+=h*Ot,ot+=h*Nt,ze+=h*gt,Ze+=h*Tt,Ce+=h*mt,Ke+=h*bt,lt+=h*yt,Le+=h*Qe,Pt+=h*At,Dt+=h*Rt,h=q[6],xt+=h*ft,wt+=h*rt,at+=h*dt,Ue+=h*pt,Je+=h*ct,Ye+=h*it,ot+=h*Ot,ze+=h*Nt,Ze+=h*gt,Ce+=h*Tt,Ke+=h*mt,lt+=h*bt,Le+=h*yt,Pt+=h*Qe,Dt+=h*At,Ft+=h*Rt,h=q[7],wt+=h*ft,at+=h*rt,Ue+=h*dt,Je+=h*pt,Ye+=h*ct,ot+=h*it,ze+=h*Ot,Ze+=h*Nt,Ce+=h*gt,Ke+=h*Tt,lt+=h*mt,Le+=h*bt,Pt+=h*yt,Dt+=h*Qe,Ft+=h*At,Ht+=h*Rt,h=q[8],at+=h*ft,Ue+=h*rt,Je+=h*dt,Ye+=h*pt,ot+=h*ct,ze+=h*it,Ze+=h*Ot,Ce+=h*Nt,Ke+=h*gt,lt+=h*Tt,Le+=h*mt,Pt+=h*bt,Dt+=h*yt,Ft+=h*Qe,Ht+=h*At,Lt+=h*Rt,h=q[9],Ue+=h*ft,Je+=h*rt,Ye+=h*dt,ot+=h*pt,ze+=h*ct,Ze+=h*it,Ce+=h*Ot,Ke+=h*Nt,lt+=h*gt,Le+=h*Tt,Pt+=h*mt,Dt+=h*bt,Ft+=h*yt,Ht+=h*Qe,Lt+=h*At,Yt+=h*Rt,h=q[10],Je+=h*ft,Ye+=h*rt,ot+=h*dt,ze+=h*pt,Ze+=h*ct,Ce+=h*it,Ke+=h*Ot,lt+=h*Nt,Le+=h*gt,Pt+=h*Tt,Dt+=h*mt,Ft+=h*bt,Ht+=h*yt,Lt+=h*Qe,Yt+=h*At,ar+=h*Rt,h=q[11],Ye+=h*ft,ot+=h*rt,ze+=h*dt,Ze+=h*pt,Ce+=h*ct,Ke+=h*it,lt+=h*Ot,Le+=h*Nt,Pt+=h*gt,Dt+=h*Tt,Ft+=h*mt,Ht+=h*bt,Lt+=h*yt,Yt+=h*Qe,ar+=h*At,Hr+=h*Rt,h=q[12],ot+=h*ft,ze+=h*rt,Ze+=h*dt,Ce+=h*pt,Ke+=h*ct,lt+=h*it,Le+=h*Ot,Pt+=h*Nt,Dt+=h*gt,Ft+=h*Tt,Ht+=h*mt,Lt+=h*bt,Yt+=h*yt,ar+=h*Qe,Hr+=h*At,Zt+=h*Rt,h=q[13],ze+=h*ft,Ze+=h*rt,Ce+=h*dt,Ke+=h*pt,lt+=h*ct,Le+=h*it,Pt+=h*Ot,Dt+=h*Nt,Ft+=h*gt,Ht+=h*Tt,Lt+=h*mt,Yt+=h*bt,ar+=h*yt,Hr+=h*Qe,Zt+=h*At,Jr+=h*Rt,h=q[14],Ze+=h*ft,Ce+=h*rt,Ke+=h*dt,lt+=h*pt,Le+=h*ct,Pt+=h*it,Dt+=h*Ot,Ft+=h*Nt,Ht+=h*gt,Lt+=h*Tt,Yt+=h*mt,ar+=h*bt,Hr+=h*yt,Zt+=h*Qe,Jr+=h*At,di+=h*Rt,h=q[15],Ce+=h*ft,Ke+=h*rt,lt+=h*dt,Le+=h*pt,Pt+=h*ct,Dt+=h*it,Ft+=h*Ot,Ht+=h*Nt,Lt+=h*gt,Yt+=h*Tt,ar+=h*mt,Hr+=h*bt,Zt+=h*yt,Jr+=h*Qe,di+=h*At,Ni+=h*Rt,ae+=38*Ke,de+=38*lt,ve+=38*Le,Re+=38*Pt,$e+=38*Dt,Se+=38*Ft,xt+=38*Ht,wt+=38*Lt,at+=38*Yt,Ue+=38*ar,Je+=38*Hr,Ye+=38*Zt,ot+=38*Jr,ze+=38*di,Ze+=38*Ni,A=1,h=ae+A+65535,A=Math.floor(h/65536),ae=h-A*65536,h=de+A+65535,A=Math.floor(h/65536),de=h-A*65536,h=ve+A+65535,A=Math.floor(h/65536),ve=h-A*65536,h=Re+A+65535,A=Math.floor(h/65536),Re=h-A*65536,h=$e+A+65535,A=Math.floor(h/65536),$e=h-A*65536,h=Se+A+65535,A=Math.floor(h/65536),Se=h-A*65536,h=xt+A+65535,A=Math.floor(h/65536),xt=h-A*65536,h=wt+A+65535,A=Math.floor(h/65536),wt=h-A*65536,h=at+A+65535,A=Math.floor(h/65536),at=h-A*65536,h=Ue+A+65535,A=Math.floor(h/65536),Ue=h-A*65536,h=Je+A+65535,A=Math.floor(h/65536),Je=h-A*65536,h=Ye+A+65535,A=Math.floor(h/65536),Ye=h-A*65536,h=ot+A+65535,A=Math.floor(h/65536),ot=h-A*65536,h=ze+A+65535,A=Math.floor(h/65536),ze=h-A*65536,h=Ze+A+65535,A=Math.floor(h/65536),Ze=h-A*65536,h=Ce+A+65535,A=Math.floor(h/65536),Ce=h-A*65536,ae+=A-1+37*(A-1),A=1,h=ae+A+65535,A=Math.floor(h/65536),ae=h-A*65536,h=de+A+65535,A=Math.floor(h/65536),de=h-A*65536,h=ve+A+65535,A=Math.floor(h/65536),ve=h-A*65536,h=Re+A+65535,A=Math.floor(h/65536),Re=h-A*65536,h=$e+A+65535,A=Math.floor(h/65536),$e=h-A*65536,h=Se+A+65535,A=Math.floor(h/65536),Se=h-A*65536,h=xt+A+65535,A=Math.floor(h/65536),xt=h-A*65536,h=wt+A+65535,A=Math.floor(h/65536),wt=h-A*65536,h=at+A+65535,A=Math.floor(h/65536),at=h-A*65536,h=Ue+A+65535,A=Math.floor(h/65536),Ue=h-A*65536,h=Je+A+65535,A=Math.floor(h/65536),Je=h-A*65536,h=Ye+A+65535,A=Math.floor(h/65536),Ye=h-A*65536,h=ot+A+65535,A=Math.floor(h/65536),ot=h-A*65536,h=ze+A+65535,A=Math.floor(h/65536),ze=h-A*65536,h=Ze+A+65535,A=Math.floor(h/65536),Ze=h-A*65536,h=Ce+A+65535,A=Math.floor(h/65536),Ce=h-A*65536,ae+=A-1+37*(A-1),z[0]=ae,z[1]=de,z[2]=ve,z[3]=Re,z[4]=$e,z[5]=Se,z[6]=xt,z[7]=wt,z[8]=at,z[9]=Ue,z[10]=Je,z[11]=Ye,z[12]=ot,z[13]=ze,z[14]=Ze,z[15]=Ce}function x(z,q){N(z,q,q)}function Q(z,q){const D=o();let h;for(h=0;h<16;h++)D[h]=q[h];for(h=253;h>=0;h--)x(D,D),h!==2&&h!==4&&N(D,D,q);for(h=0;h<16;h++)z[h]=D[h]}function se(z,q){const D=o();let h;for(h=0;h<16;h++)D[h]=q[h];for(h=250;h>=0;h--)x(D,D),h!==1&&N(D,D,q);for(h=0;h<16;h++)z[h]=D[h]}function Ee(z,q){const D=o(),h=o(),A=o(),ae=o(),de=o(),ve=o(),Re=o(),$e=o(),Se=o();p(D,z[1],z[0]),p(Se,q[1],q[0]),N(D,D,Se),g(h,z[0],z[1]),g(Se,q[0],q[1]),N(h,h,Se),N(A,z[3],q[3]),N(A,A,_),N(ae,z[2],q[2]),g(ae,ae,ae),p(de,h,D),p(ve,ae,A),g(Re,ae,A),g($e,h,D),N(z[0],de,ve),N(z[1],$e,Re),N(z[2],Re,ve),N(z[3],de,$e)}function Te(z,q,D){for(let h=0;h<4;h++)W(z[h],q[h],D)}function tt(z,q){const D=o(),h=o(),A=o();Q(A,q[2]),N(D,q[0],A),N(h,q[1],A),ie(z,h),z[31]^=d(D)<<7}function L(z,q,D){H(z[0],y),H(z[1],b),H(z[2],b),H(z[3],y);for(let h=255;h>=0;--h){const A=D[h/8|0]>>(h&7)&1;Te(z,q,A),Ee(q,z),Ee(z,z),Te(z,q,A)}}function V(z,q){const D=[o(),o(),o(),o()];H(D[0],E),H(D[1],O),H(D[2],b),N(D[3],E,O),L(z,D,q)}function Me(z){if(z.length!==s.SEED_LENGTH)throw new Error(`ed25519: seed must be ${s.SEED_LENGTH} bytes`);const q=(0,r.hash)(z);q[0]&=248,q[31]&=127,q[31]|=64;const D=new Uint8Array(32),h=[o(),o(),o(),o()];V(h,q),tt(D,h);const A=new Uint8Array(64);return A.set(z),A.set(D,32),{publicKey:D,secretKey:A}}s.generateKeyPairFromSeed=Me;function Ae(z){const q=(0,t.randomBytes)(32,z),D=Me(q);return(0,n.wipe)(q),D}s.generateKeyPair=Ae;function ee(z){if(z.length!==s.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${s.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(z.subarray(32))}s.extractPublicKeyFromSecretKey=ee;const Y=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function J(z,q){let D,h,A,ae;for(h=63;h>=32;--h){for(D=0,A=h-32,ae=h-12;A<ae;++A)q[A]+=D-16*q[h]*Y[A-(h-32)],D=Math.floor((q[A]+128)/256),q[A]-=D*256;q[A]+=D,q[h]=0}for(D=0,A=0;A<32;A++)q[A]+=D-(q[31]>>4)*Y[A],D=q[A]>>8,q[A]&=255;for(A=0;A<32;A++)q[A]-=D*Y[A];for(h=0;h<32;h++)q[h+1]+=q[h]>>8,z[h]=q[h]&255}function Z(z){const q=new Float64Array(64);for(let D=0;D<64;D++)q[D]=z[D];for(let D=0;D<64;D++)z[D]=0;J(z,q)}function ht(z,q){const D=new Float64Array(64),h=[o(),o(),o(),o()],A=(0,r.hash)(z.subarray(0,32));A[0]&=248,A[31]&=127,A[31]|=64;const ae=new Uint8Array(64);ae.set(A.subarray(32),32);const de=new r.SHA512;de.update(ae.subarray(32)),de.update(q);const ve=de.digest();de.clean(),Z(ve),V(h,ve),tt(ae,h),de.reset(),de.update(ae.subarray(0,32)),de.update(z.subarray(32)),de.update(q);const Re=de.digest();Z(Re);for(let $e=0;$e<32;$e++)D[$e]=ve[$e];for(let $e=0;$e<32;$e++)for(let Se=0;Se<32;Se++)D[$e+Se]+=Re[$e]*A[Se];return J(ae.subarray(32),D),ae}s.sign=ht;function ke(z,q){const D=o(),h=o(),A=o(),ae=o(),de=o(),ve=o(),Re=o();return H(z[2],b),m(z[1],q),x(A,z[1]),N(ae,A,P),p(A,A,z[2]),g(ae,z[2],ae),x(de,ae),x(ve,de),N(Re,ve,de),N(D,Re,A),N(D,D,ae),se(D,D),N(D,D,A),N(D,D,ae),N(D,D,ae),N(z[0],D,ae),x(h,z[0]),N(h,h,ae),u(h,A)&&N(z[0],z[0],U),x(h,z[0]),N(h,h,ae),u(h,A)?-1:(d(z[0])===q[31]>>7&&p(z[0],y,z[0]),N(z[3],z[0],z[1]),0)}function Fr(z,q,D){const h=new Uint8Array(32),A=[o(),o(),o(),o()],ae=[o(),o(),o(),o()];if(D.length!==s.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${s.SIGNATURE_LENGTH} bytes`);if(ke(ae,z))return!1;const de=new r.SHA512;de.update(D.subarray(0,32)),de.update(z),de.update(q);const ve=de.digest();return Z(ve),L(A,ae,ve),V(ae,D.subarray(32)),Ee(A,ae),tt(h,A),!ce(D,h)}s.verify=Fr;function be(z){let q=[o(),o(),o(),o()];if(ke(q,z))throw new Error("Ed25519: invalid public key");let D=o(),h=o(),A=q[1];g(D,b,A),p(h,b,A),Q(h,h),N(D,D,h);let ae=new Uint8Array(32);return ie(ae,D),ae}s.convertPublicKeyToX25519=be;function St(z){const q=(0,r.hash)(z.subarray(0,32));q[0]&=248,q[31]&=127,q[31]|=64;const D=new Uint8Array(q.subarray(0,32));return(0,n.wipe)(q),D}s.convertSecretKeyToX25519=St})(ru);const _b="EdDSA",Eb="JWT",Mf=".",zf="base64url",Ib="utf8",Sb="utf8",xb=":",Pb="did",Ob="key",Nl="base58btc",Nb="z",Tb="K36",Ab=32;function xa(s){return Jt(nr(ss(s),Ib),zf)}function Ff(s){const t=nr(Tb,Nl),r=Nb+Jt(jc([t,s]),Nl);return[Pb,Ob,r].join(xb)}function Rb(s){return Jt(s,zf)}function Cb(s){return nr([xa(s.header),xa(s.payload)].join(Mf),Sb)}function $b(s){return[xa(s.header),xa(s.payload),Rb(s.signature)].join(Mf)}function Tl(s=Ua.randomBytes(Ab)){return ru.generateKeyPairFromSeed(s)}async function Db(s,t,r,n,o=ne.fromMiliseconds(Date.now())){const l={alg:_b,typ:Eb},y=Ff(n.publicKey),b=o+r,P={iss:y,sub:s,aud:t,iat:o,exp:b},_=Cb({header:l,payload:P}),E=ru.sign(n.secretKey,_);return $b({header:l,payload:P,signature:E})}var rs={};(function(s){const t=$a,r=Da,n=Ra,o=Ca,l=u=>u==null,y=Symbol("encodeFragmentIdentifier");function b(u){switch(u.arrayFormat){case"index":return d=>(m,g)=>{const p=m.length;return g===void 0||u.skipNull&&g===null||u.skipEmptyString&&g===""?m:g===null?[...m,[E(d,u),"[",p,"]"].join("")]:[...m,[E(d,u),"[",E(p,u),"]=",E(g,u)].join("")]};case"bracket":return d=>(m,g)=>g===void 0||u.skipNull&&g===null||u.skipEmptyString&&g===""?m:g===null?[...m,[E(d,u),"[]"].join("")]:[...m,[E(d,u),"[]=",E(g,u)].join("")];case"colon-list-separator":return d=>(m,g)=>g===void 0||u.skipNull&&g===null||u.skipEmptyString&&g===""?m:g===null?[...m,[E(d,u),":list="].join("")]:[...m,[E(d,u),":list=",E(g,u)].join("")];case"comma":case"separator":case"bracket-separator":{const d=u.arrayFormat==="bracket-separator"?"[]=":"=";return m=>(g,p)=>p===void 0||u.skipNull&&p===null||u.skipEmptyString&&p===""?g:(p=p===null?"":p,g.length===0?[[E(m,u),d,E(p,u)].join("")]:[[g,E(p,u)].join(u.arrayFormatSeparator)])}default:return d=>(m,g)=>g===void 0||u.skipNull&&g===null||u.skipEmptyString&&g===""?m:g===null?[...m,E(d,u)]:[...m,[E(d,u),"=",E(g,u)].join("")]}}function P(u){let d;switch(u.arrayFormat){case"index":return(m,g,p)=>{if(d=/\[(\d*)\]$/.exec(m),m=m.replace(/\[\d*\]$/,""),!d){p[m]=g;return}p[m]===void 0&&(p[m]={}),p[m][d[1]]=g};case"bracket":return(m,g,p)=>{if(d=/(\[\])$/.exec(m),m=m.replace(/\[\]$/,""),!d){p[m]=g;return}if(p[m]===void 0){p[m]=[g];return}p[m]=[].concat(p[m],g)};case"colon-list-separator":return(m,g,p)=>{if(d=/(:list)$/.exec(m),m=m.replace(/:list$/,""),!d){p[m]=g;return}if(p[m]===void 0){p[m]=[g];return}p[m]=[].concat(p[m],g)};case"comma":case"separator":return(m,g,p)=>{const N=typeof g=="string"&&g.includes(u.arrayFormatSeparator),x=typeof g=="string"&&!N&&O(g,u).includes(u.arrayFormatSeparator);g=x?O(g,u):g;const Q=N||x?g.split(u.arrayFormatSeparator).map(se=>O(se,u)):g===null?g:O(g,u);p[m]=Q};case"bracket-separator":return(m,g,p)=>{const N=/(\[\])$/.test(m);if(m=m.replace(/\[\]$/,""),!N){p[m]=g&&O(g,u);return}const x=g===null?[]:g.split(u.arrayFormatSeparator).map(Q=>O(Q,u));if(p[m]===void 0){p[m]=x;return}p[m]=[].concat(p[m],x)};default:return(m,g,p)=>{if(p[m]===void 0){p[m]=g;return}p[m]=[].concat(p[m],g)}}}function _(u){if(typeof u!="string"||u.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function E(u,d){return d.encode?d.strict?t(u):encodeURIComponent(u):u}function O(u,d){return d.decode?r(u):u}function U(u){return Array.isArray(u)?u.sort():typeof u=="object"?U(Object.keys(u)).sort((d,m)=>Number(d)-Number(m)).map(d=>u[d]):u}function H(u){const d=u.indexOf("#");return d!==-1&&(u=u.slice(0,d)),u}function M(u){let d="";const m=u.indexOf("#");return m!==-1&&(d=u.slice(m)),d}function W(u){u=H(u);const d=u.indexOf("?");return d===-1?"":u.slice(d+1)}function ie(u,d){return d.parseNumbers&&!Number.isNaN(Number(u))&&typeof u=="string"&&u.trim()!==""?u=Number(u):d.parseBooleans&&u!==null&&(u.toLowerCase()==="true"||u.toLowerCase()==="false")&&(u=u.toLowerCase()==="true"),u}function ce(u,d){d=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},d),_(d.arrayFormatSeparator);const m=P(d),g=Object.create(null);if(typeof u!="string"||(u=u.trim().replace(/^[?#&]/,""),!u))return g;for(const p of u.split("&")){if(p==="")continue;let[N,x]=n(d.decode?p.replace(/\+/g," "):p,"=");x=x===void 0?null:["comma","separator","bracket-separator"].includes(d.arrayFormat)?x:O(x,d),m(O(N,d),x,g)}for(const p of Object.keys(g)){const N=g[p];if(typeof N=="object"&&N!==null)for(const x of Object.keys(N))N[x]=ie(N[x],d);else g[p]=ie(N,d)}return d.sort===!1?g:(d.sort===!0?Object.keys(g).sort():Object.keys(g).sort(d.sort)).reduce((p,N)=>{const x=g[N];return x&&typeof x=="object"&&!Array.isArray(x)?p[N]=U(x):p[N]=x,p},Object.create(null))}s.extract=W,s.parse=ce,s.stringify=(u,d)=>{if(!u)return"";d=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},d),_(d.arrayFormatSeparator);const m=x=>d.skipNull&&l(u[x])||d.skipEmptyString&&u[x]==="",g=b(d),p={};for(const x of Object.keys(u))m(x)||(p[x]=u[x]);const N=Object.keys(p);return d.sort!==!1&&N.sort(d.sort),N.map(x=>{const Q=u[x];return Q===void 0?"":Q===null?E(x,d):Array.isArray(Q)?Q.length===0&&d.arrayFormat==="bracket-separator"?E(x,d)+"[]":Q.reduce(g(x),[]).join("&"):E(x,d)+"="+E(Q,d)}).filter(x=>x.length>0).join("&")},s.parseUrl=(u,d)=>{d=Object.assign({decode:!0},d);const[m,g]=n(u,"#");return Object.assign({url:m.split("?")[0]||"",query:ce(W(u),d)},d&&d.parseFragmentIdentifier&&g?{fragmentIdentifier:O(g,d)}:{})},s.stringifyUrl=(u,d)=>{d=Object.assign({encode:!0,strict:!0,[y]:!0},d);const m=H(u.url).split("?")[0]||"",g=s.extract(u.url),p=s.parse(g,{sort:!1}),N=Object.assign(p,u.query);let x=s.stringify(N,d);x&&(x=`?${x}`);let Q=M(u.url);return u.fragmentIdentifier&&(Q=`#${d[y]?E(u.fragmentIdentifier,d):u.fragmentIdentifier}`),`${m}${x}${Q}`},s.pick=(u,d,m)=>{m=Object.assign({parseFragmentIdentifier:!0,[y]:!1},m);const{url:g,query:p,fragmentIdentifier:N}=s.parseUrl(u,m);return s.stringifyUrl({url:g,query:o(p,d),fragmentIdentifier:N},m)},s.exclude=(u,d,m)=>{const g=Array.isArray(d)?p=>!d.includes(p):(p,N)=>!d(p,N);return s.pick(u,g,m)}})(rs);const Hf="base10",sr="base16",Mc="base64pad",iu="utf8",kf=0,bn=1,Ub=0,Al=1,zc=12,nu=32;function jb(){const s=Of.generateKeyPair();return{privateKey:Jt(s.secretKey,sr),publicKey:Jt(s.publicKey,sr)}}function Fc(){const s=Ua.randomBytes(nu);return Jt(s,sr)}function Lb(s,t){const r=Of.sharedKey(nr(s,sr),nr(t,sr),!0),n=new hw(ja.SHA256,r).expand(nu);return Jt(n,sr)}function qb(s){const t=ja.hash(nr(s,sr));return Jt(t,sr)}function Hc(s){const t=ja.hash(nr(s,iu));return Jt(t,sr)}function Mb(s){return nr(`${s}`,Hf)}function os(s){return Number(Jt(s,Hf))}function zb(s){const t=Mb(typeof s.type<"u"?s.type:kf);if(os(t)===bn&&typeof s.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof s.senderPublicKey<"u"?nr(s.senderPublicKey,sr):void 0,n=typeof s.iv<"u"?nr(s.iv,sr):Ua.randomBytes(zc),o=new Nf.ChaCha20Poly1305(nr(s.symKey,sr)).seal(n,nr(s.message,iu));return Hb({type:t,sealed:o,iv:n,senderPublicKey:r})}function Fb(s){const t=new Nf.ChaCha20Poly1305(nr(s.symKey,sr)),{sealed:r,iv:n}=Pa(s.encoded),o=t.open(n,r);if(o===null)throw new Error("Failed to decrypt");return Jt(o,iu)}function Hb(s){if(os(s.type)===bn){if(typeof s.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return Jt(jc([s.type,s.senderPublicKey,s.iv,s.sealed]),Mc)}return Jt(jc([s.type,s.iv,s.sealed]),Mc)}function Pa(s){const t=nr(s,Mc),r=t.slice(Ub,Al),n=Al;if(os(r)===bn){const b=n+nu,P=b+zc,_=t.slice(n,b),E=t.slice(b,P),O=t.slice(P);return{type:r,sealed:O,iv:E,senderPublicKey:_}}const o=n+zc,l=t.slice(n,o),y=t.slice(o);return{type:r,sealed:y,iv:l}}function kb(s,t){const r=Pa(s);return Kf({type:os(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?Jt(r.senderPublicKey,sr):void 0,receiverPublicKey:t==null?void 0:t.receiverPublicKey})}function Kf(s){const t=(s==null?void 0:s.type)||kf;if(t===bn){if(typeof(s==null?void 0:s.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(s==null?void 0:s.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:t,senderPublicKey:s==null?void 0:s.senderPublicKey,receiverPublicKey:s==null?void 0:s.receiverPublicKey}}function Rl(s){return s.type===bn&&typeof s.senderPublicKey=="string"&&typeof s.receiverPublicKey=="string"}var Kb=Object.defineProperty,Cl=Object.getOwnPropertySymbols,Vb=Object.prototype.hasOwnProperty,Bb=Object.prototype.propertyIsEnumerable,$l=(s,t,r)=>t in s?Kb(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,Dl=(s,t)=>{for(var r in t||(t={}))Vb.call(t,r)&&$l(s,r,t[r]);if(Cl)for(var r of Cl(t))Bb.call(t,r)&&$l(s,r,t[r]);return s};const Gb="ReactNative",zr={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},Wb="js";function su(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function _n(){return!Tf()&&!!La()&&navigator.product===Gb}function Ma(){return!su()&&!!La()}function za(){return _n()?zr.reactNative:su()?zr.node:Ma()?zr.browser:zr.unknown}function Qb(){var s;try{return _n()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(s=global.Application)==null?void 0:s.applicationId:void 0}catch{return}}function Jb(s,t){let r=rs.parse(s);return r=Dl(Dl({},r),t),s=rs.stringify(r),s}function Yb(){if(za()===zr.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:n}=global.Platform;return[r,n].join("-")}const s=gw();if(s===null)return"unknown";const t=s.os?s.os.replace(" ","").toLowerCase():"unknown";return s.type==="browser"?[t,s.name,s.version].join("-"):[t,s.version].join("-")}function Zb(){var s;const t=za();return t===zr.browser?[t,((s=lw())==null?void 0:s.host)||"unknown"].join(":"):t}function Xb(s,t,r){const n=Yb(),o=Zb();return[[s,t].join("-"),[Wb,r].join("-"),n,o].join("/")}function e_({protocol:s,version:t,relayUrl:r,sdkVersion:n,auth:o,projectId:l,useOnCloseEvent:y,bundleId:b}){const P=r.split("?"),_=Xb(s,t,n),E={auth:o,ua:_,projectId:l,useOnCloseEvent:y||void 0,origin:b||void 0},O=Jb(P[1]||"",E);return P[0]+"?"+O}function Vf(s){return Object.fromEntries(s.entries())}function Bf(s){return new Map(Object.entries(s))}function t_(s=ne.FIVE_MINUTES,t){const r=ne.toMiliseconds(s||ne.FIVE_MINUTES);let n,o,l;return{resolve:y=>{l&&n&&(clearTimeout(l),n(y))},reject:y=>{l&&o&&(clearTimeout(l),o(y))},done:()=>new Promise((y,b)=>{l=setTimeout(()=>{b(new Error(t))},r),n=y,o=b})}}function is(s,t,r){return new Promise(async(n,o)=>{const l=setTimeout(()=>o(new Error(r)),t);try{const y=await s;n(y)}catch(y){o(y)}clearTimeout(l)})}function Gf(s,t){if(typeof t=="string"&&t.startsWith(`${s}:`))return t;if(s.toLowerCase()==="topic"){if(typeof t!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${t}`}else if(s.toLowerCase()==="id"){if(typeof t!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${t}`}throw new Error(`Unknown expirer target type: ${s}`)}function r_(s){return Gf("topic",s)}function i_(s){return Gf("id",s)}function n_(s){const[t,r]=s.split(":"),n={id:void 0,topic:void 0};if(t==="topic"&&typeof r=="string")n.topic=r;else if(t==="id"&&Number.isInteger(Number(r)))n.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${t}:${r}`);return n}function Ea(s,t){return ne.fromMiliseconds((t||Date.now())+ne.toMiliseconds(s))}function Ul(s){return Date.now()>=ne.toMiliseconds(s)}function Ec(s,t){return`${s}${t?`:${t}`:""}`}const s_="irn";function kc(s){return(s==null?void 0:s.relay)||{protocol:s_}}function Ia(s){const t=_w[s];if(typeof t>"u")throw new Error(`Relay Protocol not supported: ${s}`);return t}var a_=Object.defineProperty,jl=Object.getOwnPropertySymbols,o_=Object.prototype.hasOwnProperty,c_=Object.prototype.propertyIsEnumerable,Ll=(s,t,r)=>t in s?a_(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,u_=(s,t)=>{for(var r in t||(t={}))o_.call(t,r)&&Ll(s,r,t[r]);if(jl)for(var r of jl(t))c_.call(t,r)&&Ll(s,r,t[r]);return s};function h_(s,t="-"){const r={},n="relay"+t;return Object.keys(s).forEach(o=>{if(o.startsWith(n)){const l=o.replace(n,""),y=s[o];r[l]=y}}),r}function ql(s){s=s.includes("wc://")?s.replace("wc://",""):s,s=s.includes("wc:")?s.replace("wc:",""):s;const t=s.indexOf(":"),r=s.indexOf("?")!==-1?s.indexOf("?"):void 0,n=s.substring(0,t),o=s.substring(t+1,r).split("@"),l=typeof r<"u"?s.substring(r):"",y=rs.parse(l);return{protocol:n,topic:l_(o[0]),version:parseInt(o[1],10),symKey:y.symKey,relay:h_(y)}}function l_(s){return s.startsWith("//")?s.substring(2):s}function f_(s,t="-"){const r="relay",n={};return Object.keys(s).forEach(o=>{const l=r+t+o;s[o]&&(n[l]=s[o])}),n}function d_(s){return`${s.protocol}:${s.topic}@${s.version}?`+rs.stringify(u_({symKey:s.symKey},f_(s.relay)))}const p_={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},g_={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function He(s,t){const{message:r,code:n}=g_[s];return{message:t?`${r} ${t}`:r,code:n}}function Jn(s,t){const{message:r,code:n}=p_[s];return{message:t?`${r} ${t}`:r,code:n}}function m_(s,t){return Array.isArray(s)?typeof t<"u"&&s.length?s.every(t):!0:!1}function Oa(s){return typeof s>"u"}function Wf(s,t){return t&&Oa(s)?!0:typeof s=="string"&&!!s.trim().length}function y_(s){if(Wf(s,!1))try{return typeof new URL(s)<"u"}catch{return!1}return!1}function v_(s){var t;return(t=s==null?void 0:s.proposer)==null?void 0:t.publicKey}function w_(s){return s==null?void 0:s.topic}function Ic(s){return typeof s<"u"&&typeof s!==null}function Ml(){const s=za();return new Promise(t=>{switch(s){case zr.browser:t(b_());break;case zr.reactNative:t(__());break;case zr.node:t(E_());break;default:t(!0)}})}function b_(){return Ma()&&(navigator==null?void 0:navigator.onLine)}async function __(){if(_n()&&typeof global<"u"&&global!=null&&global.NetInfo){const s=await(global==null?void 0:global.NetInfo.fetch());return s==null?void 0:s.isConnected}return!0}function E_(){return!0}function I_(s){switch(za()){case zr.browser:S_(s);break;case zr.reactNative:x_(s);break}}function S_(s){!_n()&&Ma()&&(window.addEventListener("online",()=>s(!0)),window.addEventListener("offline",()=>s(!1)))}function x_(s){_n()&&typeof global<"u"&&global!=null&&global.NetInfo&&(global==null||global.NetInfo.addEventListener(t=>s(t==null?void 0:t.isConnected)))}const P_=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),O_=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",zl=s=>s.split("?")[0],Fl=10,N_=P_();let T_=class{constructor(t){if(this.url=t,this.events=new Qr.EventEmitter,this.registering=!1,!fl(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);this.url=t}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){return new Promise((t,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),t()},this.socket.close()})}async send(t){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(ss(t))}catch(r){this.onError(t.id,r)}}register(t=this.url){if(!fl(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,o)=>{this.events.once("register_error",l=>{this.resetMaxListeners(),o(l)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return o(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=t,this.registering=!0,new Promise((r,n)=>{const o=new URLSearchParams(t).get("origin"),l=mw.isReactNative()?{headers:{origin:o}}:{rejectUnauthorized:!yw(t)},y=new N_(t,[],l);O_()?y.onerror=b=>{const P=b;n(this.emitError(P.error))}:y.on("error",b=>{n(this.emitError(b))}),y.onopen=()=>{this.onOpen(y),r(y)}})}onOpen(t){t.onmessage=r=>this.onPayload(r),t.onclose=r=>this.onClose(r),this.socket=t,this.registering=!1,this.events.emit("open")}onClose(t){this.socket=void 0,this.registering=!1,this.events.emit("close",t)}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?qa(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const n=this.parseError(r),o=n.message||n.toString(),l=Yc(t,o);this.events.emit("payload",l)}parseError(t,r=this.url){return vw(t,zl(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Fl&&this.events.setMaxListeners(Fl)}emitError(t){const r=this.parseError(new Error((t==null?void 0:t.message)||`WebSocket connection failed for host: ${zl(this.url)}`));return this.events.emit("register_error",r),r}};var Na={exports:{}};Na.exports;(function(s,t){var r=200,n="__lodash_hash_undefined__",o=1,l=2,y=9007199254740991,b="[object Arguments]",P="[object Array]",_="[object AsyncFunction]",E="[object Boolean]",O="[object Date]",U="[object Error]",H="[object Function]",M="[object GeneratorFunction]",W="[object Map]",ie="[object Number]",ce="[object Null]",u="[object Object]",d="[object Promise]",m="[object Proxy]",g="[object RegExp]",p="[object Set]",N="[object String]",x="[object Symbol]",Q="[object Undefined]",se="[object WeakMap]",Ee="[object ArrayBuffer]",Te="[object DataView]",tt="[object Float32Array]",L="[object Float64Array]",V="[object Int8Array]",Me="[object Int16Array]",Ae="[object Int32Array]",ee="[object Uint8Array]",Y="[object Uint8ClampedArray]",J="[object Uint16Array]",Z="[object Uint32Array]",ht=/[\\^$.*+?()[\]{}|]/g,ke=/^\[object .+?Constructor\]$/,Fr=/^(?:0|[1-9]\d*)$/,be={};be[tt]=be[L]=be[V]=be[Me]=be[Ae]=be[ee]=be[Y]=be[J]=be[Z]=!0,be[b]=be[P]=be[Ee]=be[E]=be[Te]=be[O]=be[U]=be[H]=be[W]=be[ie]=be[u]=be[g]=be[p]=be[N]=be[se]=!1;var St=typeof da=="object"&&da&&da.Object===Object&&da,z=typeof self=="object"&&self&&self.Object===Object&&self,q=St||z||Function("return this")(),D=t&&!t.nodeType&&t,h=D&&!0&&s&&!s.nodeType&&s,A=h&&h.exports===D,ae=A&&St.process,de=function(){try{return ae&&ae.binding&&ae.binding("util")}catch{}}(),ve=de&&de.isTypedArray;function Re(I,R){for(var B=-1,te=I==null?0:I.length,Be=0,ge=[];++B<te;){var Xe=I[B];R(Xe,B,I)&&(ge[Be++]=Xe)}return ge}function $e(I,R){for(var B=-1,te=R.length,Be=I.length;++B<te;)I[Be+B]=R[B];return I}function Se(I,R){for(var B=-1,te=I==null?0:I.length;++B<te;)if(R(I[B],B,I))return!0;return!1}function xt(I,R){for(var B=-1,te=Array(I);++B<I;)te[B]=R(B);return te}function wt(I){return function(R){return I(R)}}function at(I,R){return I.has(R)}function Ue(I,R){return I==null?void 0:I[R]}function Je(I){var R=-1,B=Array(I.size);return I.forEach(function(te,Be){B[++R]=[Be,te]}),B}function Ye(I,R){return function(B){return I(R(B))}}function ot(I){var R=-1,B=Array(I.size);return I.forEach(function(te){B[++R]=te}),B}var ze=Array.prototype,Ze=Function.prototype,Ce=Object.prototype,Ke=q["__core-js_shared__"],lt=Ze.toString,Le=Ce.hasOwnProperty,Pt=function(){var I=/[^.]+$/.exec(Ke&&Ke.keys&&Ke.keys.IE_PROTO||"");return I?"Symbol(src)_1."+I:""}(),Dt=Ce.toString,Ft=RegExp("^"+lt.call(Le).replace(ht,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ht=A?q.Buffer:void 0,Lt=q.Symbol,Yt=q.Uint8Array,ar=Ce.propertyIsEnumerable,Hr=ze.splice,Zt=Lt?Lt.toStringTag:void 0,Jr=Object.getOwnPropertySymbols,di=Ht?Ht.isBuffer:void 0,Ni=Ye(Object.keys,Object),ft=pr(q,"DataView"),rt=pr(q,"Map"),dt=pr(q,"Promise"),pt=pr(q,"Set"),ct=pr(q,"WeakMap"),it=pr(Object,"create"),Ot=Zr(ft),Nt=Zr(rt),gt=Zr(dt),Tt=Zr(pt),mt=Zr(ct),bt=Lt?Lt.prototype:void 0,yt=bt?bt.valueOf:void 0;function Qe(I){var R=-1,B=I==null?0:I.length;for(this.clear();++R<B;){var te=I[R];this.set(te[0],te[1])}}function At(){this.__data__=it?it(null):{},this.size=0}function Rt(I){var R=this.has(I)&&delete this.__data__[I];return this.size-=R?1:0,R}function Ka(I){var R=this.__data__;if(it){var B=R[I];return B===n?void 0:B}return Le.call(R,I)?R[I]:void 0}function Va(I){var R=this.__data__;return it?R[I]!==void 0:Le.call(R,I)}function Ba(I,R){var B=this.__data__;return this.size+=this.has(I)?0:1,B[I]=it&&R===void 0?n:R,this}Qe.prototype.clear=At,Qe.prototype.delete=Rt,Qe.prototype.get=Ka,Qe.prototype.has=Va,Qe.prototype.set=Ba;function _r(I){var R=-1,B=I==null?0:I.length;for(this.clear();++R<B;){var te=I[R];this.set(te[0],te[1])}}function Ga(){this.__data__=[],this.size=0}function Wa(I){var R=this.__data__,B=Ti(R,I);if(B<0)return!1;var te=R.length-1;return B==te?R.pop():Hr.call(R,B,1),--this.size,!0}function Qa(I){var R=this.__data__,B=Ti(R,I);return B<0?void 0:R[B][1]}function Ja(I){return Ti(this.__data__,I)>-1}function Ya(I,R){var B=this.__data__,te=Ti(B,I);return te<0?(++this.size,B.push([I,R])):B[te][1]=R,this}_r.prototype.clear=Ga,_r.prototype.delete=Wa,_r.prototype.get=Qa,_r.prototype.has=Ja,_r.prototype.set=Ya;function Yr(I){var R=-1,B=I==null?0:I.length;for(this.clear();++R<B;){var te=I[R];this.set(te[0],te[1])}}function Qi(){this.size=0,this.__data__={hash:new Qe,map:new(rt||_r),string:new Qe}}function Za(I){var R=pi(this,I).delete(I);return this.size-=R?1:0,R}function Ji(I){return pi(this,I).get(I)}function Xa(I){return pi(this,I).has(I)}function eo(I,R){var B=pi(this,I),te=B.size;return B.set(I,R),this.size+=B.size==te?0:1,this}Yr.prototype.clear=Qi,Yr.prototype.delete=Za,Yr.prototype.get=Ji,Yr.prototype.has=Xa,Yr.prototype.set=eo;function Yi(I){var R=-1,B=I==null?0:I.length;for(this.__data__=new Yr;++R<B;)this.add(I[R])}function us(I){return this.__data__.set(I,n),this}function hs(I){return this.__data__.has(I)}Yi.prototype.add=Yi.prototype.push=us,Yi.prototype.has=hs;function Cr(I){var R=this.__data__=new _r(I);this.size=R.size}function to(){this.__data__=new _r,this.size=0}function ro(I){var R=this.__data__,B=R.delete(I);return this.size=R.size,B}function io(I){return this.__data__.get(I)}function no(I){return this.__data__.has(I)}function ls(I,R){var B=this.__data__;if(B instanceof _r){var te=B.__data__;if(!rt||te.length<r-1)return te.push([I,R]),this.size=++B.size,this;B=this.__data__=new Yr(te)}return B.set(I,R),this.size=B.size,this}Cr.prototype.clear=to,Cr.prototype.delete=ro,Cr.prototype.get=io,Cr.prototype.has=no,Cr.prototype.set=ls;function fs(I,R){var B=en(I),te=!B&&Ss(I),Be=!B&&!te&&xn(I),ge=!B&&!te&&!Be&&Os(I),Xe=B||te||Be||ge,Ct=Xe?xt(I.length,String):[],Pe=Ct.length;for(var Ge in I)(R||Le.call(I,Ge))&&!(Xe&&(Ge=="length"||Be&&(Ge=="offset"||Ge=="parent")||ge&&(Ge=="buffer"||Ge=="byteLength"||Ge=="byteOffset")||ws(Ge,Pe)))&&Ct.push(Ge);return Ct}function Ti(I,R){for(var B=I.length;B--;)if(Is(I[B][0],R))return B;return-1}function In(I,R,B){var te=R(I);return en(I)?te:$e(te,B(I))}function Ai(I){return I==null?I===void 0?Q:ce:Zt&&Zt in Object(I)?ys(I):oo(I)}function Sn(I){return Ci(I)&&Ai(I)==b}function Ri(I,R,B,te,Be){return I===R?!0:I==null||R==null||!Ci(I)&&!Ci(R)?I!==I&&R!==R:ds(I,R,B,te,Ri,Be)}function ds(I,R,B,te,Be,ge){var Xe=en(I),Ct=en(R),Pe=Xe?P:kr(I),Ge=Ct?P:kr(R);Pe=Pe==b?u:Pe,Ge=Ge==b?u:Ge;var _t=Pe==u,or=Ge==u,$t=Pe==Ge;if($t&&xn(I)){if(!xn(R))return!1;Xe=!0,_t=!1}if($t&&!_t)return ge||(ge=new Cr),Xe||Os(I)?Zi(I,R,B,te,Be,ge):ao(I,R,Pe,B,te,Be,ge);if(!(B&o)){var et=_t&&Le.call(I,"__wrapped__"),Xt=or&&Le.call(R,"__wrapped__");if(et||Xt){var $r=et?I.value():I,Er=Xt?R.value():R;return ge||(ge=new Cr),Be($r,Er,B,te,ge)}}return $t?(ge||(ge=new Cr),ms(I,R,B,te,Be,ge)):!1}function so(I){if(!Ps(I)||_s(I))return!1;var R=tn(I)?Ft:ke;return R.test(Zr(I))}function ps(I){return Ci(I)&&xs(I.length)&&!!be[Ai(I)]}function gs(I){if(!Es(I))return Ni(I);var R=[];for(var B in Object(I))Le.call(I,B)&&B!="constructor"&&R.push(B);return R}function Zi(I,R,B,te,Be,ge){var Xe=B&o,Ct=I.length,Pe=R.length;if(Ct!=Pe&&!(Xe&&Pe>Ct))return!1;var Ge=ge.get(I);if(Ge&&ge.get(R))return Ge==R;var _t=-1,or=!0,$t=B&l?new Yi:void 0;for(ge.set(I,R),ge.set(R,I);++_t<Ct;){var et=I[_t],Xt=R[_t];if(te)var $r=Xe?te(Xt,et,_t,R,I,ge):te(et,Xt,_t,I,R,ge);if($r!==void 0){if($r)continue;or=!1;break}if($t){if(!Se(R,function(Er,Kr){if(!at($t,Kr)&&(et===Er||Be(et,Er,B,te,ge)))return $t.push(Kr)})){or=!1;break}}else if(!(et===Xt||Be(et,Xt,B,te,ge))){or=!1;break}}return ge.delete(I),ge.delete(R),or}function ao(I,R,B,te,Be,ge,Xe){switch(B){case Te:if(I.byteLength!=R.byteLength||I.byteOffset!=R.byteOffset)return!1;I=I.buffer,R=R.buffer;case Ee:return!(I.byteLength!=R.byteLength||!ge(new Yt(I),new Yt(R)));case E:case O:case ie:return Is(+I,+R);case U:return I.name==R.name&&I.message==R.message;case g:case N:return I==R+"";case W:var Ct=Je;case p:var Pe=te&o;if(Ct||(Ct=ot),I.size!=R.size&&!Pe)return!1;var Ge=Xe.get(I);if(Ge)return Ge==R;te|=l,Xe.set(I,R);var _t=Zi(Ct(I),Ct(R),te,Be,ge,Xe);return Xe.delete(I),_t;case x:if(yt)return yt.call(I)==yt.call(R)}return!1}function ms(I,R,B,te,Be,ge){var Xe=B&o,Ct=Xi(I),Pe=Ct.length,Ge=Xi(R),_t=Ge.length;if(Pe!=_t&&!Xe)return!1;for(var or=Pe;or--;){var $t=Ct[or];if(!(Xe?$t in R:Le.call(R,$t)))return!1}var et=ge.get(I);if(et&&ge.get(R))return et==R;var Xt=!0;ge.set(I,R),ge.set(R,I);for(var $r=Xe;++or<Pe;){$t=Ct[or];var Er=I[$t],Kr=R[$t];if(te)var Pn=Xe?te(Kr,Er,$t,R,I,ge):te(Er,Kr,$t,I,R,ge);if(!(Pn===void 0?Er===Kr||Be(Er,Kr,B,te,ge):Pn)){Xt=!1;break}$r||($r=$t=="constructor")}if(Xt&&!$r){var $i=I.constructor,qt=R.constructor;$i!=qt&&"constructor"in I&&"constructor"in R&&!(typeof $i=="function"&&$i instanceof $i&&typeof qt=="function"&&qt instanceof qt)&&(Xt=!1)}return ge.delete(I),ge.delete(R),Xt}function Xi(I){return In(I,ho,vs)}function pi(I,R){var B=I.__data__;return bs(R)?B[typeof R=="string"?"string":"hash"]:B.map}function pr(I,R){var B=Ue(I,R);return so(B)?B:void 0}function ys(I){var R=Le.call(I,Zt),B=I[Zt];try{I[Zt]=void 0;var te=!0}catch{}var Be=Dt.call(I);return te&&(R?I[Zt]=B:delete I[Zt]),Be}var vs=Jr?function(I){return I==null?[]:(I=Object(I),Re(Jr(I),function(R){return ar.call(I,R)}))}:Ve,kr=Ai;(ft&&kr(new ft(new ArrayBuffer(1)))!=Te||rt&&kr(new rt)!=W||dt&&kr(dt.resolve())!=d||pt&&kr(new pt)!=p||ct&&kr(new ct)!=se)&&(kr=function(I){var R=Ai(I),B=R==u?I.constructor:void 0,te=B?Zr(B):"";if(te)switch(te){case Ot:return Te;case Nt:return W;case gt:return d;case Tt:return p;case mt:return se}return R});function ws(I,R){return R=R??y,!!R&&(typeof I=="number"||Fr.test(I))&&I>-1&&I%1==0&&I<R}function bs(I){var R=typeof I;return R=="string"||R=="number"||R=="symbol"||R=="boolean"?I!=="__proto__":I===null}function _s(I){return!!Pt&&Pt in I}function Es(I){var R=I&&I.constructor,B=typeof R=="function"&&R.prototype||Ce;return I===B}function oo(I){return Dt.call(I)}function Zr(I){if(I!=null){try{return lt.call(I)}catch{}try{return I+""}catch{}}return""}function Is(I,R){return I===R||I!==I&&R!==R}var Ss=Sn(function(){return arguments}())?Sn:function(I){return Ci(I)&&Le.call(I,"callee")&&!ar.call(I,"callee")},en=Array.isArray;function co(I){return I!=null&&xs(I.length)&&!tn(I)}var xn=di||Fe;function uo(I,R){return Ri(I,R)}function tn(I){if(!Ps(I))return!1;var R=Ai(I);return R==H||R==M||R==_||R==m}function xs(I){return typeof I=="number"&&I>-1&&I%1==0&&I<=y}function Ps(I){var R=typeof I;return I!=null&&(R=="object"||R=="function")}function Ci(I){return I!=null&&typeof I=="object"}var Os=ve?wt(ve):ps;function ho(I){return co(I)?fs(I):gs(I)}function Ve(){return[]}function Fe(){return!1}s.exports=uo})(Na,Na.exports);var A_=Na.exports;const R_=fw(A_);var C_={};function $_(s,t){if(s.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var o=0;o<s.length;o++){var l=s.charAt(o),y=l.charCodeAt(0);if(r[y]!==255)throw new TypeError(l+" is ambiguous");r[y]=o}var b=s.length,P=s.charAt(0),_=Math.log(b)/Math.log(256),E=Math.log(256)/Math.log(b);function O(M){if(M instanceof Uint8Array||(ArrayBuffer.isView(M)?M=new Uint8Array(M.buffer,M.byteOffset,M.byteLength):Array.isArray(M)&&(M=Uint8Array.from(M))),!(M instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(M.length===0)return"";for(var W=0,ie=0,ce=0,u=M.length;ce!==u&&M[ce]===0;)ce++,W++;for(var d=(u-ce)*E+1>>>0,m=new Uint8Array(d);ce!==u;){for(var g=M[ce],p=0,N=d-1;(g!==0||p<ie)&&N!==-1;N--,p++)g+=256*m[N]>>>0,m[N]=g%b>>>0,g=g/b>>>0;if(g!==0)throw new Error("Non-zero carry");ie=p,ce++}for(var x=d-ie;x!==d&&m[x]===0;)x++;for(var Q=P.repeat(W);x<d;++x)Q+=s.charAt(m[x]);return Q}function U(M){if(typeof M!="string")throw new TypeError("Expected String");if(M.length===0)return new Uint8Array;var W=0;if(M[W]!==" "){for(var ie=0,ce=0;M[W]===P;)ie++,W++;for(var u=(M.length-W)*_+1>>>0,d=new Uint8Array(u);M[W];){var m=r[M.charCodeAt(W)];if(m===255)return;for(var g=0,p=u-1;(m!==0||g<ce)&&p!==-1;p--,g++)m+=b*d[p]>>>0,d[p]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");ce=g,W++}if(M[W]!==" "){for(var N=u-ce;N!==u&&d[N]===0;)N++;for(var x=new Uint8Array(ie+(u-N)),Q=ie;N!==u;)x[Q++]=d[N++];return x}}}function H(M){var W=U(M);if(W)return W;throw new Error(`Non-${t} character`)}return{encode:O,decodeUnsafe:U,decode:H}}var D_=$_,U_=D_;const Qf=s=>{if(s instanceof Uint8Array&&s.constructor.name==="Uint8Array")return s;if(s instanceof ArrayBuffer)return new Uint8Array(s);if(ArrayBuffer.isView(s))return new Uint8Array(s.buffer,s.byteOffset,s.byteLength);throw new Error("Unknown type, must be binary type")},j_=s=>new TextEncoder().encode(s),L_=s=>new TextDecoder().decode(s);class q_{constructor(t,r,n){this.name=t,this.prefix=r,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class M_{constructor(t,r,n){if(this.name=t,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return Jf(this,t)}}let z_=class{constructor(t){this.decoders=t}or(t){return Jf(this,t)}decode(t){const r=t[0],n=this.decoders[r];if(n)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const Jf=(s,t)=>new z_({...s.decoders||{[s.prefix]:s},...t.decoders||{[t.prefix]:t}});class F_{constructor(t,r,n,o){this.name=t,this.prefix=r,this.baseEncode=n,this.baseDecode=o,this.encoder=new q_(t,r,n),this.decoder=new M_(t,r,o)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const Fa=({name:s,prefix:t,encode:r,decode:n})=>new F_(s,t,r,n),cs=({prefix:s,name:t,alphabet:r})=>{const{encode:n,decode:o}=U_(r,t);return Fa({prefix:s,name:t,encode:n,decode:l=>Qf(o(l))})},H_=(s,t,r,n)=>{const o={};for(let E=0;E<t.length;++E)o[t[E]]=E;let l=s.length;for(;s[l-1]==="=";)--l;const y=new Uint8Array(l*r/8|0);let b=0,P=0,_=0;for(let E=0;E<l;++E){const O=o[s[E]];if(O===void 0)throw new SyntaxError(`Non-${n} character`);P=P<<r|O,b+=r,b>=8&&(b-=8,y[_++]=255&P>>b)}if(b>=r||255&P<<8-b)throw new SyntaxError("Unexpected end of data");return y},k_=(s,t,r)=>{const n=t[t.length-1]==="=",o=(1<<r)-1;let l="",y=0,b=0;for(let P=0;P<s.length;++P)for(b=b<<8|s[P],y+=8;y>r;)y-=r,l+=t[o&b>>y];if(y&&(l+=t[o&b<<r-y]),n)for(;l.length*r&7;)l+="=";return l},Vt=({name:s,prefix:t,bitsPerChar:r,alphabet:n})=>Fa({prefix:t,name:s,encode(o){return k_(o,n,r)},decode(o){return H_(o,n,r,s)}}),K_=Fa({prefix:"\0",name:"identity",encode:s=>L_(s),decode:s=>j_(s)});var V_=Object.freeze({__proto__:null,identity:K_});const B_=Vt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var G_=Object.freeze({__proto__:null,base2:B_});const W_=Vt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Q_=Object.freeze({__proto__:null,base8:W_});const J_=cs({prefix:"9",name:"base10",alphabet:"0123456789"});var Y_=Object.freeze({__proto__:null,base10:J_});const Z_=Vt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),X_=Vt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var e1=Object.freeze({__proto__:null,base16:Z_,base16upper:X_});const t1=Vt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),r1=Vt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),i1=Vt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),n1=Vt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),s1=Vt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),a1=Vt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),o1=Vt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),c1=Vt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),u1=Vt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var h1=Object.freeze({__proto__:null,base32:t1,base32upper:r1,base32pad:i1,base32padupper:n1,base32hex:s1,base32hexupper:a1,base32hexpad:o1,base32hexpadupper:c1,base32z:u1});const l1=cs({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),f1=cs({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var d1=Object.freeze({__proto__:null,base36:l1,base36upper:f1});const p1=cs({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),g1=cs({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var m1=Object.freeze({__proto__:null,base58btc:p1,base58flickr:g1});const y1=Vt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),v1=Vt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),w1=Vt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),b1=Vt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var _1=Object.freeze({__proto__:null,base64:y1,base64pad:v1,base64url:w1,base64urlpad:b1});const Yf=Array.from(""),E1=Yf.reduce((s,t,r)=>(s[r]=t,s),[]),I1=Yf.reduce((s,t,r)=>(s[t.codePointAt(0)]=r,s),[]);function S1(s){return s.reduce((t,r)=>(t+=E1[r],t),"")}function x1(s){const t=[];for(const r of s){const n=I1[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);t.push(n)}return new Uint8Array(t)}const P1=Fa({prefix:"",name:"base256emoji",encode:S1,decode:x1});var O1=Object.freeze({__proto__:null,base256emoji:P1}),N1=Zf,Hl=128,T1=127,A1=~T1,R1=Math.pow(2,31);function Zf(s,t,r){t=t||[],r=r||0;for(var n=r;s>=R1;)t[r++]=s&255|Hl,s/=128;for(;s&A1;)t[r++]=s&255|Hl,s>>>=7;return t[r]=s|0,Zf.bytes=r-n+1,t}var C1=Kc,$1=128,kl=127;function Kc(s,n){var r=0,n=n||0,o=0,l=n,y,b=s.length;do{if(l>=b)throw Kc.bytes=0,new RangeError("Could not decode varint");y=s[l++],r+=o<28?(y&kl)<<o:(y&kl)*Math.pow(2,o),o+=7}while(y>=$1);return Kc.bytes=l-n,r}var D1=Math.pow(2,7),U1=Math.pow(2,14),j1=Math.pow(2,21),L1=Math.pow(2,28),q1=Math.pow(2,35),M1=Math.pow(2,42),z1=Math.pow(2,49),F1=Math.pow(2,56),H1=Math.pow(2,63),k1=function(s){return s<D1?1:s<U1?2:s<j1?3:s<L1?4:s<q1?5:s<M1?6:s<z1?7:s<F1?8:s<H1?9:10},K1={encode:N1,decode:C1,encodingLength:k1},Xf=K1;const Kl=(s,t,r=0)=>(Xf.encode(s,t,r),t),Vl=s=>Xf.encodingLength(s),Vc=(s,t)=>{const r=t.byteLength,n=Vl(s),o=n+Vl(r),l=new Uint8Array(o+r);return Kl(s,l,0),Kl(r,l,n),l.set(t,o),new V1(s,r,t,l)};let V1=class{constructor(t,r,n,o){this.code=t,this.size=r,this.digest=n,this.bytes=o}};const ed=({name:s,code:t,encode:r})=>new B1(s,t,r);class B1{constructor(t,r,n){this.name=t,this.code=r,this.encode=n}digest(t){if(t instanceof Uint8Array){const r=this.encode(t);return r instanceof Uint8Array?Vc(this.code,r):r.then(n=>Vc(this.code,n))}else throw Error("Unknown type, must be binary type")}}const td=s=>async t=>new Uint8Array(await crypto.subtle.digest(s,t)),G1=ed({name:"sha2-256",code:18,encode:td("SHA-256")}),W1=ed({name:"sha2-512",code:19,encode:td("SHA-512")});var Q1=Object.freeze({__proto__:null,sha256:G1,sha512:W1});const rd=0,J1="identity",id=Qf,Y1=s=>Vc(rd,id(s)),Z1={code:rd,name:J1,encode:id,digest:Y1};var X1=Object.freeze({__proto__:null,identity:Z1});new TextEncoder,new TextDecoder;const Bl={...V_,...G_,...Q_,...Y_,...e1,...h1,...d1,...m1,..._1,...O1};({...Q1,...X1});function nd(s){return globalThis.Buffer!=null?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):s}function eE(s=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?nd(globalThis.Buffer.allocUnsafe(s)):new Uint8Array(s)}function sd(s,t,r,n){return{name:s,prefix:t,encoder:{name:s,prefix:t,encode:r},decoder:{decode:n}}}const Gl=sd("utf8","u",s=>"u"+new TextDecoder("utf8").decode(s),s=>new TextEncoder().encode(s.substring(1))),Sc=sd("ascii","a",s=>{let t="a";for(let r=0;r<s.length;r++)t+=String.fromCharCode(s[r]);return t},s=>{s=s.substring(1);const t=eE(s.length);for(let r=0;r<s.length;r++)t[r]=s.charCodeAt(r);return t}),tE={utf8:Gl,"utf-8":Gl,hex:Bl.base16,latin1:Sc,ascii:Sc,binary:Sc,...Bl};function rE(s,t="utf8"){const r=tE[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?nd(globalThis.Buffer.from(s,"utf-8")):r.decoder.decode(`${r.prefix}${s}`)}const ad="wc",iE=2,au="core",xi=`${ad}@2:${au}:`,nE={name:au,logger:"error"},sE={database:":memory:"},aE="crypto",Wl="client_ed25519_seed",oE=ne.ONE_DAY,cE="keychain",uE="0.3",hE="messages",lE="0.3",fE=ne.SIX_HOURS,dE="publisher",od="irn",pE="error",cd="wss://relay.walletconnect.com",Ql="wss://relay.walletconnect.org",gE="relayer",Wt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},mE="_subscription",ci={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},yE=ne.ONE_SECOND,vE="2.10.6",wE=1e4,bE="0.3",_E="WALLETCONNECT_CLIENT_ID",Mr={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},EE="subscription",IE="0.3",SE=ne.FIVE_SECONDS*1e3,xE="pairing",PE="0.3",Kn={wc_pairingDelete:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:ne.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:ne.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:ne.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:0},res:{ttl:ne.ONE_DAY,prompt:!1,tag:0}}},Yn={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Wr={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},OE="history",NE="0.3",TE="expirer",Ar={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},AE="0.3",xc="verify-api",yn="https://verify.walletconnect.com",Bc="https://verify.walletconnect.org",RE=[yn,Bc];class CE{constructor(t,r){this.core=t,this.logger=r,this.keychain=new Map,this.name=cE,this.version=uE,this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}},this.has=n=>(this.isInitialized(),this.keychain.has(n)),this.set=async(n,o)=>{this.isInitialized(),this.keychain.set(n,o),await this.persist()},this.get=n=>{this.isInitialized();const o=this.keychain.get(n);if(typeof o>"u"){const{message:l}=He("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(l)}return o},this.del=async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()},this.core=t,this.logger=Ne.generateChildLogger(r,this.name)}get context(){return Ne.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(t){await this.core.storage.setItem(this.storageKey,Vf(t))}async getKeyChain(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?Bf(t):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:t}=He("NOT_INITIALIZED",this.name);throw new Error(t)}}}class $E{constructor(t,r,n){this.core=t,this.logger=r,this.name=aE,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=o=>(this.isInitialized(),this.keychain.has(o)),this.getClientId=async()=>{this.isInitialized();const o=await this.getClientSeed(),l=Tl(o);return Ff(l.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const o=jb();return this.setPrivateKey(o.publicKey,o.privateKey)},this.signJWT=async o=>{this.isInitialized();const l=await this.getClientSeed(),y=Tl(l),b=Fc();return await Db(b,o,oE,y)},this.generateSharedKey=(o,l,y)=>{this.isInitialized();const b=this.getPrivateKey(o),P=Lb(b,l);return this.setSymKey(P,y)},this.setSymKey=async(o,l)=>{this.isInitialized();const y=l||qb(o);return await this.keychain.set(y,o),y},this.deleteKeyPair=async o=>{this.isInitialized(),await this.keychain.del(o)},this.deleteSymKey=async o=>{this.isInitialized(),await this.keychain.del(o)},this.encode=async(o,l,y)=>{this.isInitialized();const b=Kf(y),P=ss(l);if(Rl(b)){const U=b.senderPublicKey,H=b.receiverPublicKey;o=await this.generateSharedKey(U,H)}const _=this.getSymKey(o),{type:E,senderPublicKey:O}=b;return zb({type:E,symKey:_,message:P,senderPublicKey:O})},this.decode=async(o,l,y)=>{this.isInitialized();const b=kb(l,y);if(Rl(b)){const P=b.receiverPublicKey,_=b.senderPublicKey;o=await this.generateSharedKey(P,_)}try{const P=this.getSymKey(o),_=Fb({symKey:P,encoded:l});return qa(_)}catch(P){this.logger.error(`Failed to decode message from topic: '${o}', clientId: '${await this.getClientId()}'`),this.logger.error(P)}},this.getPayloadType=o=>{const l=Pa(o);return os(l.type)},this.getPayloadSenderPublicKey=o=>{const l=Pa(o);return l.senderPublicKey?Jt(l.senderPublicKey,sr):void 0},this.core=t,this.logger=Ne.generateChildLogger(r,this.name),this.keychain=n||new CE(this.core,this.logger)}get context(){return Ne.getLoggerContext(this.logger)}async setPrivateKey(t,r){return await this.keychain.set(t,r),t}getPrivateKey(t){return this.keychain.get(t)}async getClientSeed(){let t="";try{t=this.keychain.get(Wl)}catch{t=Fc(),await this.keychain.set(Wl,t)}return rE(t,"base16")}getSymKey(t){return this.keychain.get(t)}isInitialized(){if(!this.initialized){const{message:t}=He("NOT_INITIALIZED",this.name);throw new Error(t)}}}class DE extends fb{constructor(t,r){super(t,r),this.logger=t,this.core=r,this.messages=new Map,this.name=hE,this.version=lE,this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}},this.set=async(n,o)=>{this.isInitialized();const l=Hc(o);let y=this.messages.get(n);return typeof y>"u"&&(y={}),typeof y[l]<"u"||(y[l]=o,this.messages.set(n,y),await this.persist()),l},this.get=n=>{this.isInitialized();let o=this.messages.get(n);return typeof o>"u"&&(o={}),o},this.has=(n,o)=>{this.isInitialized();const l=this.get(n),y=Hc(o);return typeof l[y]<"u"},this.del=async n=>{this.isInitialized(),this.messages.delete(n),await this.persist()},this.logger=Ne.generateChildLogger(t,this.name),this.core=r}get context(){return Ne.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(t){await this.core.storage.setItem(this.storageKey,Vf(t))}async getRelayerMessages(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?Bf(t):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:t}=He("NOT_INITIALIZED",this.name);throw new Error(t)}}}class UE extends db{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.events=new Qr.EventEmitter,this.name=dE,this.queue=new Map,this.publishTimeout=ne.toMiliseconds(ne.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(n,o,l)=>{var y;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:o,opts:l}});try{const b=(l==null?void 0:l.ttl)||fE,P=kc(l),_=(l==null?void 0:l.prompt)||!1,E=(l==null?void 0:l.tag)||0,O=(l==null?void 0:l.id)||ww().toString(),U={topic:n,message:o,opts:{ttl:b,relay:P,prompt:_,tag:E,id:O}},H=setTimeout(()=>this.queue.set(O,U),this.publishTimeout);try{await await is(this.rpcPublish(n,o,b,P,_,E,O),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(O),this.relayer.events.emit(Wt.publish,U)}catch(M){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(y=l==null?void 0:l.internal)!=null&&y.throwOnFailedPublish)throw this.removeRequestFromQueue(O),M;return}finally{clearTimeout(H)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:o,opts:l}})}catch(b){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(b),b}},this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.relayer=t,this.logger=Ne.generateChildLogger(r,this.name),this.registerEventListeners()}get context(){return Ne.getLoggerContext(this.logger)}rpcPublish(t,r,n,o,l,y,b){var P,_,E,O;const U={method:Ia(o.protocol).publish,params:{topic:t,message:r,ttl:n,prompt:l,tag:y},id:b};return Oa((P=U.params)==null?void 0:P.prompt)&&((_=U.params)==null||delete _.prompt),Oa((E=U.params)==null?void 0:E.tag)&&((O=U.params)==null||delete O.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:U}),this.relayer.request(U)}removeRequestFromQueue(t){this.queue.delete(t)}checkQueue(){this.queue.forEach(async t=>{const{topic:r,message:n,opts:o}=t;await this.publish(r,n,o)})}registerEventListeners(){this.relayer.core.heartbeat.on(wn.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Wt.connection_stalled);return}this.checkQueue()}),this.relayer.on(Wt.message_ack,t=>{this.removeRequestFromQueue(t.id.toString())})}}class jE{constructor(){this.map=new Map,this.set=(t,r)=>{const n=this.get(t);this.exists(t,r)||this.map.set(t,[...n,r])},this.get=t=>this.map.get(t)||[],this.exists=(t,r)=>this.get(t).includes(r),this.delete=(t,r)=>{if(typeof r>"u"){this.map.delete(t);return}if(!this.map.has(t))return;const n=this.get(t);if(!this.exists(t,r))return;const o=n.filter(l=>l!==r);if(!o.length){this.map.delete(t);return}this.map.set(t,o)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var LE=Object.defineProperty,qE=Object.defineProperties,ME=Object.getOwnPropertyDescriptors,Jl=Object.getOwnPropertySymbols,zE=Object.prototype.hasOwnProperty,FE=Object.prototype.propertyIsEnumerable,Yl=(s,t,r)=>t in s?LE(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,Vn=(s,t)=>{for(var r in t||(t={}))zE.call(t,r)&&Yl(s,r,t[r]);if(Jl)for(var r of Jl(t))FE.call(t,r)&&Yl(s,r,t[r]);return s},Pc=(s,t)=>qE(s,ME(t));class HE extends mb{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.subscriptions=new Map,this.topicMap=new jE,this.events=new Qr.EventEmitter,this.name=EE,this.version=IE,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=xi,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(n,o)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:o}});try{const l=kc(o),y={topic:n,relay:l};this.pending.set(n,y);const b=await this.rpcSubscribe(n,l);return this.onSubscribe(b,y),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:o}}),b}catch(l){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(l),l}},this.unsubscribe=async(n,o)=>{await this.restartToComplete(),this.isInitialized(),typeof(o==null?void 0:o.id)<"u"?await this.unsubscribeById(n,o.id,o):await this.unsubscribeByTopic(n,o)},this.isSubscribed=async n=>this.topics.includes(n)?!0:await new Promise((o,l)=>{const y=new ne.Watch;y.start(this.pendingSubscriptionWatchLabel);const b=setInterval(()=>{!this.pending.has(n)&&this.topics.includes(n)&&(clearInterval(b),y.stop(this.pendingSubscriptionWatchLabel),o(!0)),y.elapsed(this.pendingSubscriptionWatchLabel)>=SE&&(clearInterval(b),y.stop(this.pendingSubscriptionWatchLabel),l(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=t,this.logger=Ne.generateChildLogger(r,this.name),this.clientId=""}get context(){return Ne.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(t,r){let n=!1;try{n=this.getSubscription(t).topic===r}catch{}return n}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(t,r){const n=this.topicMap.get(t);await Promise.all(n.map(async o=>await this.unsubscribeById(t,o,r)))}async unsubscribeById(t,r,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:n}});try{const o=kc(n);await this.rpcUnsubscribe(t,r,o);const l=Jn("USER_DISCONNECTED",`${this.name}, ${t}`);await this.onUnsubscribe(t,r,l),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:n}})}catch(o){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(o),o}}async rpcSubscribe(t,r){const n={method:Ia(r.protocol).subscribe,params:{topic:t}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await is(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Wt.connection_stalled)}return Hc(t+this.clientId)}async rpcBatchSubscribe(t){if(!t.length)return;const r=t[0].relay,n={method:Ia(r.protocol).batchSubscribe,params:{topics:t.map(o=>o.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{return await await is(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Wt.connection_stalled)}}rpcUnsubscribe(t,r,n){const o={method:Ia(n.protocol).unsubscribe,params:{topic:t,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o}),this.relayer.request(o)}onSubscribe(t,r){this.setSubscription(t,Pc(Vn({},r),{id:t})),this.pending.delete(r.topic)}onBatchSubscribe(t){t.length&&t.forEach(r=>{this.setSubscription(r.id,Vn({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(t,r,n){this.events.removeAllListeners(r),this.hasSubscription(r,t)&&this.deleteSubscription(r,n),await this.relayer.messages.del(t)}async setRelayerSubscriptions(t){await this.relayer.core.storage.setItem(this.storageKey,t)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(t,r){this.subscriptions.has(t)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:t,subscription:r}),this.addSubscription(t,r))}addSubscription(t,r){this.subscriptions.set(t,Vn({},r)),this.topicMap.set(r.topic,t),this.events.emit(Mr.created,r)}getSubscription(t){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:t});const r=this.subscriptions.get(t);if(!r){const{message:n}=He("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(n)}return r}deleteSubscription(t,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:t,reason:r});const n=this.getSubscription(t);this.subscriptions.delete(t),this.topicMap.delete(n.topic,t),this.events.emit(Mr.deleted,Pc(Vn({},n),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Mr.sync)}async reset(){if(this.cached.length){const t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<t;r++){const n=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(Mr.resubscribed)}async restore(){try{const t=await this.getRelayerSubscriptions();if(typeof t>"u"||!t.length)return;if(this.subscriptions.size){const{message:r}=He("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(t){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(t)}}async batchSubscribe(t){if(!t.length)return;const r=await this.rpcBatchSubscribe(t);m_(r)&&this.onBatchSubscribe(r.map((n,o)=>Pc(Vn({},t[o]),{id:n})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const t=[];this.pending.forEach(r=>{t.push(r)}),await this.batchSubscribe(t)}registerEventListeners(){this.relayer.core.heartbeat.on(wn.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Wt.connect,async()=>{await this.onConnect()}),this.relayer.on(Wt.disconnect,()=>{this.onDisconnect()}),this.events.on(Mr.created,async t=>{const r=Mr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()}),this.events.on(Mr.deleted,async t=>{const r=Mr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=He("NOT_INITIALIZED",this.name);throw new Error(t)}}async restartToComplete(){this.restartInProgress&&await new Promise(t=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),t())},this.pollingInterval)})}}var kE=Object.defineProperty,Zl=Object.getOwnPropertySymbols,KE=Object.prototype.hasOwnProperty,VE=Object.prototype.propertyIsEnumerable,Xl=(s,t,r)=>t in s?kE(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,BE=(s,t)=>{for(var r in t||(t={}))KE.call(t,r)&&Xl(s,r,t[r]);if(Zl)for(var r of Zl(t))VE.call(t,r)&&Xl(s,r,t[r]);return s};class GE extends pb{constructor(t){super(t),this.protocol="wc",this.version=2,this.events=new Qr.EventEmitter,this.name=gE,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(n){throw this.logger.debug("Failed to Publish Request"),this.logger.error(n),n}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(Wt.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(Wt.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(ci.payload,this.onPayloadHandler),this.provider.on(ci.connect,this.onConnectHandler),this.provider.on(ci.disconnect,this.onDisconnectHandler),this.provider.on(ci.error,this.onProviderErrorHandler)},this.core=t.core,this.logger=typeof t.logger<"u"&&typeof t.logger!="string"?Ne.generateChildLogger(t.logger,this.name):Ne.pino(Ne.getDefaultLoggerOptions({level:t.logger||pE})),this.messages=new DE(this.logger,t.core),this.subscriber=new HE(this,this.logger),this.publisher=new UE(this,this.logger),this.relayUrl=(t==null?void 0:t.relayUrl)||cd,this.projectId=t.projectId,this.bundleId=Qb(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${Ql}...`),await this.restartTransport(Ql)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},wE)}get context(){return Ne.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(t,r,n){this.isInitialized(),await this.publisher.publish(t,r,n),await this.recordMessageEvent({topic:t,message:r,publishedAt:Date.now()})}async subscribe(t,r){var n;this.isInitialized();let o=((n=this.subscriber.topicMap.get(t))==null?void 0:n[0])||"";if(o)return o;let l;const y=b=>{b.topic===t&&(this.subscriber.off(Mr.created,y),l())};return await Promise.all([new Promise(b=>{l=b,this.subscriber.on(Mr.created,y)}),new Promise(async b=>{o=await this.subscriber.subscribe(t,r),b()})]),o}async unsubscribe(t,r){this.isInitialized(),await this.subscriber.unsubscribe(t,r)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await is(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(t){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){t&&t!==this.relayUrl&&(this.relayUrl=t,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(Mr.resubscribed,()=>{r()})}),new Promise(async(r,n)=>{try{await is(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(o){n(o);return}r()})])}catch(r){this.logger.error(r);const n=r;if(!this.isConnectionStalled(n.message))throw r;this.provider.events.emit(ci.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(t){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=t||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Ml())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(t){return this.staleConnectionErrors.some(r=>t.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const t=await this.core.crypto.signJWT(this.relayUrl);this.provider=new li(new T_(e_({sdkVersion:vE,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(t){const{topic:r,message:n}=t;await this.messages.set(r,n)}async shouldIgnoreMessageEvent(t){const{topic:r,message:n}=t;if(!n||n.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const o=this.messages.has(r,n);return o&&this.logger.debug(`Ignoring duplicate message: ${n}`),o}async onProviderPayload(t){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),Zc(t)){if(!t.method.endsWith(mE))return;const r=t.params,{topic:n,message:o,publishedAt:l}=r.data,y={topic:n,message:o,publishedAt:l};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(BE({type:"event",event:r.id},y)),this.events.emit(r.id,y),await this.acknowledgePayload(t),await this.onMessageEvent(y)}else Xc(t)&&this.events.emit(Wt.message_ack,t)}async onMessageEvent(t){await this.shouldIgnoreMessageEvent(t)||(this.events.emit(Wt.message,t),await this.recordMessageEvent(t))}async acknowledgePayload(t){const r=eu(t.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(ci.payload,this.onPayloadHandler),this.provider.off(ci.connect,this.onConnectHandler),this.provider.off(ci.disconnect,this.onDisconnectHandler),this.provider.off(ci.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Wt.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let t=await Ml();I_(async r=>{this.initialized&&t!==r&&(t=r,r?await this.restartTransport().catch(n=>this.logger.error(n)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(n=>this.logger.error(n))))})}onProviderDisconnect(){this.events.emit(Wt.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(t=>this.logger.error(t))},ne.toMiliseconds(yE)))}isInitialized(){if(!this.initialized){const{message:t}=He("NOT_INITIALIZED",this.name);throw new Error(t)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(t=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),t())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var WE=Object.defineProperty,ef=Object.getOwnPropertySymbols,QE=Object.prototype.hasOwnProperty,JE=Object.prototype.propertyIsEnumerable,tf=(s,t,r)=>t in s?WE(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,rf=(s,t)=>{for(var r in t||(t={}))QE.call(t,r)&&tf(s,r,t[r]);if(ef)for(var r of ef(t))JE.call(t,r)&&tf(s,r,t[r]);return s};class Ha extends gb{constructor(t,r,n,o=xi,l=void 0){super(t,r,n,o),this.core=t,this.logger=r,this.name=n,this.map=new Map,this.version=bE,this.cached=[],this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(y=>{this.getKey&&y!==null&&!Oa(y)?this.map.set(this.getKey(y),y):v_(y)?this.map.set(y.id,y):w_(y)&&this.map.set(y.topic,y)}),this.cached=[],this.initialized=!0)},this.set=async(y,b)=>{this.isInitialized(),this.map.has(y)?await this.update(y,b):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:y,value:b}),this.map.set(y,b),await this.persist())},this.get=y=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:y}),this.getData(y)),this.getAll=y=>(this.isInitialized(),y?this.values.filter(b=>Object.keys(y).every(P=>R_(b[P],y[P]))):this.values),this.update=async(y,b)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:y,update:b});const P=rf(rf({},this.getData(y)),b);this.map.set(y,P),await this.persist()},this.delete=async(y,b)=>{this.isInitialized(),this.map.has(y)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:y,reason:b}),this.map.delete(y),await this.persist())},this.logger=Ne.generateChildLogger(r,this.name),this.storagePrefix=o,this.getKey=l}get context(){return Ne.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(t){await this.core.storage.setItem(this.storageKey,t)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(t){const r=this.map.get(t);if(!r){const{message:n}=He("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(n),new Error(n)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const t=await this.getDataStore();if(typeof t>"u"||!t.length)return;if(this.map.size){const{message:r}=He("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(t){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(t)}}isInitialized(){if(!this.initialized){const{message:t}=He("NOT_INITIALIZED",this.name);throw new Error(t)}}}class YE{constructor(t,r){this.core=t,this.logger=r,this.name=xE,this.version=PE,this.events=new Jc,this.initialized=!1,this.storagePrefix=xi,this.ignoredPayloadTypes=[bn],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]},this.create=async()=>{this.isInitialized();const n=Fc(),o=await this.core.crypto.setSymKey(n),l=Ea(ne.FIVE_MINUTES),y={protocol:od},b={topic:o,expiry:l,relay:y,active:!1},P=d_({protocol:this.core.protocol,version:this.core.version,topic:o,symKey:n,relay:y});return await this.pairings.set(o,b),await this.core.relayer.subscribe(o),this.core.expirer.set(o,l),{topic:o,uri:P}},this.pair=async n=>{this.isInitialized(),this.isValidPair(n);const{topic:o,symKey:l,relay:y}=ql(n.uri);let b;if(this.pairings.keys.includes(o)&&(b=this.pairings.get(o),b.active))throw new Error(`Pairing already exists: ${o}. Please try again with a new connection URI.`);const P=Ea(ne.FIVE_MINUTES),_={topic:o,relay:y,expiry:P,active:!1};return await this.pairings.set(o,_),this.core.expirer.set(o,P),n.activatePairing&&await this.activate({topic:o}),this.events.emit(Yn.create,_),this.core.crypto.keychain.has(o)||(await this.core.crypto.setSymKey(l,o),await this.core.relayer.subscribe(o,{relay:y})),_},this.activate=async({topic:n})=>{this.isInitialized();const o=Ea(ne.THIRTY_DAYS);await this.pairings.update(n,{active:!0,expiry:o}),this.core.expirer.set(n,o)},this.ping=async n=>{this.isInitialized(),await this.isValidPing(n);const{topic:o}=n;if(this.pairings.keys.includes(o)){const l=await this.sendRequest(o,"wc_pairingPing",{}),{done:y,resolve:b,reject:P}=t_();this.events.once(Ec("pairing_ping",l),({error:_})=>{_?P(_):b()}),await y()}},this.updateExpiry=async({topic:n,expiry:o})=>{this.isInitialized(),await this.pairings.update(n,{expiry:o})},this.updateMetadata=async({topic:n,metadata:o})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:o})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:o}=n;this.pairings.keys.includes(o)&&(await this.sendRequest(o,"wc_pairingDelete",Jn("USER_DISCONNECTED")),await this.deletePairing(o))},this.sendRequest=async(n,o,l)=>{const y=es(o,l),b=await this.core.crypto.encode(n,y),P=Kn[o].req;return this.core.history.set(n,y),this.core.relayer.publish(n,b,P),y.id},this.sendResult=async(n,o,l)=>{const y=eu(n,l),b=await this.core.crypto.encode(o,y),P=await this.core.history.get(o,n),_=Kn[P.request.method].res;await this.core.relayer.publish(o,b,_),await this.core.history.resolve(y)},this.sendError=async(n,o,l)=>{const y=Yc(n,l),b=await this.core.crypto.encode(o,y),P=await this.core.history.get(o,n),_=Kn[P.request.method]?Kn[P.request.method].res:Kn.unregistered_method.res;await this.core.relayer.publish(o,b,_),await this.core.history.resolve(y)},this.deletePairing=async(n,o)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,Jn("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),o?Promise.resolve():this.core.expirer.del(n)])},this.cleanup=async()=>{const n=this.pairings.getAll().filter(o=>Ul(o.expiry));await Promise.all(n.map(o=>this.deletePairing(o.topic)))},this.onRelayEventRequest=n=>{const{topic:o,payload:l}=n;switch(l.method){case"wc_pairingPing":return this.onPairingPingRequest(o,l);case"wc_pairingDelete":return this.onPairingDeleteRequest(o,l);default:return this.onUnknownRpcMethodRequest(o,l)}},this.onRelayEventResponse=async n=>{const{topic:o,payload:l}=n,y=(await this.core.history.get(o,l.id)).request.method;switch(y){case"wc_pairingPing":return this.onPairingPingResponse(o,l);default:return this.onUnknownRpcMethodResponse(y)}},this.onPairingPingRequest=async(n,o)=>{const{id:l}=o;try{this.isValidPing({topic:n}),await this.sendResult(l,n,!0),this.events.emit(Yn.ping,{id:l,topic:n})}catch(y){await this.sendError(l,n,y),this.logger.error(y)}},this.onPairingPingResponse=(n,o)=>{const{id:l}=o;setTimeout(()=>{Si(o)?this.events.emit(Ec("pairing_ping",l),{}):hi(o)&&this.events.emit(Ec("pairing_ping",l),{error:o.error})},500)},this.onPairingDeleteRequest=async(n,o)=>{const{id:l}=o;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(Yn.delete,{id:l,topic:n})}catch(y){await this.sendError(l,n,y),this.logger.error(y)}},this.onUnknownRpcMethodRequest=async(n,o)=>{const{id:l,method:y}=o;try{if(this.registeredMethods.includes(y))return;const b=Jn("WC_METHOD_UNSUPPORTED",y);await this.sendError(l,n,b),this.logger.error(b)}catch(b){await this.sendError(l,n,b),this.logger.error(b)}},this.onUnknownRpcMethodResponse=n=>{this.registeredMethods.includes(n)||this.logger.error(Jn("WC_METHOD_UNSUPPORTED",n))},this.isValidPair=n=>{var o;if(!Ic(n)){const{message:y}=He("MISSING_OR_INVALID",`pair() params: ${n}`);throw new Error(y)}if(!y_(n.uri)){const{message:y}=He("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw new Error(y)}const l=ql(n.uri);if(!((o=l==null?void 0:l.relay)!=null&&o.protocol)){const{message:y}=He("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(y)}if(!(l!=null&&l.symKey)){const{message:y}=He("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(y)}},this.isValidPing=async n=>{if(!Ic(n)){const{message:l}=He("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(l)}const{topic:o}=n;await this.isValidPairingTopic(o)},this.isValidDisconnect=async n=>{if(!Ic(n)){const{message:l}=He("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(l)}const{topic:o}=n;await this.isValidPairingTopic(o)},this.isValidPairingTopic=async n=>{if(!Wf(n,!1)){const{message:o}=He("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(o)}if(!this.pairings.keys.includes(n)){const{message:o}=He("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(o)}if(Ul(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:o}=He("EXPIRED",`pairing topic: ${n}`);throw new Error(o)}},this.core=t,this.logger=Ne.generateChildLogger(r,this.name),this.pairings=new Ha(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Ne.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:t}=He("NOT_INITIALIZED",this.name);throw new Error(t)}}registerRelayerEvents(){this.core.relayer.on(Wt.message,async t=>{const{topic:r,message:n}=t;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))return;const o=await this.core.crypto.decode(r,n);try{Zc(o)?(this.core.history.set(r,o),this.onRelayEventRequest({topic:r,payload:o})):Xc(o)&&(await this.core.history.resolve(o),await this.onRelayEventResponse({topic:r,payload:o}),this.core.history.delete(r,o.id))}catch(l){this.logger.error(l)}})}registerExpirerEvents(){this.core.expirer.on(Ar.expired,async t=>{const{topic:r}=n_(t.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Yn.expire,{topic:r}))})}}let ZE=class extends lb{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.records=new Map,this.events=new Qr.EventEmitter,this.name=OE,this.version=NE,this.cached=[],this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(n,o,l)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:o,chainId:l}),this.records.has(o.id))return;const y={id:o.id,topic:n,request:{method:o.method,params:o.params||null},chainId:l,expiry:Ea(ne.THIRTY_DAYS)};this.records.set(y.id,y),this.events.emit(Wr.created,y)},this.resolve=async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const o=await this.getRecord(n.id);typeof o.response>"u"&&(o.response=hi(n)?{error:n.error}:{result:n.result},this.records.set(o.id,o),this.events.emit(Wr.updated,o))},this.get=async(n,o)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:o}),await this.getRecord(o)),this.delete=(n,o)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:o}),this.values.forEach(l=>{if(l.topic===n){if(typeof o<"u"&&l.id!==o)return;this.records.delete(l.id),this.events.emit(Wr.deleted,l)}})},this.exists=async(n,o)=>(this.isInitialized(),this.records.has(o)?(await this.getRecord(o)).topic===n:!1),this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.logger=Ne.generateChildLogger(r,this.name)}get context(){return Ne.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const t=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const n={topic:r.topic,request:es(r.request.method,r.request.params,r.id),chainId:r.chainId};return t.push(n)}),t}async setJsonRpcRecords(t){await this.core.storage.setItem(this.storageKey,t)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(t){this.isInitialized();const r=this.records.get(t);if(!r){const{message:n}=He("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(n)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Wr.sync)}async restore(){try{const t=await this.getJsonRpcRecords();if(typeof t>"u"||!t.length)return;if(this.records.size){const{message:r}=He("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(t){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(t)}}registerEventListeners(){this.events.on(Wr.created,t=>{const r=Wr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(Wr.updated,t=>{const r=Wr.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(Wr.deleted,t=>{const r=Wr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.core.heartbeat.on(wn.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(t=>{ne.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.delete(t.topic,t.id))})}catch(t){this.logger.warn(t)}}isInitialized(){if(!this.initialized){const{message:t}=He("NOT_INITIALIZED",this.name);throw new Error(t)}}},XE=class extends yb{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.expirations=new Map,this.events=new Qr.EventEmitter,this.name=TE,this.version=AE,this.cached=[],this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=n=>{try{const o=this.formatTarget(n);return typeof this.getExpiration(o)<"u"}catch{return!1}},this.set=(n,o)=>{this.isInitialized();const l=this.formatTarget(n),y={target:l,expiry:o};this.expirations.set(l,y),this.checkExpiry(l,y),this.events.emit(Ar.created,{target:l,expiration:y})},this.get=n=>{this.isInitialized();const o=this.formatTarget(n);return this.getExpiration(o)},this.del=n=>{if(this.isInitialized(),this.has(n)){const o=this.formatTarget(n),l=this.getExpiration(o);this.expirations.delete(o),this.events.emit(Ar.deleted,{target:o,expiration:l})}},this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.logger=Ne.generateChildLogger(r,this.name)}get context(){return Ne.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(t){if(typeof t=="string")return r_(t);if(typeof t=="number")return i_(t);const{message:r}=He("UNKNOWN_TYPE",`Target type: ${typeof t}`);throw new Error(r)}async setExpirations(t){await this.core.storage.setItem(this.storageKey,t)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Ar.sync)}async restore(){try{const t=await this.getExpirations();if(typeof t>"u"||!t.length)return;if(this.expirations.size){const{message:r}=He("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(t){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(t)}}getExpiration(t){const r=this.expirations.get(t);if(!r){const{message:n}=He("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(n),new Error(n)}return r}checkExpiry(t,r){const{expiry:n}=r;ne.toMiliseconds(n)-Date.now()<=0&&this.expire(t,r)}expire(t,r){this.expirations.delete(t),this.events.emit(Ar.expired,{target:t,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((t,r)=>this.checkExpiry(r,t))}registerEventListeners(){this.core.heartbeat.on(wn.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Ar.created,t=>{const r=Ar.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Ar.expired,t=>{const r=Ar.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Ar.deleted,t=>{const r=Ar.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=He("NOT_INITIALIZED",this.name);throw new Error(t)}}};class eI extends vb{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.name=xc,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async n=>{if(this.verifyDisabled||_n()||!Ma())return;const o=this.getVerifyUrl(n==null?void 0:n.verifyUrl);this.verifyUrl!==o&&this.removeIframe(),this.verifyUrl=o;try{await this.createIframe()}catch(l){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(l)}if(!this.initialized){this.removeIframe(),this.verifyUrl=Bc;try{await this.createIframe()}catch(l){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(l),this.verifyDisabled=!0}}},this.register=async n=>{this.initialized?this.sendPost(n.attestationId):(this.addToQueue(n.attestationId),await this.init())},this.resolve=async n=>{if(this.isDevEnv)return"";const o=this.getVerifyUrl(n==null?void 0:n.verifyUrl);let l;try{l=await this.fetchAttestation(n.attestationId,o)}catch(y){this.logger.info(`failed to resolve attestation: ${n.attestationId} from url: ${o}`),this.logger.info(y),l=await this.fetchAttestation(n.attestationId,Bc)}return l},this.fetchAttestation=async(n,o)=>{this.logger.info(`resolving attestation: ${n} from url: ${o}`);const l=this.startAbortTimer(ne.ONE_SECOND*2),y=await fetch(`${o}/attestation/${n}`,{signal:this.abortController.signal});return clearTimeout(l),y.status===200?await y.json():void 0},this.addToQueue=n=>{this.queue.push(n)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(n=>this.sendPost(n)),this.queue=[])},this.sendPost=n=>{var o;try{if(!this.iframe)return;(o=this.iframe.contentWindow)==null||o.postMessage(n,"*"),this.logger.info(`postMessage sent: ${n} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let n;const o=l=>{l.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",o),n())};await Promise.race([new Promise(l=>{if(document.getElementById(xc))return l();window.addEventListener("message",o);const y=document.createElement("iframe");y.id=xc,y.src=`${this.verifyUrl}/${this.projectId}`,y.style.display="none",document.body.append(y),this.iframe=y,n=l}),new Promise((l,y)=>setTimeout(()=>{window.removeEventListener("message",o),y("verify iframe load timeout")},ne.toMiliseconds(ne.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=n=>{let o=n||yn;return RE.includes(o)||(this.logger.info(`verify url: ${o}, not included in trusted list, assigning default: ${yn}`),o=yn),o},this.logger=Ne.generateChildLogger(r,this.name),this.verifyUrl=yn,this.abortController=new AbortController,this.isDevEnv=su()&&C_.IS_VITEST}get context(){return Ne.getLoggerContext(this.logger)}startAbortTimer(t){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),ne.toMiliseconds(t))}}var tI=Object.defineProperty,nf=Object.getOwnPropertySymbols,rI=Object.prototype.hasOwnProperty,iI=Object.prototype.propertyIsEnumerable,sf=(s,t,r)=>t in s?tI(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,af=(s,t)=>{for(var r in t||(t={}))rI.call(t,r)&&sf(s,r,t[r]);if(nf)for(var r of nf(t))iI.call(t,r)&&sf(s,r,t[r]);return s};let nI=class ud extends hb{constructor(t){super(t),this.protocol=ad,this.version=iE,this.name=au,this.events=new Qr.EventEmitter,this.initialized=!1,this.on=(n,o)=>this.events.on(n,o),this.once=(n,o)=>this.events.once(n,o),this.off=(n,o)=>this.events.off(n,o),this.removeListener=(n,o)=>this.events.removeListener(n,o),this.projectId=t==null?void 0:t.projectId,this.relayUrl=(t==null?void 0:t.relayUrl)||cd,this.customStoragePrefix=t!=null&&t.customStoragePrefix?`:${t.customStoragePrefix}`:"";const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Ne.pino(Ne.getDefaultLoggerOptions({level:(t==null?void 0:t.logger)||nE.logger}));this.logger=Ne.generateChildLogger(r,this.name),this.heartbeat=new wn.HeartBeat,this.crypto=new $E(this,this.logger,t==null?void 0:t.keychain),this.history=new ZE(this,this.logger),this.expirer=new XE(this,this.logger),this.storage=t!=null&&t.storage?t.storage:new tb(af(af({},sE),t==null?void 0:t.storageOptions)),this.relayer=new GE({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new YE(this,this.logger),this.verify=new eI(this.projectId||"",this.logger)}static async init(t){const r=new ud(t);await r.initialize();const n=await r.crypto.getClientId();return await r.storage.setItem(_E,n),r}get context(){return Ne.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(t){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,t),this.logger.error(t.message),t}}};const sI=nI;var aI={};(function(s){const t=$a,r=Da,n=Ra,o=Ca,l=u=>u==null,y=Symbol("encodeFragmentIdentifier");function b(u){switch(u.arrayFormat){case"index":return d=>(m,g)=>{const p=m.length;return g===void 0||u.skipNull&&g===null||u.skipEmptyString&&g===""?m:g===null?[...m,[E(d,u),"[",p,"]"].join("")]:[...m,[E(d,u),"[",E(p,u),"]=",E(g,u)].join("")]};case"bracket":return d=>(m,g)=>g===void 0||u.skipNull&&g===null||u.skipEmptyString&&g===""?m:g===null?[...m,[E(d,u),"[]"].join("")]:[...m,[E(d,u),"[]=",E(g,u)].join("")];case"colon-list-separator":return d=>(m,g)=>g===void 0||u.skipNull&&g===null||u.skipEmptyString&&g===""?m:g===null?[...m,[E(d,u),":list="].join("")]:[...m,[E(d,u),":list=",E(g,u)].join("")];case"comma":case"separator":case"bracket-separator":{const d=u.arrayFormat==="bracket-separator"?"[]=":"=";return m=>(g,p)=>p===void 0||u.skipNull&&p===null||u.skipEmptyString&&p===""?g:(p=p===null?"":p,g.length===0?[[E(m,u),d,E(p,u)].join("")]:[[g,E(p,u)].join(u.arrayFormatSeparator)])}default:return d=>(m,g)=>g===void 0||u.skipNull&&g===null||u.skipEmptyString&&g===""?m:g===null?[...m,E(d,u)]:[...m,[E(d,u),"=",E(g,u)].join("")]}}function P(u){let d;switch(u.arrayFormat){case"index":return(m,g,p)=>{if(d=/\[(\d*)\]$/.exec(m),m=m.replace(/\[\d*\]$/,""),!d){p[m]=g;return}p[m]===void 0&&(p[m]={}),p[m][d[1]]=g};case"bracket":return(m,g,p)=>{if(d=/(\[\])$/.exec(m),m=m.replace(/\[\]$/,""),!d){p[m]=g;return}if(p[m]===void 0){p[m]=[g];return}p[m]=[].concat(p[m],g)};case"colon-list-separator":return(m,g,p)=>{if(d=/(:list)$/.exec(m),m=m.replace(/:list$/,""),!d){p[m]=g;return}if(p[m]===void 0){p[m]=[g];return}p[m]=[].concat(p[m],g)};case"comma":case"separator":return(m,g,p)=>{const N=typeof g=="string"&&g.includes(u.arrayFormatSeparator),x=typeof g=="string"&&!N&&O(g,u).includes(u.arrayFormatSeparator);g=x?O(g,u):g;const Q=N||x?g.split(u.arrayFormatSeparator).map(se=>O(se,u)):g===null?g:O(g,u);p[m]=Q};case"bracket-separator":return(m,g,p)=>{const N=/(\[\])$/.test(m);if(m=m.replace(/\[\]$/,""),!N){p[m]=g&&O(g,u);return}const x=g===null?[]:g.split(u.arrayFormatSeparator).map(Q=>O(Q,u));if(p[m]===void 0){p[m]=x;return}p[m]=[].concat(p[m],x)};default:return(m,g,p)=>{if(p[m]===void 0){p[m]=g;return}p[m]=[].concat(p[m],g)}}}function _(u){if(typeof u!="string"||u.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function E(u,d){return d.encode?d.strict?t(u):encodeURIComponent(u):u}function O(u,d){return d.decode?r(u):u}function U(u){return Array.isArray(u)?u.sort():typeof u=="object"?U(Object.keys(u)).sort((d,m)=>Number(d)-Number(m)).map(d=>u[d]):u}function H(u){const d=u.indexOf("#");return d!==-1&&(u=u.slice(0,d)),u}function M(u){let d="";const m=u.indexOf("#");return m!==-1&&(d=u.slice(m)),d}function W(u){u=H(u);const d=u.indexOf("?");return d===-1?"":u.slice(d+1)}function ie(u,d){return d.parseNumbers&&!Number.isNaN(Number(u))&&typeof u=="string"&&u.trim()!==""?u=Number(u):d.parseBooleans&&u!==null&&(u.toLowerCase()==="true"||u.toLowerCase()==="false")&&(u=u.toLowerCase()==="true"),u}function ce(u,d){d=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},d),_(d.arrayFormatSeparator);const m=P(d),g=Object.create(null);if(typeof u!="string"||(u=u.trim().replace(/^[?#&]/,""),!u))return g;for(const p of u.split("&")){if(p==="")continue;let[N,x]=n(d.decode?p.replace(/\+/g," "):p,"=");x=x===void 0?null:["comma","separator","bracket-separator"].includes(d.arrayFormat)?x:O(x,d),m(O(N,d),x,g)}for(const p of Object.keys(g)){const N=g[p];if(typeof N=="object"&&N!==null)for(const x of Object.keys(N))N[x]=ie(N[x],d);else g[p]=ie(N,d)}return d.sort===!1?g:(d.sort===!0?Object.keys(g).sort():Object.keys(g).sort(d.sort)).reduce((p,N)=>{const x=g[N];return x&&typeof x=="object"&&!Array.isArray(x)?p[N]=U(x):p[N]=x,p},Object.create(null))}s.extract=W,s.parse=ce,s.stringify=(u,d)=>{if(!u)return"";d=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},d),_(d.arrayFormatSeparator);const m=x=>d.skipNull&&l(u[x])||d.skipEmptyString&&u[x]==="",g=b(d),p={};for(const x of Object.keys(u))m(x)||(p[x]=u[x]);const N=Object.keys(p);return d.sort!==!1&&N.sort(d.sort),N.map(x=>{const Q=u[x];return Q===void 0?"":Q===null?E(x,d):Array.isArray(Q)?Q.length===0&&d.arrayFormat==="bracket-separator"?E(x,d)+"[]":Q.reduce(g(x),[]).join("&"):E(x,d)+"="+E(Q,d)}).filter(x=>x.length>0).join("&")},s.parseUrl=(u,d)=>{d=Object.assign({decode:!0},d);const[m,g]=n(u,"#");return Object.assign({url:m.split("?")[0]||"",query:ce(W(u),d)},d&&d.parseFragmentIdentifier&&g?{fragmentIdentifier:O(g,d)}:{})},s.stringifyUrl=(u,d)=>{d=Object.assign({encode:!0,strict:!0,[y]:!0},d);const m=H(u.url).split("?")[0]||"",g=s.extract(u.url),p=s.parse(g,{sort:!1}),N=Object.assign(p,u.query);let x=s.stringify(N,d);x&&(x=`?${x}`);let Q=M(u.url);return u.fragmentIdentifier&&(Q=`#${d[y]?E(u.fragmentIdentifier,d):u.fragmentIdentifier}`),`${m}${x}${Q}`},s.pick=(u,d,m)=>{m=Object.assign({parseFragmentIdentifier:!0,[y]:!1},m);const{url:g,query:p,fragmentIdentifier:N}=s.parseUrl(u,m);return s.stringifyUrl({url:g,query:o(p,d),fragmentIdentifier:N},m)},s.exclude=(u,d,m)=>{const g=Array.isArray(d)?p=>!d.includes(p):(p,N)=>!d(p,N);return s.pick(u,g,m)}})(aI);function hd(s,t){return s.includes(":")?[s]:t.chains||[]}const oI="base16",cI="utf8",uI=1;function Oc(s){const t=ja.hash(nr(s,cI));return Jt(t,oI)}const hI="ReactNative",vn={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"};function ld(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function lI(){return!Tf()&&!!La()&&navigator.product===hI}function ou(){return!ld()&&!!La()}function fI(){return lI()?vn.reactNative:ld()?vn.node:ou()?vn.browser:vn.unknown}function dI(){return dw()||{name:"",description:"",url:"",icons:[""]}}function Vi(s,t){return s.filter(r=>t.includes(r)).length===s.length}function Bn(s=ne.FIVE_MINUTES,t){const r=ne.toMiliseconds(s||ne.FIVE_MINUTES);let n,o,l;return{resolve:y=>{l&&n&&(clearTimeout(l),n(y))},reject:y=>{l&&o&&(clearTimeout(l),o(y))},done:()=>new Promise((y,b)=>{l=setTimeout(()=>{b(new Error(t))},r),n=y,o=b})}}function pI(s){const[t,r]=s.split(":"),n={id:void 0,topic:void 0};if(t==="topic"&&typeof r=="string")n.topic=r;else if(t==="id"&&Number.isInteger(Number(r)))n.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${t}:${r}`);return n}function Ki(s,t){return ne.fromMiliseconds((t||Date.now())+ne.toMiliseconds(s))}function mn(s){return Date.now()>=ne.toMiliseconds(s)}function Kt(s,t){return`${s}${t?`:${t}`:""}`}async function gI({id:s,topic:t,wcDeepLink:r}){try{if(!r)return;const n=typeof r=="string"?JSON.parse(r):r;let o=n==null?void 0:n.href;if(typeof o!="string")return;o.endsWith("/")&&(o=o.slice(0,-1));const l=`${o}/wc?requestId=${s}&sessionTopic=${t}`,y=fI();y===vn.browser?l.startsWith("https://")?window.open(l,"_blank","noreferrer noopener"):window.open(l,"_self","noreferrer noopener"):y===vn.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(l)}catch(n){console.error(n)}}async function mI(s,t){try{return await s.getItem(t)||(ou()?localStorage.getItem(t):void 0)}catch(r){console.error(r)}}function En(s){const t=[];return s.forEach(r=>{const[n,o]=r.split(":");t.push(`${n}:${o}`)}),t}function yI(s){const t=[];return Object.values(s).forEach(r=>{t.push(...En(r.accounts))}),t}function vI(s,t){const r=[];return Object.values(s).forEach(n=>{En(n.accounts).includes(t)&&r.push(...n.methods)}),r}function wI(s,t){const r=[];return Object.values(s).forEach(n=>{En(n.accounts).includes(t)&&r.push(...n.events)}),r}function bI(s,t){const r=Sa(s,t);if(r)throw new Error(r.message);const n={};for(const[o,l]of Object.entries(s))n[o]={methods:l.methods,events:l.events,chains:l.accounts.map(y=>`${y.split(":")[0]}:${y.split(":")[1]}`)};return n}const _I={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},EI={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function fe(s,t){const{message:r,code:n}=EI[s];return{message:t?`${r} ${t}`:r,code:n}}function br(s,t){const{message:r,code:n}=_I[s];return{message:t?`${r} ${t}`:r,code:n}}function ka(s,t){return Array.isArray(s)?typeof t<"u"&&s.length?s.every(t):!0:!1}function ts(s){return Object.getPrototypeOf(s)===Object.prototype&&Object.keys(s).length}function Rr(s){return typeof s>"u"}function Qt(s,t){return t&&Rr(s)?!0:typeof s=="string"&&!!s.trim().length}function cu(s,t){return t&&Rr(s)?!0:typeof s=="number"&&!isNaN(s)}function II(s,t){const{requiredNamespaces:r}=t,n=Object.keys(s.namespaces),o=Object.keys(r);let l=!0;return Vi(o,n)?(n.forEach(y=>{const{accounts:b,methods:P,events:_}=s.namespaces[y],E=En(b),O=r[y];(!Vi(hd(y,O),E)||!Vi(O.methods,P)||!Vi(O.events,_))&&(l=!1)}),l):!1}function Ta(s){return Qt(s,!1)&&s.includes(":")?s.split(":").length===2:!1}function SI(s){if(Qt(s,!1)&&s.includes(":")){const t=s.split(":");if(t.length===3){const r=t[0]+":"+t[1];return!!t[2]&&Ta(r)}}return!1}function xI(s,t){let r=null;return Qt(s==null?void 0:s.publicKey,!1)||(r=fe("MISSING_OR_INVALID",`${t} controller public key should be a string`)),r}function of(s){let t=!0;return ka(s)?s.length&&(t=s.every(r=>Qt(r,!1))):t=!1,t}function PI(s,t,r){let n=null;return ka(t)&&t.length?t.forEach(o=>{n||Ta(o)||(n=br("UNSUPPORTED_CHAINS",`${r}, chain ${o} should be a string and conform to "namespace:chainId" format`))}):Ta(s)||(n=br("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),n}function OI(s,t,r){let n=null;return Object.entries(s).forEach(([o,l])=>{if(n)return;const y=PI(o,hd(o,l),`${t} ${r}`);y&&(n=y)}),n}function NI(s,t){let r=null;return ka(s)?s.forEach(n=>{r||SI(n)||(r=br("UNSUPPORTED_ACCOUNTS",`${t}, account ${n} should be a string and conform to "namespace:chainId:address" format`))}):r=br("UNSUPPORTED_ACCOUNTS",`${t}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function TI(s,t){let r=null;return Object.values(s).forEach(n=>{if(r)return;const o=NI(n==null?void 0:n.accounts,`${t} namespace`);o&&(r=o)}),r}function AI(s,t){let r=null;return of(s==null?void 0:s.methods)?of(s==null?void 0:s.events)||(r=br("UNSUPPORTED_EVENTS",`${t}, events should be an array of strings or empty array for no events`)):r=br("UNSUPPORTED_METHODS",`${t}, methods should be an array of strings or empty array for no methods`),r}function fd(s,t){let r=null;return Object.values(s).forEach(n=>{if(r)return;const o=AI(n,`${t}, namespace`);o&&(r=o)}),r}function RI(s,t,r){let n=null;if(s&&ts(s)){const o=fd(s,t);o&&(n=o);const l=OI(s,t,r);l&&(n=l)}else n=fe("MISSING_OR_INVALID",`${t}, ${r} should be an object with data`);return n}function Sa(s,t){let r=null;if(s&&ts(s)){const n=fd(s,t);n&&(r=n);const o=TI(s,t);o&&(r=o)}else r=fe("MISSING_OR_INVALID",`${t}, namespaces should be an object with data`);return r}function dd(s){return Qt(s.protocol,!0)}function CI(s,t){let r=!1;return t&&!s?r=!0:s&&ka(s)&&s.length&&s.forEach(n=>{r=dd(n)}),r}function $I(s){return typeof s=="number"}function qr(s){return typeof s<"u"&&typeof s!==null}function DI(s){return!(!s||typeof s!="object"||!s.code||!cu(s.code,!1)||!s.message||!Qt(s.message,!1))}function UI(s){return!(Rr(s)||!Qt(s.method,!1))}function jI(s){return!(Rr(s)||Rr(s.result)&&Rr(s.error)||!cu(s.id,!1)||!Qt(s.jsonrpc,!1))}function LI(s){return!(Rr(s)||!Qt(s.name,!1))}function cf(s,t){return!(!Ta(t)||!yI(s).includes(t))}function qI(s,t,r){return Qt(r,!1)?vI(s,t).includes(r):!1}function MI(s,t,r){return Qt(r,!1)?wI(s,t).includes(r):!1}function uf(s,t,r){let n=null;const o=zI(s),l=FI(t),y=Object.keys(o),b=Object.keys(l),P=hf(Object.keys(s)),_=hf(Object.keys(t)),E=P.filter(O=>!_.includes(O));return E.length&&(n=fe("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${E.toString()}
      Received: ${Object.keys(t).toString()}`)),Vi(y,b)||(n=fe("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${y.toString()}
      Approved: ${b.toString()}`)),Object.keys(t).forEach(O=>{if(!O.includes(":")||n)return;const U=En(t[O].accounts);U.includes(O)||(n=fe("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${O}
        Required: ${O}
        Approved: ${U.toString()}`))}),y.forEach(O=>{n||(Vi(o[O].methods,l[O].methods)?Vi(o[O].events,l[O].events)||(n=fe("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${O}`)):n=fe("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${O}`))}),n}function zI(s){const t={};return Object.keys(s).forEach(r=>{var n;r.includes(":")?t[r]=s[r]:(n=s[r].chains)==null||n.forEach(o=>{t[o]={methods:s[r].methods,events:s[r].events}})}),t}function hf(s){return[...new Set(s.map(t=>t.includes(":")?t.split(":")[0]:t))]}function FI(s){const t={};return Object.keys(s).forEach(r=>{if(r.includes(":"))t[r]=s[r];else{const n=En(s[r].accounts);n==null||n.forEach(o=>{t[o]={accounts:s[r].accounts.filter(l=>l.includes(`${o}:`)),methods:s[r].methods,events:s[r].events}})}}),t}function HI(s,t){return cu(s,!1)&&s<=t.max&&s>=t.min}const Nc={};class ma{static get(t){return Nc[t]}static set(t,r){Nc[t]=r}static delete(t){delete Nc[t]}}const pd="wc",gd=2,md="client",uu=`${pd}@${gd}:${md}:`,Tc={name:md,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},lf="WALLETCONNECT_DEEPLINK_CHOICE",kI="proposal",yd="Proposal expired",KI="session",ya=ne.SEVEN_DAYS,VI="engine",Gn={wc_sessionPropose:{req:{ttl:ne.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:1104},res:{ttl:ne.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:1106},res:{ttl:ne.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:ne.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:ne.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:1112},res:{ttl:ne.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:ne.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:ne.THIRTY_SECONDS,prompt:!1,tag:1115}}},Ac={min:ne.FIVE_MINUTES,max:ne.SEVEN_DAYS},ui={idle:"IDLE",active:"ACTIVE"},BI="request",GI=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var WI=Object.defineProperty,QI=Object.defineProperties,JI=Object.getOwnPropertyDescriptors,ff=Object.getOwnPropertySymbols,YI=Object.prototype.hasOwnProperty,ZI=Object.prototype.propertyIsEnumerable,df=(s,t,r)=>t in s?WI(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,fr=(s,t)=>{for(var r in t||(t={}))YI.call(t,r)&&df(s,r,t[r]);if(ff)for(var r of ff(t))ZI.call(t,r)&&df(s,r,t[r]);return s},Wn=(s,t)=>QI(s,JI(t));class XI extends bb{constructor(t){super(t),this.name=VI,this.events=new Jc,this.initialized=!1,this.ignoredPayloadTypes=[uI],this.requestQueue={state:ui.idle,queue:[]},this.sessionRequestQueue={state:ui.idle,queue:[]},this.requestQueueDelay=ne.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(Gn)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},ne.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const n=Wn(fr({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(n);const{pairingTopic:o,requiredNamespaces:l,optionalNamespaces:y,sessionProperties:b,relays:P}=n;let _=o,E,O=!1;if(_&&(O=this.client.core.pairing.pairings.get(_).active),!_||!O){const{topic:d,uri:m}=await this.client.core.pairing.create();_=d,E=m}const U=await this.client.core.crypto.generateKeyPair(),H=fr({requiredNamespaces:l,optionalNamespaces:y,relays:P??[{protocol:od}],proposer:{publicKey:U,metadata:this.client.metadata}},b&&{sessionProperties:b}),{reject:M,resolve:W,done:ie}=Bn(ne.FIVE_MINUTES,yd);if(this.events.once(Kt("session_connect"),async({error:d,session:m})=>{if(d)M(d);else if(m){m.self.publicKey=U;const g=Wn(fr({},m),{requiredNamespaces:m.requiredNamespaces,optionalNamespaces:m.optionalNamespaces});await this.client.session.set(m.topic,g),await this.setExpiry(m.topic,m.expiry),_&&await this.client.core.pairing.updateMetadata({topic:_,metadata:m.peer.metadata}),W(g)}}),!_){const{message:d}=fe("NO_MATCHING_KEY",`connect() pairing topic: ${_}`);throw new Error(d)}const ce=await this.sendRequest({topic:_,method:"wc_sessionPropose",params:H}),u=Ki(ne.FIVE_MINUTES);return await this.setProposal(ce,fr({id:ce,expiry:u},H)),{uri:E,approval:ie}},this.pair=async r=>(await this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{await this.isInitialized(),await this.isValidApprove(r);const{id:n,relayProtocol:o,namespaces:l,sessionProperties:y}=r,b=this.client.proposal.get(n);let{pairingTopic:P,proposer:_,requiredNamespaces:E,optionalNamespaces:O}=b;P=P||"",ts(E)||(E=bI(l,"approve()"));const U=await this.client.core.crypto.generateKeyPair(),H=_.publicKey,M=await this.client.core.crypto.generateSharedKey(U,H);P&&n&&(await this.client.core.pairing.updateMetadata({topic:P,metadata:_.metadata}),await this.sendResult({id:n,topic:P,result:{relay:{protocol:o??"irn"},responderPublicKey:U}}),await this.client.proposal.delete(n,br("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:P}));const W=fr({relay:{protocol:o??"irn"},namespaces:l,requiredNamespaces:E,optionalNamespaces:O,pairingTopic:P,controller:{publicKey:U,metadata:this.client.metadata},expiry:Ki(ya)},y&&{sessionProperties:y});await this.client.core.relayer.subscribe(M),await this.sendRequest({topic:M,method:"wc_sessionSettle",params:W,throwOnFailedPublish:!0});const ie=Wn(fr({},W),{topic:M,pairingTopic:P,acknowledged:!1,self:W.controller,peer:{publicKey:_.publicKey,metadata:_.metadata},controller:U});return await this.client.session.set(M,ie),await this.setExpiry(M,Ki(ya)),{topic:M,acknowledged:()=>new Promise(ce=>setTimeout(()=>ce(this.client.session.get(M)),500))}},this.reject=async r=>{await this.isInitialized(),await this.isValidReject(r);const{id:n,reason:o}=r,{pairingTopic:l}=this.client.proposal.get(n);l&&(await this.sendError(n,l,o),await this.client.proposal.delete(n,br("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized(),await this.isValidUpdate(r);const{topic:n,namespaces:o}=r,l=await this.sendRequest({topic:n,method:"wc_sessionUpdate",params:{namespaces:o}}),{done:y,resolve:b,reject:P}=Bn();return this.events.once(Kt("session_update",l),({error:_})=>{_?P(_):b()}),await this.client.session.update(n,{namespaces:o}),{acknowledged:y}},this.extend=async r=>{await this.isInitialized(),await this.isValidExtend(r);const{topic:n}=r,o=await this.sendRequest({topic:n,method:"wc_sessionExtend",params:{}}),{done:l,resolve:y,reject:b}=Bn();return this.events.once(Kt("session_extend",o),({error:P})=>{P?b(P):y()}),await this.setExpiry(n,Ki(ya)),{acknowledged:l}},this.request=async r=>{await this.isInitialized(),await this.isValidRequest(r);const{chainId:n,request:o,topic:l,expiry:y}=r,b=bw(),{done:P,resolve:_,reject:E}=Bn(y,"Request expired. Please try again.");return this.events.once(Kt("session_request",b),({error:O,result:U})=>{O?E(O):_(U)}),await Promise.all([new Promise(async O=>{await this.sendRequest({clientRpcId:b,topic:l,method:"wc_sessionRequest",params:{request:o,chainId:n},expiry:y,throwOnFailedPublish:!0}).catch(U=>E(U)),this.client.events.emit("session_request_sent",{topic:l,request:o,chainId:n,id:b}),O()}),new Promise(async O=>{const U=await mI(this.client.core.storage,lf);gI({id:b,topic:l,wcDeepLink:U}),O()}),P()]).then(O=>O[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:n,response:o}=r,{id:l}=o;Si(o)?await this.sendResult({id:l,topic:n,result:o.result,throwOnFailedPublish:!0}):hi(o)&&await this.sendError(l,n,o.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized(),await this.isValidPing(r);const{topic:n}=r;if(this.client.session.keys.includes(n)){const o=await this.sendRequest({topic:n,method:"wc_sessionPing",params:{}}),{done:l,resolve:y,reject:b}=Bn();this.events.once(Kt("session_ping",o),({error:P})=>{P?b(P):y()}),await l()}else this.client.core.pairing.pairings.keys.includes(n)&&await this.client.core.pairing.ping({topic:n})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:n,event:o,chainId:l}=r;await this.sendRequest({topic:n,method:"wc_sessionEvent",params:{event:o,chainId:l}})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:n}=r;this.client.session.keys.includes(n)?(await this.sendRequest({topic:n,method:"wc_sessionDelete",params:br("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(n)):await this.client.core.pairing.disconnect({topic:n})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(n=>II(n,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const n=this.client.core.pairing.pairings.get(r.pairingTopic),o=this.client.core.pairing.pairings.getAll().filter(l=>{var y,b;return((y=l.peerMetadata)==null?void 0:y.url)&&((b=l.peerMetadata)==null?void 0:b.url)===r.peer.metadata.url&&l.topic&&l.topic!==n.topic});if(o.length===0)return;this.client.logger.info(`Cleaning up ${o.length} duplicate pairing(s)`),await Promise.all(o.map(l=>this.client.core.pairing.disconnect({topic:l.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}},this.deleteSession=async(r,n)=>{const{self:o}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,br("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(o.publicKey)&&await this.client.core.crypto.deleteKeyPair(o.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),n||this.client.core.expirer.del(r),this.client.core.storage.removeItem(lf).catch(l=>this.client.logger.warn(l))},this.deleteProposal=async(r,n)=>{await Promise.all([this.client.proposal.delete(r,br("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,n,o=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,n),o?Promise.resolve():this.client.core.expirer.del(r)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(l=>l.id!==r),o&&(this.sessionRequestQueue.state=ui.idle)},this.setExpiry=async(r,n)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:n}),this.client.core.expirer.set(r,n)},this.setProposal=async(r,n)=>{await this.client.proposal.set(r,n),this.client.core.expirer.set(r,n.expiry)},this.setPendingSessionRequest=async r=>{const n=Gn.wc_sessionRequest.req.ttl,{id:o,topic:l,params:y,verifyContext:b}=r;await this.client.pendingRequest.set(o,{id:o,topic:l,params:y,verifyContext:b}),n&&this.client.core.expirer.set(o,Ki(n))},this.sendRequest=async r=>{const{topic:n,method:o,params:l,expiry:y,relayRpcId:b,clientRpcId:P,throwOnFailedPublish:_}=r,E=es(o,l,P);if(ou()&&GI.includes(o)){const H=Oc(JSON.stringify(E));this.client.core.verify.register({attestationId:H})}const O=await this.client.core.crypto.encode(n,E),U=Gn[o].req;return y&&(U.ttl=y),b&&(U.id=b),this.client.core.history.set(n,E),_?(U.internal=Wn(fr({},U.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,O,U)):this.client.core.relayer.publish(n,O,U).catch(H=>this.client.logger.error(H)),E.id},this.sendResult=async r=>{const{id:n,topic:o,result:l,throwOnFailedPublish:y}=r,b=eu(n,l),P=await this.client.core.crypto.encode(o,b),_=await this.client.core.history.get(o,n),E=Gn[_.request.method].res;y?(E.internal=Wn(fr({},E.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(o,P,E)):this.client.core.relayer.publish(o,P,E).catch(O=>this.client.logger.error(O)),await this.client.core.history.resolve(b)},this.sendError=async(r,n,o)=>{const l=Yc(r,o),y=await this.client.core.crypto.encode(n,l),b=await this.client.core.history.get(n,r),P=Gn[b.request.method].res;this.client.core.relayer.publish(n,y,P),await this.client.core.history.resolve(l)},this.cleanup=async()=>{const r=[],n=[];this.client.session.getAll().forEach(o=>{mn(o.expiry)&&r.push(o.topic)}),this.client.proposal.getAll().forEach(o=>{mn(o.expiry)&&n.push(o.id)}),await Promise.all([...r.map(o=>this.deleteSession(o)),...n.map(o=>this.deleteProposal(o))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===ui.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=ui.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(n=>setTimeout(n,300))}catch(n){this.client.logger.warn(n)}}this.requestQueue.state=ui.idle},this.processRequest=r=>{const{topic:n,payload:o}=r,l=o.method;switch(l){case"wc_sessionPropose":return this.onSessionProposeRequest(n,o);case"wc_sessionSettle":return this.onSessionSettleRequest(n,o);case"wc_sessionUpdate":return this.onSessionUpdateRequest(n,o);case"wc_sessionExtend":return this.onSessionExtendRequest(n,o);case"wc_sessionPing":return this.onSessionPingRequest(n,o);case"wc_sessionDelete":return this.onSessionDeleteRequest(n,o);case"wc_sessionRequest":return this.onSessionRequest(n,o);case"wc_sessionEvent":return this.onSessionEventRequest(n,o);default:return this.client.logger.info(`Unsupported request method ${l}`)}},this.onRelayEventResponse=async r=>{const{topic:n,payload:o}=r,l=(await this.client.core.history.get(n,o.id)).request.method;switch(l){case"wc_sessionPropose":return this.onSessionProposeResponse(n,o);case"wc_sessionSettle":return this.onSessionSettleResponse(n,o);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,o);case"wc_sessionExtend":return this.onSessionExtendResponse(n,o);case"wc_sessionPing":return this.onSessionPingResponse(n,o);case"wc_sessionRequest":return this.onSessionRequestResponse(n,o);default:return this.client.logger.info(`Unsupported response method ${l}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:n}=r,{message:o}=fe("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(o)},this.onSessionProposeRequest=async(r,n)=>{const{params:o,id:l}=n;try{this.isValidConnect(fr({},n.params));const y=Ki(ne.FIVE_MINUTES),b=fr({id:l,pairingTopic:r,expiry:y},o);await this.setProposal(l,b);const P=Oc(JSON.stringify(n)),_=await this.getVerifyContext(P,b.proposer.metadata);this.client.events.emit("session_proposal",{id:l,params:b,verifyContext:_})}catch(y){await this.sendError(l,r,y),this.client.logger.error(y)}},this.onSessionProposeResponse=async(r,n)=>{const{id:o}=n;if(Si(n)){const{result:l}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:l});const y=this.client.proposal.get(o);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:y});const b=y.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:b});const P=l.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:P});const _=await this.client.core.crypto.generateSharedKey(b,P);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:_});const E=await this.client.core.relayer.subscribe(_);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:E}),await this.client.core.pairing.activate({topic:r})}else hi(n)&&(await this.client.proposal.delete(o,br("USER_DISCONNECTED")),this.events.emit(Kt("session_connect"),{error:n.error}))},this.onSessionSettleRequest=async(r,n)=>{const{id:o,params:l}=n;try{this.isValidSessionSettleRequest(l);const{relay:y,controller:b,expiry:P,namespaces:_,requiredNamespaces:E,optionalNamespaces:O,sessionProperties:U,pairingTopic:H}=n.params,M=fr({topic:r,relay:y,expiry:P,namespaces:_,acknowledged:!0,pairingTopic:H,requiredNamespaces:E,optionalNamespaces:O,controller:b.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:b.publicKey,metadata:b.metadata}},U&&{sessionProperties:U});await this.sendResult({id:n.id,topic:r,result:!0}),this.events.emit(Kt("session_connect"),{session:M}),this.cleanupDuplicatePairings(M)}catch(y){await this.sendError(o,r,y),this.client.logger.error(y)}},this.onSessionSettleResponse=async(r,n)=>{const{id:o}=n;Si(n)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(Kt("session_approve",o),{})):hi(n)&&(await this.client.session.delete(r,br("USER_DISCONNECTED")),this.events.emit(Kt("session_approve",o),{error:n.error}))},this.onSessionUpdateRequest=async(r,n)=>{const{params:o,id:l}=n;try{const y=`${r}_session_update`,b=ma.get(y);if(b&&this.isRequestOutOfSync(b,l)){this.client.logger.info(`Discarding out of sync request - ${l}`);return}this.isValidUpdate(fr({topic:r},o)),await this.client.session.update(r,{namespaces:o.namespaces}),await this.sendResult({id:l,topic:r,result:!0}),this.client.events.emit("session_update",{id:l,topic:r,params:o}),ma.set(y,l)}catch(y){await this.sendError(l,r,y),this.client.logger.error(y)}},this.isRequestOutOfSync=(r,n)=>parseInt(n.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,n)=>{const{id:o}=n;Si(n)?this.events.emit(Kt("session_update",o),{}):hi(n)&&this.events.emit(Kt("session_update",o),{error:n.error})},this.onSessionExtendRequest=async(r,n)=>{const{id:o}=n;try{this.isValidExtend({topic:r}),await this.setExpiry(r,Ki(ya)),await this.sendResult({id:o,topic:r,result:!0}),this.client.events.emit("session_extend",{id:o,topic:r})}catch(l){await this.sendError(o,r,l),this.client.logger.error(l)}},this.onSessionExtendResponse=(r,n)=>{const{id:o}=n;Si(n)?this.events.emit(Kt("session_extend",o),{}):hi(n)&&this.events.emit(Kt("session_extend",o),{error:n.error})},this.onSessionPingRequest=async(r,n)=>{const{id:o}=n;try{this.isValidPing({topic:r}),await this.sendResult({id:o,topic:r,result:!0}),this.client.events.emit("session_ping",{id:o,topic:r})}catch(l){await this.sendError(o,r,l),this.client.logger.error(l)}},this.onSessionPingResponse=(r,n)=>{const{id:o}=n;setTimeout(()=>{Si(n)?this.events.emit(Kt("session_ping",o),{}):hi(n)&&this.events.emit(Kt("session_ping",o),{error:n.error})},500)},this.onSessionDeleteRequest=async(r,n)=>{const{id:o}=n;try{this.isValidDisconnect({topic:r,reason:n.params}),await Promise.all([new Promise(l=>{this.client.core.relayer.once(Wt.publish,async()=>{l(await this.deleteSession(r))})}),this.sendResult({id:o,topic:r,result:!0})]),this.client.events.emit("session_delete",{id:o,topic:r})}catch(l){this.client.logger.error(l)}},this.onSessionRequest=async(r,n)=>{const{id:o,params:l}=n;try{this.isValidRequest(fr({topic:r},l));const y=Oc(JSON.stringify(es("wc_sessionRequest",l,o))),b=this.client.session.get(r),P=await this.getVerifyContext(y,b.peer.metadata),_={id:o,topic:r,params:l,verifyContext:P};await this.setPendingSessionRequest(_),this.addSessionRequestToSessionRequestQueue(_),this.processSessionRequestQueue()}catch(y){await this.sendError(o,r,y),this.client.logger.error(y)}},this.onSessionRequestResponse=(r,n)=>{const{id:o}=n;Si(n)?this.events.emit(Kt("session_request",o),{result:n.result}):hi(n)&&this.events.emit(Kt("session_request",o),{error:n.error})},this.onSessionEventRequest=async(r,n)=>{const{id:o,params:l}=n;try{const y=`${r}_session_event_${l.event.name}`,b=ma.get(y);if(b&&this.isRequestOutOfSync(b,o)){this.client.logger.info(`Discarding out of sync request - ${o}`);return}this.isValidEmit(fr({topic:r},l)),this.client.events.emit("session_event",{id:o,topic:r,params:l}),ma.set(y,o)}catch(y){await this.sendError(o,r,y),this.client.logger.error(y)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=ui.idle,this.processSessionRequestQueue()},ne.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===ui.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=ui.active,this.client.events.emit("session_request",r)}catch(n){this.client.logger.error(n)}},this.onPairingCreated=r=>{if(r.active)return;const n=this.client.proposal.getAll().find(o=>o.pairingTopic===r.topic);n&&this.onSessionProposeRequest(r.topic,es("wc_sessionPropose",{requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,relays:n.relays,proposer:n.proposer,sessionProperties:n.sessionProperties},n.id))},this.isValidConnect=async r=>{if(!qr(r)){const{message:P}=fe("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(P)}const{pairingTopic:n,requiredNamespaces:o,optionalNamespaces:l,sessionProperties:y,relays:b}=r;if(Rr(n)||await this.isValidPairingTopic(n),!CI(b,!0)){const{message:P}=fe("MISSING_OR_INVALID",`connect() relays: ${b}`);throw new Error(P)}!Rr(o)&&ts(o)!==0&&this.validateNamespaces(o,"requiredNamespaces"),!Rr(l)&&ts(l)!==0&&this.validateNamespaces(l,"optionalNamespaces"),Rr(y)||this.validateSessionProps(y,"sessionProperties")},this.validateNamespaces=(r,n)=>{const o=RI(r,"connect()",n);if(o)throw new Error(o.message)},this.isValidApprove=async r=>{if(!qr(r))throw new Error(fe("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:n,namespaces:o,relayProtocol:l,sessionProperties:y}=r;await this.isValidProposalId(n);const b=this.client.proposal.get(n),P=Sa(o,"approve()");if(P)throw new Error(P.message);const _=uf(b.requiredNamespaces,o,"approve()");if(_)throw new Error(_.message);if(!Qt(l,!0)){const{message:E}=fe("MISSING_OR_INVALID",`approve() relayProtocol: ${l}`);throw new Error(E)}Rr(y)||this.validateSessionProps(y,"sessionProperties")},this.isValidReject=async r=>{if(!qr(r)){const{message:l}=fe("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(l)}const{id:n,reason:o}=r;if(await this.isValidProposalId(n),!DI(o)){const{message:l}=fe("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(o)}`);throw new Error(l)}},this.isValidSessionSettleRequest=r=>{if(!qr(r)){const{message:_}=fe("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(_)}const{relay:n,controller:o,namespaces:l,expiry:y}=r;if(!dd(n)){const{message:_}=fe("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(_)}const b=xI(o,"onSessionSettleRequest()");if(b)throw new Error(b.message);const P=Sa(l,"onSessionSettleRequest()");if(P)throw new Error(P.message);if(mn(y)){const{message:_}=fe("EXPIRED","onSessionSettleRequest()");throw new Error(_)}},this.isValidUpdate=async r=>{if(!qr(r)){const{message:P}=fe("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(P)}const{topic:n,namespaces:o}=r;await this.isValidSessionTopic(n);const l=this.client.session.get(n),y=Sa(o,"update()");if(y)throw new Error(y.message);const b=uf(l.requiredNamespaces,o,"update()");if(b)throw new Error(b.message)},this.isValidExtend=async r=>{if(!qr(r)){const{message:o}=fe("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(o)}const{topic:n}=r;await this.isValidSessionTopic(n)},this.isValidRequest=async r=>{if(!qr(r)){const{message:P}=fe("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(P)}const{topic:n,request:o,chainId:l,expiry:y}=r;await this.isValidSessionTopic(n);const{namespaces:b}=this.client.session.get(n);if(!cf(b,l)){const{message:P}=fe("MISSING_OR_INVALID",`request() chainId: ${l}`);throw new Error(P)}if(!UI(o)){const{message:P}=fe("MISSING_OR_INVALID",`request() ${JSON.stringify(o)}`);throw new Error(P)}if(!qI(b,l,o.method)){const{message:P}=fe("MISSING_OR_INVALID",`request() method: ${o.method}`);throw new Error(P)}if(y&&!HI(y,Ac)){const{message:P}=fe("MISSING_OR_INVALID",`request() expiry: ${y}. Expiry must be a number (in seconds) between ${Ac.min} and ${Ac.max}`);throw new Error(P)}},this.isValidRespond=async r=>{if(!qr(r)){const{message:l}=fe("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(l)}const{topic:n,response:o}=r;if(await this.isValidSessionTopic(n),!jI(o)){const{message:l}=fe("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(o)}`);throw new Error(l)}},this.isValidPing=async r=>{if(!qr(r)){const{message:o}=fe("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(o)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)},this.isValidEmit=async r=>{if(!qr(r)){const{message:b}=fe("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(b)}const{topic:n,event:o,chainId:l}=r;await this.isValidSessionTopic(n);const{namespaces:y}=this.client.session.get(n);if(!cf(y,l)){const{message:b}=fe("MISSING_OR_INVALID",`emit() chainId: ${l}`);throw new Error(b)}if(!LI(o)){const{message:b}=fe("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(b)}if(!MI(y,l,o.name)){const{message:b}=fe("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(b)}},this.isValidDisconnect=async r=>{if(!qr(r)){const{message:o}=fe("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(o)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)},this.getVerifyContext=async(r,n)=>{const o={verified:{verifyUrl:n.verifyUrl||yn,validation:"UNKNOWN",origin:n.url||""}};try{const l=await this.client.core.verify.resolve({attestationId:r,verifyUrl:n.verifyUrl});l&&(o.verified.origin=l.origin,o.verified.isScam=l.isScam,o.verified.validation=l.origin===new URL(n.url).origin?"VALID":"INVALID")}catch(l){this.client.logger.info(l)}return this.client.logger.info(`Verify context: ${JSON.stringify(o)}`),o},this.validateSessionProps=(r,n)=>{Object.values(r).forEach(o=>{if(!Qt(o,!1)){const{message:l}=fe("MISSING_OR_INVALID",`${n} must be in Record<string, string> format. Received: ${JSON.stringify(o)}`);throw new Error(l)}})}}async isInitialized(){if(!this.initialized){const{message:t}=fe("NOT_INITIALIZED",this.name);throw new Error(t)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Wt.message,async t=>{const{topic:r,message:n}=t;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(n)))return;const o=await this.client.core.crypto.decode(r,n);try{Zc(o)?(this.client.core.history.set(r,o),this.onRelayEventRequest({topic:r,payload:o})):Xc(o)?(await this.client.core.history.resolve(o),await this.onRelayEventResponse({topic:r,payload:o}),this.client.core.history.delete(r,o.id)):this.onRelayEventUnknownPayload({topic:r,payload:o})}catch(l){this.client.logger.error(l)}})}registerExpirerEvents(){this.client.core.expirer.on(Ar.expired,async t=>{const{topic:r,id:n}=pI(t.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,fe("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(Yn.create,t=>this.onPairingCreated(t))}isValidPairingTopic(t){if(!Qt(t,!1)){const{message:r}=fe("MISSING_OR_INVALID",`pairing topic should be a string: ${t}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(t)){const{message:r}=fe("NO_MATCHING_KEY",`pairing topic doesn't exist: ${t}`);throw new Error(r)}if(mn(this.client.core.pairing.pairings.get(t).expiry)){const{message:r}=fe("EXPIRED",`pairing topic: ${t}`);throw new Error(r)}}async isValidSessionTopic(t){if(!Qt(t,!1)){const{message:r}=fe("MISSING_OR_INVALID",`session topic should be a string: ${t}`);throw new Error(r)}if(!this.client.session.keys.includes(t)){const{message:r}=fe("NO_MATCHING_KEY",`session topic doesn't exist: ${t}`);throw new Error(r)}if(mn(this.client.session.get(t).expiry)){await this.deleteSession(t);const{message:r}=fe("EXPIRED",`session topic: ${t}`);throw new Error(r)}}async isValidSessionOrPairingTopic(t){if(this.client.session.keys.includes(t))await this.isValidSessionTopic(t);else if(this.client.core.pairing.pairings.keys.includes(t))this.isValidPairingTopic(t);else if(Qt(t,!1)){const{message:r}=fe("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${t}`);throw new Error(r)}else{const{message:r}=fe("MISSING_OR_INVALID",`session or pairing topic should be a string: ${t}`);throw new Error(r)}}async isValidProposalId(t){if(!$I(t)){const{message:r}=fe("MISSING_OR_INVALID",`proposal id should be a number: ${t}`);throw new Error(r)}if(!this.client.proposal.keys.includes(t)){const{message:r}=fe("NO_MATCHING_KEY",`proposal id doesn't exist: ${t}`);throw new Error(r)}if(mn(this.client.proposal.get(t).expiry)){await this.deleteProposal(t);const{message:r}=fe("EXPIRED",`proposal id: ${t}`);throw new Error(r)}}}class eS extends Ha{constructor(t,r){super(t,r,kI,uu),this.core=t,this.logger=r}}class tS extends Ha{constructor(t,r){super(t,r,KI,uu),this.core=t,this.logger=r}}class rS extends Ha{constructor(t,r){super(t,r,BI,uu,n=>n.id),this.core=t,this.logger=r}}let iS=class vd extends wb{constructor(t){super(t),this.protocol=pd,this.version=gd,this.name=Tc.name,this.events=new Qr.EventEmitter,this.on=(n,o)=>this.events.on(n,o),this.once=(n,o)=>this.events.once(n,o),this.off=(n,o)=>this.events.off(n,o),this.removeListener=(n,o)=>this.events.removeListener(n,o),this.removeAllListeners=n=>this.events.removeAllListeners(n),this.connect=async n=>{try{return await this.engine.connect(n)}catch(o){throw this.logger.error(o.message),o}},this.pair=async n=>{try{return await this.engine.pair(n)}catch(o){throw this.logger.error(o.message),o}},this.approve=async n=>{try{return await this.engine.approve(n)}catch(o){throw this.logger.error(o.message),o}},this.reject=async n=>{try{return await this.engine.reject(n)}catch(o){throw this.logger.error(o.message),o}},this.update=async n=>{try{return await this.engine.update(n)}catch(o){throw this.logger.error(o.message),o}},this.extend=async n=>{try{return await this.engine.extend(n)}catch(o){throw this.logger.error(o.message),o}},this.request=async n=>{try{return await this.engine.request(n)}catch(o){throw this.logger.error(o.message),o}},this.respond=async n=>{try{return await this.engine.respond(n)}catch(o){throw this.logger.error(o.message),o}},this.ping=async n=>{try{return await this.engine.ping(n)}catch(o){throw this.logger.error(o.message),o}},this.emit=async n=>{try{return await this.engine.emit(n)}catch(o){throw this.logger.error(o.message),o}},this.disconnect=async n=>{try{return await this.engine.disconnect(n)}catch(o){throw this.logger.error(o.message),o}},this.find=n=>{try{return this.engine.find(n)}catch(o){throw this.logger.error(o.message),o}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}},this.name=(t==null?void 0:t.name)||Tc.name,this.metadata=(t==null?void 0:t.metadata)||dI();const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Ne.pino(Ne.getDefaultLoggerOptions({level:(t==null?void 0:t.logger)||Tc.logger}));this.core=(t==null?void 0:t.core)||new sI(t),this.logger=Ne.generateChildLogger(r,this.name),this.session=new tS(this.core,this.logger),this.proposal=new eS(this.core,this.logger),this.pendingRequest=new rS(this.core,this.logger),this.engine=new XI(this)}static async init(t){const r=new vd(t);return await r.initialize(),r}get context(){return Ne.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(t){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(t.message),t}}};var nS={};(function(s){const t=$a,r=Da,n=Ra,o=Ca,l=u=>u==null,y=Symbol("encodeFragmentIdentifier");function b(u){switch(u.arrayFormat){case"index":return d=>(m,g)=>{const p=m.length;return g===void 0||u.skipNull&&g===null||u.skipEmptyString&&g===""?m:g===null?[...m,[E(d,u),"[",p,"]"].join("")]:[...m,[E(d,u),"[",E(p,u),"]=",E(g,u)].join("")]};case"bracket":return d=>(m,g)=>g===void 0||u.skipNull&&g===null||u.skipEmptyString&&g===""?m:g===null?[...m,[E(d,u),"[]"].join("")]:[...m,[E(d,u),"[]=",E(g,u)].join("")];case"colon-list-separator":return d=>(m,g)=>g===void 0||u.skipNull&&g===null||u.skipEmptyString&&g===""?m:g===null?[...m,[E(d,u),":list="].join("")]:[...m,[E(d,u),":list=",E(g,u)].join("")];case"comma":case"separator":case"bracket-separator":{const d=u.arrayFormat==="bracket-separator"?"[]=":"=";return m=>(g,p)=>p===void 0||u.skipNull&&p===null||u.skipEmptyString&&p===""?g:(p=p===null?"":p,g.length===0?[[E(m,u),d,E(p,u)].join("")]:[[g,E(p,u)].join(u.arrayFormatSeparator)])}default:return d=>(m,g)=>g===void 0||u.skipNull&&g===null||u.skipEmptyString&&g===""?m:g===null?[...m,E(d,u)]:[...m,[E(d,u),"=",E(g,u)].join("")]}}function P(u){let d;switch(u.arrayFormat){case"index":return(m,g,p)=>{if(d=/\[(\d*)\]$/.exec(m),m=m.replace(/\[\d*\]$/,""),!d){p[m]=g;return}p[m]===void 0&&(p[m]={}),p[m][d[1]]=g};case"bracket":return(m,g,p)=>{if(d=/(\[\])$/.exec(m),m=m.replace(/\[\]$/,""),!d){p[m]=g;return}if(p[m]===void 0){p[m]=[g];return}p[m]=[].concat(p[m],g)};case"colon-list-separator":return(m,g,p)=>{if(d=/(:list)$/.exec(m),m=m.replace(/:list$/,""),!d){p[m]=g;return}if(p[m]===void 0){p[m]=[g];return}p[m]=[].concat(p[m],g)};case"comma":case"separator":return(m,g,p)=>{const N=typeof g=="string"&&g.includes(u.arrayFormatSeparator),x=typeof g=="string"&&!N&&O(g,u).includes(u.arrayFormatSeparator);g=x?O(g,u):g;const Q=N||x?g.split(u.arrayFormatSeparator).map(se=>O(se,u)):g===null?g:O(g,u);p[m]=Q};case"bracket-separator":return(m,g,p)=>{const N=/(\[\])$/.test(m);if(m=m.replace(/\[\]$/,""),!N){p[m]=g&&O(g,u);return}const x=g===null?[]:g.split(u.arrayFormatSeparator).map(Q=>O(Q,u));if(p[m]===void 0){p[m]=x;return}p[m]=[].concat(p[m],x)};default:return(m,g,p)=>{if(p[m]===void 0){p[m]=g;return}p[m]=[].concat(p[m],g)}}}function _(u){if(typeof u!="string"||u.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function E(u,d){return d.encode?d.strict?t(u):encodeURIComponent(u):u}function O(u,d){return d.decode?r(u):u}function U(u){return Array.isArray(u)?u.sort():typeof u=="object"?U(Object.keys(u)).sort((d,m)=>Number(d)-Number(m)).map(d=>u[d]):u}function H(u){const d=u.indexOf("#");return d!==-1&&(u=u.slice(0,d)),u}function M(u){let d="";const m=u.indexOf("#");return m!==-1&&(d=u.slice(m)),d}function W(u){u=H(u);const d=u.indexOf("?");return d===-1?"":u.slice(d+1)}function ie(u,d){return d.parseNumbers&&!Number.isNaN(Number(u))&&typeof u=="string"&&u.trim()!==""?u=Number(u):d.parseBooleans&&u!==null&&(u.toLowerCase()==="true"||u.toLowerCase()==="false")&&(u=u.toLowerCase()==="true"),u}function ce(u,d){d=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},d),_(d.arrayFormatSeparator);const m=P(d),g=Object.create(null);if(typeof u!="string"||(u=u.trim().replace(/^[?#&]/,""),!u))return g;for(const p of u.split("&")){if(p==="")continue;let[N,x]=n(d.decode?p.replace(/\+/g," "):p,"=");x=x===void 0?null:["comma","separator","bracket-separator"].includes(d.arrayFormat)?x:O(x,d),m(O(N,d),x,g)}for(const p of Object.keys(g)){const N=g[p];if(typeof N=="object"&&N!==null)for(const x of Object.keys(N))N[x]=ie(N[x],d);else g[p]=ie(N,d)}return d.sort===!1?g:(d.sort===!0?Object.keys(g).sort():Object.keys(g).sort(d.sort)).reduce((p,N)=>{const x=g[N];return x&&typeof x=="object"&&!Array.isArray(x)?p[N]=U(x):p[N]=x,p},Object.create(null))}s.extract=W,s.parse=ce,s.stringify=(u,d)=>{if(!u)return"";d=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},d),_(d.arrayFormatSeparator);const m=x=>d.skipNull&&l(u[x])||d.skipEmptyString&&u[x]==="",g=b(d),p={};for(const x of Object.keys(u))m(x)||(p[x]=u[x]);const N=Object.keys(p);return d.sort!==!1&&N.sort(d.sort),N.map(x=>{const Q=u[x];return Q===void 0?"":Q===null?E(x,d):Array.isArray(Q)?Q.length===0&&d.arrayFormat==="bracket-separator"?E(x,d)+"[]":Q.reduce(g(x),[]).join("&"):E(x,d)+"="+E(Q,d)}).filter(x=>x.length>0).join("&")},s.parseUrl=(u,d)=>{d=Object.assign({decode:!0},d);const[m,g]=n(u,"#");return Object.assign({url:m.split("?")[0]||"",query:ce(W(u),d)},d&&d.parseFragmentIdentifier&&g?{fragmentIdentifier:O(g,d)}:{})},s.stringifyUrl=(u,d)=>{d=Object.assign({encode:!0,strict:!0,[y]:!0},d);const m=H(u.url).split("?")[0]||"",g=s.extract(u.url),p=s.parse(g,{sort:!1}),N=Object.assign(p,u.query);let x=s.stringify(N,d);x&&(x=`?${x}`);let Q=M(u.url);return u.fragmentIdentifier&&(Q=`#${d[y]?E(u.fragmentIdentifier,d):u.fragmentIdentifier}`),`${m}${x}${Q}`},s.pick=(u,d,m)=>{m=Object.assign({parseFragmentIdentifier:!0,[y]:!1},m);const{url:g,query:p,fragmentIdentifier:N}=s.parseUrl(u,m);return s.stringifyUrl({url:g,query:o(p,d),fragmentIdentifier:N},m)},s.exclude=(u,d,m)=>{const g=Array.isArray(d)?p=>!d.includes(p):(p,N)=>!d(p,N);return s.pick(u,g,m)}})(nS);const sS=":";function aS(s){const[t,r]=s.split(sS);return{namespace:t,reference:r}}function Rc(s=[],t=[]){return[...new Set([...s,...t])]}function hu(s){return s.includes(":")}function Zn(s){return hu(s)?s.split(":")[0]:s}const oS={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function pf(s,t){const{message:r,code:n}=oS[s];return{message:t?`${r} ${t}`:r,code:n}}function gf(s,t){return Array.isArray(s)?typeof t<"u"&&s.length?s.every(t):!0:!1}function cS(s){return Object.getPrototypeOf(s)===Object.prototype&&Object.keys(s).length}const mf="error",uS="wss://relay.walletconnect.com",hS="wc",lS="universal_provider",yf=`${hS}@2:${lS}:`,fS="https://rpc.walletconnect.com/v1/",fi={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Qn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Gc={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(s,t){(function(){var r,n="4.17.21",o=200,l="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",y="Expected a function",b="Invalid `variable` option passed into `_.template`",P="__lodash_hash_undefined__",_=500,E="__lodash_placeholder__",O=1,U=2,H=4,M=1,W=2,ie=1,ce=2,u=4,d=8,m=16,g=32,p=64,N=128,x=256,Q=512,se=30,Ee="...",Te=800,tt=16,L=1,V=2,Me=3,Ae=1/0,ee=9007199254740991,Y=17976931348623157e292,J=NaN,Z=4294967295,ht=Z-1,ke=Z>>>1,Fr=[["ary",N],["bind",ie],["bindKey",ce],["curry",d],["curryRight",m],["flip",Q],["partial",g],["partialRight",p],["rearg",x]],be="[object Arguments]",St="[object Array]",z="[object AsyncFunction]",q="[object Boolean]",D="[object Date]",h="[object DOMException]",A="[object Error]",ae="[object Function]",de="[object GeneratorFunction]",ve="[object Map]",Re="[object Number]",$e="[object Null]",Se="[object Object]",xt="[object Promise]",wt="[object Proxy]",at="[object RegExp]",Ue="[object Set]",Je="[object String]",Ye="[object Symbol]",ot="[object Undefined]",ze="[object WeakMap]",Ze="[object WeakSet]",Ce="[object ArrayBuffer]",Ke="[object DataView]",lt="[object Float32Array]",Le="[object Float64Array]",Pt="[object Int8Array]",Dt="[object Int16Array]",Ft="[object Int32Array]",Ht="[object Uint8Array]",Lt="[object Uint8ClampedArray]",Yt="[object Uint16Array]",ar="[object Uint32Array]",Hr=/\b__p \+= '';/g,Zt=/\b(__p \+=) '' \+/g,Jr=/(__e\(.*?\)|\b__t\)) \+\n'';/g,di=/&(?:amp|lt|gt|quot|#39);/g,Ni=/[&<>"']/g,ft=RegExp(di.source),rt=RegExp(Ni.source),dt=/<%-([\s\S]+?)%>/g,pt=/<%([\s\S]+?)%>/g,ct=/<%=([\s\S]+?)%>/g,it=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ot=/^\w*$/,Nt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,gt=/[\\^$.*+?()[\]{}|]/g,Tt=RegExp(gt.source),mt=/^\s+/,bt=/\s/,yt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Qe=/\{\n\/\* \[wrapped with (.+)\] \*/,At=/,? & /,Rt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Ka=/[()=,{}\[\]\/\s]/,Va=/\\(\\)?/g,Ba=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,_r=/\w*$/,Ga=/^[-+]0x[0-9a-f]+$/i,Wa=/^0b[01]+$/i,Qa=/^\[object .+?Constructor\]$/,Ja=/^0o[0-7]+$/i,Ya=/^(?:0|[1-9]\d*)$/,Yr=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Qi=/($^)/,Za=/['\n\r\u2028\u2029\\]/g,Ji="\\ud800-\\udfff",Xa="\\u0300-\\u036f",eo="\\ufe20-\\ufe2f",Yi="\\u20d0-\\u20ff",us=Xa+eo+Yi,hs="\\u2700-\\u27bf",Cr="a-z\\xdf-\\xf6\\xf8-\\xff",to="\\xac\\xb1\\xd7\\xf7",ro="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",io="\\u2000-\\u206f",no=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",ls="A-Z\\xc0-\\xd6\\xd8-\\xde",fs="\\ufe0e\\ufe0f",Ti=to+ro+io+no,In="[']",Ai="["+Ji+"]",Sn="["+Ti+"]",Ri="["+us+"]",ds="\\d+",so="["+hs+"]",ps="["+Cr+"]",gs="[^"+Ji+Ti+ds+hs+Cr+ls+"]",Zi="\\ud83c[\\udffb-\\udfff]",ao="(?:"+Ri+"|"+Zi+")",ms="[^"+Ji+"]",Xi="(?:\\ud83c[\\udde6-\\uddff]){2}",pi="[\\ud800-\\udbff][\\udc00-\\udfff]",pr="["+ls+"]",ys="\\u200d",vs="(?:"+ps+"|"+gs+")",kr="(?:"+pr+"|"+gs+")",ws="(?:"+In+"(?:d|ll|m|re|s|t|ve))?",bs="(?:"+In+"(?:D|LL|M|RE|S|T|VE))?",_s=ao+"?",Es="["+fs+"]?",oo="(?:"+ys+"(?:"+[ms,Xi,pi].join("|")+")"+Es+_s+")*",Zr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Is="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Ss=Es+_s+oo,en="(?:"+[so,Xi,pi].join("|")+")"+Ss,co="(?:"+[ms+Ri+"?",Ri,Xi,pi,Ai].join("|")+")",xn=RegExp(In,"g"),uo=RegExp(Ri,"g"),tn=RegExp(Zi+"(?="+Zi+")|"+co+Ss,"g"),xs=RegExp([pr+"?"+ps+"+"+ws+"(?="+[Sn,pr,"$"].join("|")+")",kr+"+"+bs+"(?="+[Sn,pr+vs,"$"].join("|")+")",pr+"?"+vs+"+"+ws,pr+"+"+bs,Is,Zr,ds,en].join("|"),"g"),Ps=RegExp("["+ys+Ji+us+fs+"]"),Ci=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Os=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],ho=-1,Ve={};Ve[lt]=Ve[Le]=Ve[Pt]=Ve[Dt]=Ve[Ft]=Ve[Ht]=Ve[Lt]=Ve[Yt]=Ve[ar]=!0,Ve[be]=Ve[St]=Ve[Ce]=Ve[q]=Ve[Ke]=Ve[D]=Ve[A]=Ve[ae]=Ve[ve]=Ve[Re]=Ve[Se]=Ve[at]=Ve[Ue]=Ve[Je]=Ve[ze]=!1;var Fe={};Fe[be]=Fe[St]=Fe[Ce]=Fe[Ke]=Fe[q]=Fe[D]=Fe[lt]=Fe[Le]=Fe[Pt]=Fe[Dt]=Fe[Ft]=Fe[ve]=Fe[Re]=Fe[Se]=Fe[at]=Fe[Ue]=Fe[Je]=Fe[Ye]=Fe[Ht]=Fe[Lt]=Fe[Yt]=Fe[ar]=!0,Fe[A]=Fe[ae]=Fe[ze]=!1;var I={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},R={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},B={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},te={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Be=parseFloat,ge=parseInt,Xe=typeof Qn=="object"&&Qn&&Qn.Object===Object&&Qn,Ct=typeof self=="object"&&self&&self.Object===Object&&self,Pe=Xe||Ct||Function("return this")(),Ge=t&&!t.nodeType&&t,_t=Ge&&!0&&s&&!s.nodeType&&s,or=_t&&_t.exports===Ge,$t=or&&Xe.process,et=function(){try{var C=_t&&_t.require&&_t.require("util").types;return C||$t&&$t.binding&&$t.binding("util")}catch{}}(),Xt=et&&et.isArrayBuffer,$r=et&&et.isDate,Er=et&&et.isMap,Kr=et&&et.isRegExp,Pn=et&&et.isSet,$i=et&&et.isTypedArray;function qt(C,F,j){switch(j.length){case 0:return C.call(F);case 1:return C.call(F,j[0]);case 2:return C.call(F,j[0],j[1]);case 3:return C.call(F,j[0],j[1],j[2])}return C.apply(F,j)}function _d(C,F,j,re){for(var pe=-1,De=C==null?0:C.length;++pe<De;){var Ut=C[pe];F(re,Ut,j(Ut),C)}return re}function Ir(C,F){for(var j=-1,re=C==null?0:C.length;++j<re&&F(C[j],j,C)!==!1;);return C}function Ed(C,F){for(var j=C==null?0:C.length;j--&&F(C[j],j,C)!==!1;);return C}function du(C,F){for(var j=-1,re=C==null?0:C.length;++j<re;)if(!F(C[j],j,C))return!1;return!0}function gi(C,F){for(var j=-1,re=C==null?0:C.length,pe=0,De=[];++j<re;){var Ut=C[j];F(Ut,j,C)&&(De[pe++]=Ut)}return De}function Ns(C,F){var j=C==null?0:C.length;return!!j&&rn(C,F,0)>-1}function lo(C,F,j){for(var re=-1,pe=C==null?0:C.length;++re<pe;)if(j(F,C[re]))return!0;return!1}function nt(C,F){for(var j=-1,re=C==null?0:C.length,pe=Array(re);++j<re;)pe[j]=F(C[j],j,C);return pe}function mi(C,F){for(var j=-1,re=F.length,pe=C.length;++j<re;)C[pe+j]=F[j];return C}function fo(C,F,j,re){var pe=-1,De=C==null?0:C.length;for(re&&De&&(j=C[++pe]);++pe<De;)j=F(j,C[pe],pe,C);return j}function Id(C,F,j,re){var pe=C==null?0:C.length;for(re&&pe&&(j=C[--pe]);pe--;)j=F(j,C[pe],pe,C);return j}function po(C,F){for(var j=-1,re=C==null?0:C.length;++j<re;)if(F(C[j],j,C))return!0;return!1}var Sd=go("length");function xd(C){return C.split("")}function Pd(C){return C.match(Rt)||[]}function pu(C,F,j){var re;return j(C,function(pe,De,Ut){if(F(pe,De,Ut))return re=De,!1}),re}function Ts(C,F,j,re){for(var pe=C.length,De=j+(re?1:-1);re?De--:++De<pe;)if(F(C[De],De,C))return De;return-1}function rn(C,F,j){return F===F?qd(C,F,j):Ts(C,gu,j)}function Od(C,F,j,re){for(var pe=j-1,De=C.length;++pe<De;)if(re(C[pe],F))return pe;return-1}function gu(C){return C!==C}function mu(C,F){var j=C==null?0:C.length;return j?yo(C,F)/j:J}function go(C){return function(F){return F==null?r:F[C]}}function mo(C){return function(F){return C==null?r:C[F]}}function yu(C,F,j,re,pe){return pe(C,function(De,Ut,We){j=re?(re=!1,De):F(j,De,Ut,We)}),j}function Nd(C,F){var j=C.length;for(C.sort(F);j--;)C[j]=C[j].value;return C}function yo(C,F){for(var j,re=-1,pe=C.length;++re<pe;){var De=F(C[re]);De!==r&&(j=j===r?De:j+De)}return j}function vo(C,F){for(var j=-1,re=Array(C);++j<C;)re[j]=F(j);return re}function Td(C,F){return nt(F,function(j){return[j,C[j]]})}function vu(C){return C&&C.slice(0,Eu(C)+1).replace(mt,"")}function gr(C){return function(F){return C(F)}}function wo(C,F){return nt(F,function(j){return C[j]})}function On(C,F){return C.has(F)}function wu(C,F){for(var j=-1,re=C.length;++j<re&&rn(F,C[j],0)>-1;);return j}function bu(C,F){for(var j=C.length;j--&&rn(F,C[j],0)>-1;);return j}function Ad(C,F){for(var j=C.length,re=0;j--;)C[j]===F&&++re;return re}var Rd=mo(I),Cd=mo(R);function $d(C){return"\\"+te[C]}function Dd(C,F){return C==null?r:C[F]}function nn(C){return Ps.test(C)}function Ud(C){return Ci.test(C)}function jd(C){for(var F,j=[];!(F=C.next()).done;)j.push(F.value);return j}function bo(C){var F=-1,j=Array(C.size);return C.forEach(function(re,pe){j[++F]=[pe,re]}),j}function _u(C,F){return function(j){return C(F(j))}}function yi(C,F){for(var j=-1,re=C.length,pe=0,De=[];++j<re;){var Ut=C[j];(Ut===F||Ut===E)&&(C[j]=E,De[pe++]=j)}return De}function As(C){var F=-1,j=Array(C.size);return C.forEach(function(re){j[++F]=re}),j}function Ld(C){var F=-1,j=Array(C.size);return C.forEach(function(re){j[++F]=[re,re]}),j}function qd(C,F,j){for(var re=j-1,pe=C.length;++re<pe;)if(C[re]===F)return re;return-1}function Md(C,F,j){for(var re=j+1;re--;)if(C[re]===F)return re;return re}function sn(C){return nn(C)?Fd(C):Sd(C)}function Dr(C){return nn(C)?Hd(C):xd(C)}function Eu(C){for(var F=C.length;F--&&bt.test(C.charAt(F)););return F}var zd=mo(B);function Fd(C){for(var F=tn.lastIndex=0;tn.test(C);)++F;return F}function Hd(C){return C.match(tn)||[]}function kd(C){return C.match(xs)||[]}var Kd=function C(F){F=F==null?Pe:an.defaults(Pe.Object(),F,an.pick(Pe,Os));var j=F.Array,re=F.Date,pe=F.Error,De=F.Function,Ut=F.Math,We=F.Object,_o=F.RegExp,Vd=F.String,Sr=F.TypeError,Rs=j.prototype,Bd=De.prototype,on=We.prototype,Cs=F["__core-js_shared__"],$s=Bd.toString,qe=on.hasOwnProperty,Gd=0,Iu=function(){var e=/[^.]+$/.exec(Cs&&Cs.keys&&Cs.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Ds=on.toString,Wd=$s.call(We),Qd=Pe._,Jd=_o("^"+$s.call(qe).replace(gt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Us=or?F.Buffer:r,vi=F.Symbol,js=F.Uint8Array,Su=Us?Us.allocUnsafe:r,Ls=_u(We.getPrototypeOf,We),xu=We.create,Pu=on.propertyIsEnumerable,qs=Rs.splice,Ou=vi?vi.isConcatSpreadable:r,Nn=vi?vi.iterator:r,Di=vi?vi.toStringTag:r,Ms=function(){try{var e=Mi(We,"defineProperty");return e({},"",{}),e}catch{}}(),Yd=F.clearTimeout!==Pe.clearTimeout&&F.clearTimeout,Zd=re&&re.now!==Pe.Date.now&&re.now,Xd=F.setTimeout!==Pe.setTimeout&&F.setTimeout,zs=Ut.ceil,Fs=Ut.floor,Eo=We.getOwnPropertySymbols,ep=Us?Us.isBuffer:r,Nu=F.isFinite,tp=Rs.join,rp=_u(We.keys,We),jt=Ut.max,Bt=Ut.min,ip=re.now,np=F.parseInt,Tu=Ut.random,sp=Rs.reverse,Io=Mi(F,"DataView"),Tn=Mi(F,"Map"),So=Mi(F,"Promise"),cn=Mi(F,"Set"),An=Mi(F,"WeakMap"),Rn=Mi(We,"create"),Hs=An&&new An,un={},ap=zi(Io),op=zi(Tn),cp=zi(So),up=zi(cn),hp=zi(An),ks=vi?vi.prototype:r,Cn=ks?ks.valueOf:r,Au=ks?ks.toString:r;function v(e){if(vt(e)&&!me(e)&&!(e instanceof xe)){if(e instanceof xr)return e;if(qe.call(e,"__wrapped__"))return Rh(e)}return new xr(e)}var hn=function(){function e(){}return function(i){if(!ut(i))return{};if(xu)return xu(i);e.prototype=i;var a=new e;return e.prototype=r,a}}();function Ks(){}function xr(e,i){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!i,this.__index__=0,this.__values__=r}v.templateSettings={escape:dt,evaluate:pt,interpolate:ct,variable:"",imports:{_:v}},v.prototype=Ks.prototype,v.prototype.constructor=v,xr.prototype=hn(Ks.prototype),xr.prototype.constructor=xr;function xe(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Z,this.__views__=[]}function lp(){var e=new xe(this.__wrapped__);return e.__actions__=cr(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=cr(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=cr(this.__views__),e}function fp(){if(this.__filtered__){var e=new xe(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function dp(){var e=this.__wrapped__.value(),i=this.__dir__,a=me(e),c=i<0,f=a?e.length:0,w=xg(0,f,this.__views__),S=w.start,T=w.end,$=T-S,k=c?T:S-1,K=this.__iteratees__,G=K.length,X=0,oe=Bt($,this.__takeCount__);if(!a||!c&&f==$&&oe==$)return eh(e,this.__actions__);var he=[];e:for(;$--&&X<oe;){k+=i;for(var we=-1,le=e[k];++we<G;){var Ie=K[we],Oe=Ie.iteratee,vr=Ie.type,rr=Oe(le);if(vr==V)le=rr;else if(!rr){if(vr==L)continue e;break e}}he[X++]=le}return he}xe.prototype=hn(Ks.prototype),xe.prototype.constructor=xe;function Ui(e){var i=-1,a=e==null?0:e.length;for(this.clear();++i<a;){var c=e[i];this.set(c[0],c[1])}}function pp(){this.__data__=Rn?Rn(null):{},this.size=0}function gp(e){var i=this.has(e)&&delete this.__data__[e];return this.size-=i?1:0,i}function mp(e){var i=this.__data__;if(Rn){var a=i[e];return a===P?r:a}return qe.call(i,e)?i[e]:r}function yp(e){var i=this.__data__;return Rn?i[e]!==r:qe.call(i,e)}function vp(e,i){var a=this.__data__;return this.size+=this.has(e)?0:1,a[e]=Rn&&i===r?P:i,this}Ui.prototype.clear=pp,Ui.prototype.delete=gp,Ui.prototype.get=mp,Ui.prototype.has=yp,Ui.prototype.set=vp;function Xr(e){var i=-1,a=e==null?0:e.length;for(this.clear();++i<a;){var c=e[i];this.set(c[0],c[1])}}function wp(){this.__data__=[],this.size=0}function bp(e){var i=this.__data__,a=Vs(i,e);if(a<0)return!1;var c=i.length-1;return a==c?i.pop():qs.call(i,a,1),--this.size,!0}function _p(e){var i=this.__data__,a=Vs(i,e);return a<0?r:i[a][1]}function Ep(e){return Vs(this.__data__,e)>-1}function Ip(e,i){var a=this.__data__,c=Vs(a,e);return c<0?(++this.size,a.push([e,i])):a[c][1]=i,this}Xr.prototype.clear=wp,Xr.prototype.delete=bp,Xr.prototype.get=_p,Xr.prototype.has=Ep,Xr.prototype.set=Ip;function ei(e){var i=-1,a=e==null?0:e.length;for(this.clear();++i<a;){var c=e[i];this.set(c[0],c[1])}}function Sp(){this.size=0,this.__data__={hash:new Ui,map:new(Tn||Xr),string:new Ui}}function xp(e){var i=ia(this,e).delete(e);return this.size-=i?1:0,i}function Pp(e){return ia(this,e).get(e)}function Op(e){return ia(this,e).has(e)}function Np(e,i){var a=ia(this,e),c=a.size;return a.set(e,i),this.size+=a.size==c?0:1,this}ei.prototype.clear=Sp,ei.prototype.delete=xp,ei.prototype.get=Pp,ei.prototype.has=Op,ei.prototype.set=Np;function ji(e){var i=-1,a=e==null?0:e.length;for(this.__data__=new ei;++i<a;)this.add(e[i])}function Tp(e){return this.__data__.set(e,P),this}function Ap(e){return this.__data__.has(e)}ji.prototype.add=ji.prototype.push=Tp,ji.prototype.has=Ap;function Ur(e){var i=this.__data__=new Xr(e);this.size=i.size}function Rp(){this.__data__=new Xr,this.size=0}function Cp(e){var i=this.__data__,a=i.delete(e);return this.size=i.size,a}function $p(e){return this.__data__.get(e)}function Dp(e){return this.__data__.has(e)}function Up(e,i){var a=this.__data__;if(a instanceof Xr){var c=a.__data__;if(!Tn||c.length<o-1)return c.push([e,i]),this.size=++a.size,this;a=this.__data__=new ei(c)}return a.set(e,i),this.size=a.size,this}Ur.prototype.clear=Rp,Ur.prototype.delete=Cp,Ur.prototype.get=$p,Ur.prototype.has=Dp,Ur.prototype.set=Up;function Ru(e,i){var a=me(e),c=!a&&Fi(e),f=!a&&!c&&Ii(e),w=!a&&!c&&!f&&pn(e),S=a||c||f||w,T=S?vo(e.length,Vd):[],$=T.length;for(var k in e)(i||qe.call(e,k))&&!(S&&(k=="length"||f&&(k=="offset"||k=="parent")||w&&(k=="buffer"||k=="byteLength"||k=="byteOffset")||ni(k,$)))&&T.push(k);return T}function Cu(e){var i=e.length;return i?e[Uo(0,i-1)]:r}function jp(e,i){return na(cr(e),Li(i,0,e.length))}function Lp(e){return na(cr(e))}function xo(e,i,a){(a!==r&&!jr(e[i],a)||a===r&&!(i in e))&&ti(e,i,a)}function $n(e,i,a){var c=e[i];(!(qe.call(e,i)&&jr(c,a))||a===r&&!(i in e))&&ti(e,i,a)}function Vs(e,i){for(var a=e.length;a--;)if(jr(e[a][0],i))return a;return-1}function qp(e,i,a,c){return wi(e,function(f,w,S){i(c,f,a(f),S)}),c}function $u(e,i){return e&&Br(i,Mt(i),e)}function Mp(e,i){return e&&Br(i,hr(i),e)}function ti(e,i,a){i=="__proto__"&&Ms?Ms(e,i,{configurable:!0,enumerable:!0,value:a,writable:!0}):e[i]=a}function Po(e,i){for(var a=-1,c=i.length,f=j(c),w=e==null;++a<c;)f[a]=w?r:ac(e,i[a]);return f}function Li(e,i,a){return e===e&&(a!==r&&(e=e<=a?e:a),i!==r&&(e=e>=i?e:i)),e}function Pr(e,i,a,c,f,w){var S,T=i&O,$=i&U,k=i&H;if(a&&(S=f?a(e,c,f,w):a(e)),S!==r)return S;if(!ut(e))return e;var K=me(e);if(K){if(S=Og(e),!T)return cr(e,S)}else{var G=Gt(e),X=G==ae||G==de;if(Ii(e))return ih(e,T);if(G==Se||G==be||X&&!f){if(S=$||X?{}:Eh(e),!T)return $?mg(e,Mp(S,e)):gg(e,$u(S,e))}else{if(!Fe[G])return f?e:{};S=Ng(e,G,T)}}w||(w=new Ur);var oe=w.get(e);if(oe)return oe;w.set(e,S),Yh(e)?e.forEach(function(le){S.add(Pr(le,i,a,le,e,w))}):Qh(e)&&e.forEach(function(le,Ie){S.set(Ie,Pr(le,i,a,Ie,e,w))});var he=k?$?Bo:Vo:$?hr:Mt,we=K?r:he(e);return Ir(we||e,function(le,Ie){we&&(Ie=le,le=e[Ie]),$n(S,Ie,Pr(le,i,a,Ie,e,w))}),S}function zp(e){var i=Mt(e);return function(a){return Du(a,e,i)}}function Du(e,i,a){var c=a.length;if(e==null)return!c;for(e=We(e);c--;){var f=a[c],w=i[f],S=e[f];if(S===r&&!(f in e)||!w(S))return!1}return!0}function Uu(e,i,a){if(typeof e!="function")throw new Sr(y);return zn(function(){e.apply(r,a)},i)}function Dn(e,i,a,c){var f=-1,w=Ns,S=!0,T=e.length,$=[],k=i.length;if(!T)return $;a&&(i=nt(i,gr(a))),c?(w=lo,S=!1):i.length>=o&&(w=On,S=!1,i=new ji(i));e:for(;++f<T;){var K=e[f],G=a==null?K:a(K);if(K=c||K!==0?K:0,S&&G===G){for(var X=k;X--;)if(i[X]===G)continue e;$.push(K)}else w(i,G,c)||$.push(K)}return $}var wi=ch(Vr),ju=ch(No,!0);function Fp(e,i){var a=!0;return wi(e,function(c,f,w){return a=!!i(c,f,w),a}),a}function Bs(e,i,a){for(var c=-1,f=e.length;++c<f;){var w=e[c],S=i(w);if(S!=null&&(T===r?S===S&&!yr(S):a(S,T)))var T=S,$=w}return $}function Hp(e,i,a,c){var f=e.length;for(a=ye(a),a<0&&(a=-a>f?0:f+a),c=c===r||c>f?f:ye(c),c<0&&(c+=f),c=a>c?0:Xh(c);a<c;)e[a++]=i;return e}function Lu(e,i){var a=[];return wi(e,function(c,f,w){i(c,f,w)&&a.push(c)}),a}function kt(e,i,a,c,f){var w=-1,S=e.length;for(a||(a=Ag),f||(f=[]);++w<S;){var T=e[w];i>0&&a(T)?i>1?kt(T,i-1,a,c,f):mi(f,T):c||(f[f.length]=T)}return f}var Oo=uh(),qu=uh(!0);function Vr(e,i){return e&&Oo(e,i,Mt)}function No(e,i){return e&&qu(e,i,Mt)}function Gs(e,i){return gi(i,function(a){return si(e[a])})}function qi(e,i){i=_i(i,e);for(var a=0,c=i.length;e!=null&&a<c;)e=e[Gr(i[a++])];return a&&a==c?e:r}function Mu(e,i,a){var c=i(e);return me(e)?c:mi(c,a(e))}function er(e){return e==null?e===r?ot:$e:Di&&Di in We(e)?Sg(e):Lg(e)}function To(e,i){return e>i}function kp(e,i){return e!=null&&qe.call(e,i)}function Kp(e,i){return e!=null&&i in We(e)}function Vp(e,i,a){return e>=Bt(i,a)&&e<jt(i,a)}function Ao(e,i,a){for(var c=a?lo:Ns,f=e[0].length,w=e.length,S=w,T=j(w),$=1/0,k=[];S--;){var K=e[S];S&&i&&(K=nt(K,gr(i))),$=Bt(K.length,$),T[S]=!a&&(i||f>=120&&K.length>=120)?new ji(S&&K):r}K=e[0];var G=-1,X=T[0];e:for(;++G<f&&k.length<$;){var oe=K[G],he=i?i(oe):oe;if(oe=a||oe!==0?oe:0,!(X?On(X,he):c(k,he,a))){for(S=w;--S;){var we=T[S];if(!(we?On(we,he):c(e[S],he,a)))continue e}X&&X.push(he),k.push(oe)}}return k}function Bp(e,i,a,c){return Vr(e,function(f,w,S){i(c,a(f),w,S)}),c}function Un(e,i,a){i=_i(i,e),e=Ph(e,i);var c=e==null?e:e[Gr(Nr(i))];return c==null?r:qt(c,e,a)}function zu(e){return vt(e)&&er(e)==be}function Gp(e){return vt(e)&&er(e)==Ce}function Wp(e){return vt(e)&&er(e)==D}function jn(e,i,a,c,f){return e===i?!0:e==null||i==null||!vt(e)&&!vt(i)?e!==e&&i!==i:Qp(e,i,a,c,jn,f)}function Qp(e,i,a,c,f,w){var S=me(e),T=me(i),$=S?St:Gt(e),k=T?St:Gt(i);$=$==be?Se:$,k=k==be?Se:k;var K=$==Se,G=k==Se,X=$==k;if(X&&Ii(e)){if(!Ii(i))return!1;S=!0,K=!1}if(X&&!K)return w||(w=new Ur),S||pn(e)?wh(e,i,a,c,f,w):Eg(e,i,$,a,c,f,w);if(!(a&M)){var oe=K&&qe.call(e,"__wrapped__"),he=G&&qe.call(i,"__wrapped__");if(oe||he){var we=oe?e.value():e,le=he?i.value():i;return w||(w=new Ur),f(we,le,a,c,w)}}return X?(w||(w=new Ur),Ig(e,i,a,c,f,w)):!1}function Jp(e){return vt(e)&&Gt(e)==ve}function Ro(e,i,a,c){var f=a.length,w=f,S=!c;if(e==null)return!w;for(e=We(e);f--;){var T=a[f];if(S&&T[2]?T[1]!==e[T[0]]:!(T[0]in e))return!1}for(;++f<w;){T=a[f];var $=T[0],k=e[$],K=T[1];if(S&&T[2]){if(k===r&&!($ in e))return!1}else{var G=new Ur;if(c)var X=c(k,K,$,e,i,G);if(!(X===r?jn(K,k,M|W,c,G):X))return!1}}return!0}function Fu(e){if(!ut(e)||Cg(e))return!1;var i=si(e)?Jd:Qa;return i.test(zi(e))}function Yp(e){return vt(e)&&er(e)==at}function Zp(e){return vt(e)&&Gt(e)==Ue}function Xp(e){return vt(e)&&ha(e.length)&&!!Ve[er(e)]}function Hu(e){return typeof e=="function"?e:e==null?lr:typeof e=="object"?me(e)?Vu(e[0],e[1]):Ku(e):hl(e)}function Co(e){if(!Mn(e))return rp(e);var i=[];for(var a in We(e))qe.call(e,a)&&a!="constructor"&&i.push(a);return i}function eg(e){if(!ut(e))return jg(e);var i=Mn(e),a=[];for(var c in e)c=="constructor"&&(i||!qe.call(e,c))||a.push(c);return a}function $o(e,i){return e<i}function ku(e,i){var a=-1,c=ur(e)?j(e.length):[];return wi(e,function(f,w,S){c[++a]=i(f,w,S)}),c}function Ku(e){var i=Wo(e);return i.length==1&&i[0][2]?Sh(i[0][0],i[0][1]):function(a){return a===e||Ro(a,e,i)}}function Vu(e,i){return Jo(e)&&Ih(i)?Sh(Gr(e),i):function(a){var c=ac(a,e);return c===r&&c===i?oc(a,e):jn(i,c,M|W)}}function Ws(e,i,a,c,f){e!==i&&Oo(i,function(w,S){if(f||(f=new Ur),ut(w))tg(e,i,S,a,Ws,c,f);else{var T=c?c(Zo(e,S),w,S+"",e,i,f):r;T===r&&(T=w),xo(e,S,T)}},hr)}function tg(e,i,a,c,f,w,S){var T=Zo(e,a),$=Zo(i,a),k=S.get($);if(k){xo(e,a,k);return}var K=w?w(T,$,a+"",e,i,S):r,G=K===r;if(G){var X=me($),oe=!X&&Ii($),he=!X&&!oe&&pn($);K=$,X||oe||he?me(T)?K=T:Et(T)?K=cr(T):oe?(G=!1,K=ih($,!0)):he?(G=!1,K=nh($,!0)):K=[]:Fn($)||Fi($)?(K=T,Fi(T)?K=el(T):(!ut(T)||si(T))&&(K=Eh($))):G=!1}G&&(S.set($,K),f(K,$,c,w,S),S.delete($)),xo(e,a,K)}function Bu(e,i){var a=e.length;if(a)return i+=i<0?a:0,ni(i,a)?e[i]:r}function Gu(e,i,a){i.length?i=nt(i,function(w){return me(w)?function(S){return qi(S,w.length===1?w[0]:w)}:w}):i=[lr];var c=-1;i=nt(i,gr(ue()));var f=ku(e,function(w,S,T){var $=nt(i,function(k){return k(w)});return{criteria:$,index:++c,value:w}});return Nd(f,function(w,S){return pg(w,S,a)})}function rg(e,i){return Wu(e,i,function(a,c){return oc(e,c)})}function Wu(e,i,a){for(var c=-1,f=i.length,w={};++c<f;){var S=i[c],T=qi(e,S);a(T,S)&&Ln(w,_i(S,e),T)}return w}function ig(e){return function(i){return qi(i,e)}}function Do(e,i,a,c){var f=c?Od:rn,w=-1,S=i.length,T=e;for(e===i&&(i=cr(i)),a&&(T=nt(e,gr(a)));++w<S;)for(var $=0,k=i[w],K=a?a(k):k;($=f(T,K,$,c))>-1;)T!==e&&qs.call(T,$,1),qs.call(e,$,1);return e}function Qu(e,i){for(var a=e?i.length:0,c=a-1;a--;){var f=i[a];if(a==c||f!==w){var w=f;ni(f)?qs.call(e,f,1):qo(e,f)}}return e}function Uo(e,i){return e+Fs(Tu()*(i-e+1))}function ng(e,i,a,c){for(var f=-1,w=jt(zs((i-e)/(a||1)),0),S=j(w);w--;)S[c?w:++f]=e,e+=a;return S}function jo(e,i){var a="";if(!e||i<1||i>ee)return a;do i%2&&(a+=e),i=Fs(i/2),i&&(e+=e);while(i);return a}function _e(e,i){return Xo(xh(e,i,lr),e+"")}function sg(e){return Cu(gn(e))}function ag(e,i){var a=gn(e);return na(a,Li(i,0,a.length))}function Ln(e,i,a,c){if(!ut(e))return e;i=_i(i,e);for(var f=-1,w=i.length,S=w-1,T=e;T!=null&&++f<w;){var $=Gr(i[f]),k=a;if($==="__proto__"||$==="constructor"||$==="prototype")return e;if(f!=S){var K=T[$];k=c?c(K,$,T):r,k===r&&(k=ut(K)?K:ni(i[f+1])?[]:{})}$n(T,$,k),T=T[$]}return e}var Ju=Hs?function(e,i){return Hs.set(e,i),e}:lr,og=Ms?function(e,i){return Ms(e,"toString",{configurable:!0,enumerable:!1,value:uc(i),writable:!0})}:lr;function cg(e){return na(gn(e))}function Or(e,i,a){var c=-1,f=e.length;i<0&&(i=-i>f?0:f+i),a=a>f?f:a,a<0&&(a+=f),f=i>a?0:a-i>>>0,i>>>=0;for(var w=j(f);++c<f;)w[c]=e[c+i];return w}function ug(e,i){var a;return wi(e,function(c,f,w){return a=i(c,f,w),!a}),!!a}function Qs(e,i,a){var c=0,f=e==null?c:e.length;if(typeof i=="number"&&i===i&&f<=ke){for(;c<f;){var w=c+f>>>1,S=e[w];S!==null&&!yr(S)&&(a?S<=i:S<i)?c=w+1:f=w}return f}return Lo(e,i,lr,a)}function Lo(e,i,a,c){var f=0,w=e==null?0:e.length;if(w===0)return 0;i=a(i);for(var S=i!==i,T=i===null,$=yr(i),k=i===r;f<w;){var K=Fs((f+w)/2),G=a(e[K]),X=G!==r,oe=G===null,he=G===G,we=yr(G);if(S)var le=c||he;else k?le=he&&(c||X):T?le=he&&X&&(c||!oe):$?le=he&&X&&!oe&&(c||!we):oe||we?le=!1:le=c?G<=i:G<i;le?f=K+1:w=K}return Bt(w,ht)}function Yu(e,i){for(var a=-1,c=e.length,f=0,w=[];++a<c;){var S=e[a],T=i?i(S):S;if(!a||!jr(T,$)){var $=T;w[f++]=S===0?0:S}}return w}function Zu(e){return typeof e=="number"?e:yr(e)?J:+e}function mr(e){if(typeof e=="string")return e;if(me(e))return nt(e,mr)+"";if(yr(e))return Au?Au.call(e):"";var i=e+"";return i=="0"&&1/e==-Ae?"-0":i}function bi(e,i,a){var c=-1,f=Ns,w=e.length,S=!0,T=[],$=T;if(a)S=!1,f=lo;else if(w>=o){var k=i?null:bg(e);if(k)return As(k);S=!1,f=On,$=new ji}else $=i?[]:T;e:for(;++c<w;){var K=e[c],G=i?i(K):K;if(K=a||K!==0?K:0,S&&G===G){for(var X=$.length;X--;)if($[X]===G)continue e;i&&$.push(G),T.push(K)}else f($,G,a)||($!==T&&$.push(G),T.push(K))}return T}function qo(e,i){return i=_i(i,e),e=Ph(e,i),e==null||delete e[Gr(Nr(i))]}function Xu(e,i,a,c){return Ln(e,i,a(qi(e,i)),c)}function Js(e,i,a,c){for(var f=e.length,w=c?f:-1;(c?w--:++w<f)&&i(e[w],w,e););return a?Or(e,c?0:w,c?w+1:f):Or(e,c?w+1:0,c?f:w)}function eh(e,i){var a=e;return a instanceof xe&&(a=a.value()),fo(i,function(c,f){return f.func.apply(f.thisArg,mi([c],f.args))},a)}function Mo(e,i,a){var c=e.length;if(c<2)return c?bi(e[0]):[];for(var f=-1,w=j(c);++f<c;)for(var S=e[f],T=-1;++T<c;)T!=f&&(w[f]=Dn(w[f]||S,e[T],i,a));return bi(kt(w,1),i,a)}function th(e,i,a){for(var c=-1,f=e.length,w=i.length,S={};++c<f;){var T=c<w?i[c]:r;a(S,e[c],T)}return S}function zo(e){return Et(e)?e:[]}function Fo(e){return typeof e=="function"?e:lr}function _i(e,i){return me(e)?e:Jo(e,i)?[e]:Ah(je(e))}var hg=_e;function Ei(e,i,a){var c=e.length;return a=a===r?c:a,!i&&a>=c?e:Or(e,i,a)}var rh=Yd||function(e){return Pe.clearTimeout(e)};function ih(e,i){if(i)return e.slice();var a=e.length,c=Su?Su(a):new e.constructor(a);return e.copy(c),c}function Ho(e){var i=new e.constructor(e.byteLength);return new js(i).set(new js(e)),i}function lg(e,i){var a=i?Ho(e.buffer):e.buffer;return new e.constructor(a,e.byteOffset,e.byteLength)}function fg(e){var i=new e.constructor(e.source,_r.exec(e));return i.lastIndex=e.lastIndex,i}function dg(e){return Cn?We(Cn.call(e)):{}}function nh(e,i){var a=i?Ho(e.buffer):e.buffer;return new e.constructor(a,e.byteOffset,e.length)}function sh(e,i){if(e!==i){var a=e!==r,c=e===null,f=e===e,w=yr(e),S=i!==r,T=i===null,$=i===i,k=yr(i);if(!T&&!k&&!w&&e>i||w&&S&&$&&!T&&!k||c&&S&&$||!a&&$||!f)return 1;if(!c&&!w&&!k&&e<i||k&&a&&f&&!c&&!w||T&&a&&f||!S&&f||!$)return-1}return 0}function pg(e,i,a){for(var c=-1,f=e.criteria,w=i.criteria,S=f.length,T=a.length;++c<S;){var $=sh(f[c],w[c]);if($){if(c>=T)return $;var k=a[c];return $*(k=="desc"?-1:1)}}return e.index-i.index}function ah(e,i,a,c){for(var f=-1,w=e.length,S=a.length,T=-1,$=i.length,k=jt(w-S,0),K=j($+k),G=!c;++T<$;)K[T]=i[T];for(;++f<S;)(G||f<w)&&(K[a[f]]=e[f]);for(;k--;)K[T++]=e[f++];return K}function oh(e,i,a,c){for(var f=-1,w=e.length,S=-1,T=a.length,$=-1,k=i.length,K=jt(w-T,0),G=j(K+k),X=!c;++f<K;)G[f]=e[f];for(var oe=f;++$<k;)G[oe+$]=i[$];for(;++S<T;)(X||f<w)&&(G[oe+a[S]]=e[f++]);return G}function cr(e,i){var a=-1,c=e.length;for(i||(i=j(c));++a<c;)i[a]=e[a];return i}function Br(e,i,a,c){var f=!a;a||(a={});for(var w=-1,S=i.length;++w<S;){var T=i[w],$=c?c(a[T],e[T],T,a,e):r;$===r&&($=e[T]),f?ti(a,T,$):$n(a,T,$)}return a}function gg(e,i){return Br(e,Qo(e),i)}function mg(e,i){return Br(e,bh(e),i)}function Ys(e,i){return function(a,c){var f=me(a)?_d:qp,w=i?i():{};return f(a,e,ue(c,2),w)}}function ln(e){return _e(function(i,a){var c=-1,f=a.length,w=f>1?a[f-1]:r,S=f>2?a[2]:r;for(w=e.length>3&&typeof w=="function"?(f--,w):r,S&&tr(a[0],a[1],S)&&(w=f<3?r:w,f=1),i=We(i);++c<f;){var T=a[c];T&&e(i,T,c,w)}return i})}function ch(e,i){return function(a,c){if(a==null)return a;if(!ur(a))return e(a,c);for(var f=a.length,w=i?f:-1,S=We(a);(i?w--:++w<f)&&c(S[w],w,S)!==!1;);return a}}function uh(e){return function(i,a,c){for(var f=-1,w=We(i),S=c(i),T=S.length;T--;){var $=S[e?T:++f];if(a(w[$],$,w)===!1)break}return i}}function yg(e,i,a){var c=i&ie,f=qn(e);function w(){var S=this&&this!==Pe&&this instanceof w?f:e;return S.apply(c?a:this,arguments)}return w}function hh(e){return function(i){i=je(i);var a=nn(i)?Dr(i):r,c=a?a[0]:i.charAt(0),f=a?Ei(a,1).join(""):i.slice(1);return c[e]()+f}}function fn(e){return function(i){return fo(cl(ol(i).replace(xn,"")),e,"")}}function qn(e){return function(){var i=arguments;switch(i.length){case 0:return new e;case 1:return new e(i[0]);case 2:return new e(i[0],i[1]);case 3:return new e(i[0],i[1],i[2]);case 4:return new e(i[0],i[1],i[2],i[3]);case 5:return new e(i[0],i[1],i[2],i[3],i[4]);case 6:return new e(i[0],i[1],i[2],i[3],i[4],i[5]);case 7:return new e(i[0],i[1],i[2],i[3],i[4],i[5],i[6])}var a=hn(e.prototype),c=e.apply(a,i);return ut(c)?c:a}}function vg(e,i,a){var c=qn(e);function f(){for(var w=arguments.length,S=j(w),T=w,$=dn(f);T--;)S[T]=arguments[T];var k=w<3&&S[0]!==$&&S[w-1]!==$?[]:yi(S,$);if(w-=k.length,w<a)return gh(e,i,Zs,f.placeholder,r,S,k,r,r,a-w);var K=this&&this!==Pe&&this instanceof f?c:e;return qt(K,this,S)}return f}function lh(e){return function(i,a,c){var f=We(i);if(!ur(i)){var w=ue(a,3);i=Mt(i),a=function(T){return w(f[T],T,f)}}var S=e(i,a,c);return S>-1?f[w?i[S]:S]:r}}function fh(e){return ii(function(i){var a=i.length,c=a,f=xr.prototype.thru;for(e&&i.reverse();c--;){var w=i[c];if(typeof w!="function")throw new Sr(y);if(f&&!S&&ra(w)=="wrapper")var S=new xr([],!0)}for(c=S?c:a;++c<a;){w=i[c];var T=ra(w),$=T=="wrapper"?Go(w):r;$&&Yo($[0])&&$[1]==(N|d|g|x)&&!$[4].length&&$[9]==1?S=S[ra($[0])].apply(S,$[3]):S=w.length==1&&Yo(w)?S[T]():S.thru(w)}return function(){var k=arguments,K=k[0];if(S&&k.length==1&&me(K))return S.plant(K).value();for(var G=0,X=a?i[G].apply(this,k):K;++G<a;)X=i[G].call(this,X);return X}})}function Zs(e,i,a,c,f,w,S,T,$,k){var K=i&N,G=i&ie,X=i&ce,oe=i&(d|m),he=i&Q,we=X?r:qn(e);function le(){for(var Ie=arguments.length,Oe=j(Ie),vr=Ie;vr--;)Oe[vr]=arguments[vr];if(oe)var rr=dn(le),wr=Ad(Oe,rr);if(c&&(Oe=ah(Oe,c,f,oe)),w&&(Oe=oh(Oe,w,S,oe)),Ie-=wr,oe&&Ie<k){var It=yi(Oe,rr);return gh(e,i,Zs,le.placeholder,a,Oe,It,T,$,k-Ie)}var Lr=G?a:this,oi=X?Lr[e]:e;return Ie=Oe.length,T?Oe=qg(Oe,T):he&&Ie>1&&Oe.reverse(),K&&$<Ie&&(Oe.length=$),this&&this!==Pe&&this instanceof le&&(oi=we||qn(oi)),oi.apply(Lr,Oe)}return le}function dh(e,i){return function(a,c){return Bp(a,e,i(c),{})}}function Xs(e,i){return function(a,c){var f;if(a===r&&c===r)return i;if(a!==r&&(f=a),c!==r){if(f===r)return c;typeof a=="string"||typeof c=="string"?(a=mr(a),c=mr(c)):(a=Zu(a),c=Zu(c)),f=e(a,c)}return f}}function ko(e){return ii(function(i){return i=nt(i,gr(ue())),_e(function(a){var c=this;return e(i,function(f){return qt(f,c,a)})})})}function ea(e,i){i=i===r?" ":mr(i);var a=i.length;if(a<2)return a?jo(i,e):i;var c=jo(i,zs(e/sn(i)));return nn(i)?Ei(Dr(c),0,e).join(""):c.slice(0,e)}function wg(e,i,a,c){var f=i&ie,w=qn(e);function S(){for(var T=-1,$=arguments.length,k=-1,K=c.length,G=j(K+$),X=this&&this!==Pe&&this instanceof S?w:e;++k<K;)G[k]=c[k];for(;$--;)G[k++]=arguments[++T];return qt(X,f?a:this,G)}return S}function ph(e){return function(i,a,c){return c&&typeof c!="number"&&tr(i,a,c)&&(a=c=r),i=ai(i),a===r?(a=i,i=0):a=ai(a),c=c===r?i<a?1:-1:ai(c),ng(i,a,c,e)}}function ta(e){return function(i,a){return typeof i=="string"&&typeof a=="string"||(i=Tr(i),a=Tr(a)),e(i,a)}}function gh(e,i,a,c,f,w,S,T,$,k){var K=i&d,G=K?S:r,X=K?r:S,oe=K?w:r,he=K?r:w;i|=K?g:p,i&=~(K?p:g),i&u||(i&=~(ie|ce));var we=[e,i,f,oe,G,he,X,T,$,k],le=a.apply(r,we);return Yo(e)&&Oh(le,we),le.placeholder=c,Nh(le,e,i)}function Ko(e){var i=Ut[e];return function(a,c){if(a=Tr(a),c=c==null?0:Bt(ye(c),292),c&&Nu(a)){var f=(je(a)+"e").split("e"),w=i(f[0]+"e"+(+f[1]+c));return f=(je(w)+"e").split("e"),+(f[0]+"e"+(+f[1]-c))}return i(a)}}var bg=cn&&1/As(new cn([,-0]))[1]==Ae?function(e){return new cn(e)}:fc;function mh(e){return function(i){var a=Gt(i);return a==ve?bo(i):a==Ue?Ld(i):Td(i,e(i))}}function ri(e,i,a,c,f,w,S,T){var $=i&ce;if(!$&&typeof e!="function")throw new Sr(y);var k=c?c.length:0;if(k||(i&=~(g|p),c=f=r),S=S===r?S:jt(ye(S),0),T=T===r?T:ye(T),k-=f?f.length:0,i&p){var K=c,G=f;c=f=r}var X=$?r:Go(e),oe=[e,i,a,c,f,K,G,w,S,T];if(X&&Ug(oe,X),e=oe[0],i=oe[1],a=oe[2],c=oe[3],f=oe[4],T=oe[9]=oe[9]===r?$?0:e.length:jt(oe[9]-k,0),!T&&i&(d|m)&&(i&=~(d|m)),!i||i==ie)var he=yg(e,i,a);else i==d||i==m?he=vg(e,i,T):(i==g||i==(ie|g))&&!f.length?he=wg(e,i,a,c):he=Zs.apply(r,oe);var we=X?Ju:Oh;return Nh(we(he,oe),e,i)}function yh(e,i,a,c){return e===r||jr(e,on[a])&&!qe.call(c,a)?i:e}function vh(e,i,a,c,f,w){return ut(e)&&ut(i)&&(w.set(i,e),Ws(e,i,r,vh,w),w.delete(i)),e}function _g(e){return Fn(e)?r:e}function wh(e,i,a,c,f,w){var S=a&M,T=e.length,$=i.length;if(T!=$&&!(S&&$>T))return!1;var k=w.get(e),K=w.get(i);if(k&&K)return k==i&&K==e;var G=-1,X=!0,oe=a&W?new ji:r;for(w.set(e,i),w.set(i,e);++G<T;){var he=e[G],we=i[G];if(c)var le=S?c(we,he,G,i,e,w):c(he,we,G,e,i,w);if(le!==r){if(le)continue;X=!1;break}if(oe){if(!po(i,function(Ie,Oe){if(!On(oe,Oe)&&(he===Ie||f(he,Ie,a,c,w)))return oe.push(Oe)})){X=!1;break}}else if(!(he===we||f(he,we,a,c,w))){X=!1;break}}return w.delete(e),w.delete(i),X}function Eg(e,i,a,c,f,w,S){switch(a){case Ke:if(e.byteLength!=i.byteLength||e.byteOffset!=i.byteOffset)return!1;e=e.buffer,i=i.buffer;case Ce:return!(e.byteLength!=i.byteLength||!w(new js(e),new js(i)));case q:case D:case Re:return jr(+e,+i);case A:return e.name==i.name&&e.message==i.message;case at:case Je:return e==i+"";case ve:var T=bo;case Ue:var $=c&M;if(T||(T=As),e.size!=i.size&&!$)return!1;var k=S.get(e);if(k)return k==i;c|=W,S.set(e,i);var K=wh(T(e),T(i),c,f,w,S);return S.delete(e),K;case Ye:if(Cn)return Cn.call(e)==Cn.call(i)}return!1}function Ig(e,i,a,c,f,w){var S=a&M,T=Vo(e),$=T.length,k=Vo(i),K=k.length;if($!=K&&!S)return!1;for(var G=$;G--;){var X=T[G];if(!(S?X in i:qe.call(i,X)))return!1}var oe=w.get(e),he=w.get(i);if(oe&&he)return oe==i&&he==e;var we=!0;w.set(e,i),w.set(i,e);for(var le=S;++G<$;){X=T[G];var Ie=e[X],Oe=i[X];if(c)var vr=S?c(Oe,Ie,X,i,e,w):c(Ie,Oe,X,e,i,w);if(!(vr===r?Ie===Oe||f(Ie,Oe,a,c,w):vr)){we=!1;break}le||(le=X=="constructor")}if(we&&!le){var rr=e.constructor,wr=i.constructor;rr!=wr&&"constructor"in e&&"constructor"in i&&!(typeof rr=="function"&&rr instanceof rr&&typeof wr=="function"&&wr instanceof wr)&&(we=!1)}return w.delete(e),w.delete(i),we}function ii(e){return Xo(xh(e,r,Dh),e+"")}function Vo(e){return Mu(e,Mt,Qo)}function Bo(e){return Mu(e,hr,bh)}var Go=Hs?function(e){return Hs.get(e)}:fc;function ra(e){for(var i=e.name+"",a=un[i],c=qe.call(un,i)?a.length:0;c--;){var f=a[c],w=f.func;if(w==null||w==e)return f.name}return i}function dn(e){var i=qe.call(v,"placeholder")?v:e;return i.placeholder}function ue(){var e=v.iteratee||hc;return e=e===hc?Hu:e,arguments.length?e(arguments[0],arguments[1]):e}function ia(e,i){var a=e.__data__;return Rg(i)?a[typeof i=="string"?"string":"hash"]:a.map}function Wo(e){for(var i=Mt(e),a=i.length;a--;){var c=i[a],f=e[c];i[a]=[c,f,Ih(f)]}return i}function Mi(e,i){var a=Dd(e,i);return Fu(a)?a:r}function Sg(e){var i=qe.call(e,Di),a=e[Di];try{e[Di]=r;var c=!0}catch{}var f=Ds.call(e);return c&&(i?e[Di]=a:delete e[Di]),f}var Qo=Eo?function(e){return e==null?[]:(e=We(e),gi(Eo(e),function(i){return Pu.call(e,i)}))}:dc,bh=Eo?function(e){for(var i=[];e;)mi(i,Qo(e)),e=Ls(e);return i}:dc,Gt=er;(Io&&Gt(new Io(new ArrayBuffer(1)))!=Ke||Tn&&Gt(new Tn)!=ve||So&&Gt(So.resolve())!=xt||cn&&Gt(new cn)!=Ue||An&&Gt(new An)!=ze)&&(Gt=function(e){var i=er(e),a=i==Se?e.constructor:r,c=a?zi(a):"";if(c)switch(c){case ap:return Ke;case op:return ve;case cp:return xt;case up:return Ue;case hp:return ze}return i});function xg(e,i,a){for(var c=-1,f=a.length;++c<f;){var w=a[c],S=w.size;switch(w.type){case"drop":e+=S;break;case"dropRight":i-=S;break;case"take":i=Bt(i,e+S);break;case"takeRight":e=jt(e,i-S);break}}return{start:e,end:i}}function Pg(e){var i=e.match(Qe);return i?i[1].split(At):[]}function _h(e,i,a){i=_i(i,e);for(var c=-1,f=i.length,w=!1;++c<f;){var S=Gr(i[c]);if(!(w=e!=null&&a(e,S)))break;e=e[S]}return w||++c!=f?w:(f=e==null?0:e.length,!!f&&ha(f)&&ni(S,f)&&(me(e)||Fi(e)))}function Og(e){var i=e.length,a=new e.constructor(i);return i&&typeof e[0]=="string"&&qe.call(e,"index")&&(a.index=e.index,a.input=e.input),a}function Eh(e){return typeof e.constructor=="function"&&!Mn(e)?hn(Ls(e)):{}}function Ng(e,i,a){var c=e.constructor;switch(i){case Ce:return Ho(e);case q:case D:return new c(+e);case Ke:return lg(e,a);case lt:case Le:case Pt:case Dt:case Ft:case Ht:case Lt:case Yt:case ar:return nh(e,a);case ve:return new c;case Re:case Je:return new c(e);case at:return fg(e);case Ue:return new c;case Ye:return dg(e)}}function Tg(e,i){var a=i.length;if(!a)return e;var c=a-1;return i[c]=(a>1?"& ":"")+i[c],i=i.join(a>2?", ":" "),e.replace(yt,`{
/* [wrapped with `+i+`] */
`)}function Ag(e){return me(e)||Fi(e)||!!(Ou&&e&&e[Ou])}function ni(e,i){var a=typeof e;return i=i??ee,!!i&&(a=="number"||a!="symbol"&&Ya.test(e))&&e>-1&&e%1==0&&e<i}function tr(e,i,a){if(!ut(a))return!1;var c=typeof i;return(c=="number"?ur(a)&&ni(i,a.length):c=="string"&&i in a)?jr(a[i],e):!1}function Jo(e,i){if(me(e))return!1;var a=typeof e;return a=="number"||a=="symbol"||a=="boolean"||e==null||yr(e)?!0:Ot.test(e)||!it.test(e)||i!=null&&e in We(i)}function Rg(e){var i=typeof e;return i=="string"||i=="number"||i=="symbol"||i=="boolean"?e!=="__proto__":e===null}function Yo(e){var i=ra(e),a=v[i];if(typeof a!="function"||!(i in xe.prototype))return!1;if(e===a)return!0;var c=Go(a);return!!c&&e===c[0]}function Cg(e){return!!Iu&&Iu in e}var $g=Cs?si:pc;function Mn(e){var i=e&&e.constructor,a=typeof i=="function"&&i.prototype||on;return e===a}function Ih(e){return e===e&&!ut(e)}function Sh(e,i){return function(a){return a==null?!1:a[e]===i&&(i!==r||e in We(a))}}function Dg(e){var i=ca(e,function(c){return a.size===_&&a.clear(),c}),a=i.cache;return i}function Ug(e,i){var a=e[1],c=i[1],f=a|c,w=f<(ie|ce|N),S=c==N&&a==d||c==N&&a==x&&e[7].length<=i[8]||c==(N|x)&&i[7].length<=i[8]&&a==d;if(!(w||S))return e;c&ie&&(e[2]=i[2],f|=a&ie?0:u);var T=i[3];if(T){var $=e[3];e[3]=$?ah($,T,i[4]):T,e[4]=$?yi(e[3],E):i[4]}return T=i[5],T&&($=e[5],e[5]=$?oh($,T,i[6]):T,e[6]=$?yi(e[5],E):i[6]),T=i[7],T&&(e[7]=T),c&N&&(e[8]=e[8]==null?i[8]:Bt(e[8],i[8])),e[9]==null&&(e[9]=i[9]),e[0]=i[0],e[1]=f,e}function jg(e){var i=[];if(e!=null)for(var a in We(e))i.push(a);return i}function Lg(e){return Ds.call(e)}function xh(e,i,a){return i=jt(i===r?e.length-1:i,0),function(){for(var c=arguments,f=-1,w=jt(c.length-i,0),S=j(w);++f<w;)S[f]=c[i+f];f=-1;for(var T=j(i+1);++f<i;)T[f]=c[f];return T[i]=a(S),qt(e,this,T)}}function Ph(e,i){return i.length<2?e:qi(e,Or(i,0,-1))}function qg(e,i){for(var a=e.length,c=Bt(i.length,a),f=cr(e);c--;){var w=i[c];e[c]=ni(w,a)?f[w]:r}return e}function Zo(e,i){if(!(i==="constructor"&&typeof e[i]=="function")&&i!="__proto__")return e[i]}var Oh=Th(Ju),zn=Xd||function(e,i){return Pe.setTimeout(e,i)},Xo=Th(og);function Nh(e,i,a){var c=i+"";return Xo(e,Tg(c,Mg(Pg(c),a)))}function Th(e){var i=0,a=0;return function(){var c=ip(),f=tt-(c-a);if(a=c,f>0){if(++i>=Te)return arguments[0]}else i=0;return e.apply(r,arguments)}}function na(e,i){var a=-1,c=e.length,f=c-1;for(i=i===r?c:i;++a<i;){var w=Uo(a,f),S=e[w];e[w]=e[a],e[a]=S}return e.length=i,e}var Ah=Dg(function(e){var i=[];return e.charCodeAt(0)===46&&i.push(""),e.replace(Nt,function(a,c,f,w){i.push(f?w.replace(Va,"$1"):c||a)}),i});function Gr(e){if(typeof e=="string"||yr(e))return e;var i=e+"";return i=="0"&&1/e==-Ae?"-0":i}function zi(e){if(e!=null){try{return $s.call(e)}catch{}try{return e+""}catch{}}return""}function Mg(e,i){return Ir(Fr,function(a){var c="_."+a[0];i&a[1]&&!Ns(e,c)&&e.push(c)}),e.sort()}function Rh(e){if(e instanceof xe)return e.clone();var i=new xr(e.__wrapped__,e.__chain__);return i.__actions__=cr(e.__actions__),i.__index__=e.__index__,i.__values__=e.__values__,i}function zg(e,i,a){(a?tr(e,i,a):i===r)?i=1:i=jt(ye(i),0);var c=e==null?0:e.length;if(!c||i<1)return[];for(var f=0,w=0,S=j(zs(c/i));f<c;)S[w++]=Or(e,f,f+=i);return S}function Fg(e){for(var i=-1,a=e==null?0:e.length,c=0,f=[];++i<a;){var w=e[i];w&&(f[c++]=w)}return f}function Hg(){var e=arguments.length;if(!e)return[];for(var i=j(e-1),a=arguments[0],c=e;c--;)i[c-1]=arguments[c];return mi(me(a)?cr(a):[a],kt(i,1))}var kg=_e(function(e,i){return Et(e)?Dn(e,kt(i,1,Et,!0)):[]}),Kg=_e(function(e,i){var a=Nr(i);return Et(a)&&(a=r),Et(e)?Dn(e,kt(i,1,Et,!0),ue(a,2)):[]}),Vg=_e(function(e,i){var a=Nr(i);return Et(a)&&(a=r),Et(e)?Dn(e,kt(i,1,Et,!0),r,a):[]});function Bg(e,i,a){var c=e==null?0:e.length;return c?(i=a||i===r?1:ye(i),Or(e,i<0?0:i,c)):[]}function Gg(e,i,a){var c=e==null?0:e.length;return c?(i=a||i===r?1:ye(i),i=c-i,Or(e,0,i<0?0:i)):[]}function Wg(e,i){return e&&e.length?Js(e,ue(i,3),!0,!0):[]}function Qg(e,i){return e&&e.length?Js(e,ue(i,3),!0):[]}function Jg(e,i,a,c){var f=e==null?0:e.length;return f?(a&&typeof a!="number"&&tr(e,i,a)&&(a=0,c=f),Hp(e,i,a,c)):[]}function Ch(e,i,a){var c=e==null?0:e.length;if(!c)return-1;var f=a==null?0:ye(a);return f<0&&(f=jt(c+f,0)),Ts(e,ue(i,3),f)}function $h(e,i,a){var c=e==null?0:e.length;if(!c)return-1;var f=c-1;return a!==r&&(f=ye(a),f=a<0?jt(c+f,0):Bt(f,c-1)),Ts(e,ue(i,3),f,!0)}function Dh(e){var i=e==null?0:e.length;return i?kt(e,1):[]}function Yg(e){var i=e==null?0:e.length;return i?kt(e,Ae):[]}function Zg(e,i){var a=e==null?0:e.length;return a?(i=i===r?1:ye(i),kt(e,i)):[]}function Xg(e){for(var i=-1,a=e==null?0:e.length,c={};++i<a;){var f=e[i];c[f[0]]=f[1]}return c}function Uh(e){return e&&e.length?e[0]:r}function em(e,i,a){var c=e==null?0:e.length;if(!c)return-1;var f=a==null?0:ye(a);return f<0&&(f=jt(c+f,0)),rn(e,i,f)}function tm(e){var i=e==null?0:e.length;return i?Or(e,0,-1):[]}var rm=_e(function(e){var i=nt(e,zo);return i.length&&i[0]===e[0]?Ao(i):[]}),im=_e(function(e){var i=Nr(e),a=nt(e,zo);return i===Nr(a)?i=r:a.pop(),a.length&&a[0]===e[0]?Ao(a,ue(i,2)):[]}),nm=_e(function(e){var i=Nr(e),a=nt(e,zo);return i=typeof i=="function"?i:r,i&&a.pop(),a.length&&a[0]===e[0]?Ao(a,r,i):[]});function sm(e,i){return e==null?"":tp.call(e,i)}function Nr(e){var i=e==null?0:e.length;return i?e[i-1]:r}function am(e,i,a){var c=e==null?0:e.length;if(!c)return-1;var f=c;return a!==r&&(f=ye(a),f=f<0?jt(c+f,0):Bt(f,c-1)),i===i?Md(e,i,f):Ts(e,gu,f,!0)}function om(e,i){return e&&e.length?Bu(e,ye(i)):r}var cm=_e(jh);function jh(e,i){return e&&e.length&&i&&i.length?Do(e,i):e}function um(e,i,a){return e&&e.length&&i&&i.length?Do(e,i,ue(a,2)):e}function hm(e,i,a){return e&&e.length&&i&&i.length?Do(e,i,r,a):e}var lm=ii(function(e,i){var a=e==null?0:e.length,c=Po(e,i);return Qu(e,nt(i,function(f){return ni(f,a)?+f:f}).sort(sh)),c});function fm(e,i){var a=[];if(!(e&&e.length))return a;var c=-1,f=[],w=e.length;for(i=ue(i,3);++c<w;){var S=e[c];i(S,c,e)&&(a.push(S),f.push(c))}return Qu(e,f),a}function ec(e){return e==null?e:sp.call(e)}function dm(e,i,a){var c=e==null?0:e.length;return c?(a&&typeof a!="number"&&tr(e,i,a)?(i=0,a=c):(i=i==null?0:ye(i),a=a===r?c:ye(a)),Or(e,i,a)):[]}function pm(e,i){return Qs(e,i)}function gm(e,i,a){return Lo(e,i,ue(a,2))}function mm(e,i){var a=e==null?0:e.length;if(a){var c=Qs(e,i);if(c<a&&jr(e[c],i))return c}return-1}function ym(e,i){return Qs(e,i,!0)}function vm(e,i,a){return Lo(e,i,ue(a,2),!0)}function wm(e,i){var a=e==null?0:e.length;if(a){var c=Qs(e,i,!0)-1;if(jr(e[c],i))return c}return-1}function bm(e){return e&&e.length?Yu(e):[]}function _m(e,i){return e&&e.length?Yu(e,ue(i,2)):[]}function Em(e){var i=e==null?0:e.length;return i?Or(e,1,i):[]}function Im(e,i,a){return e&&e.length?(i=a||i===r?1:ye(i),Or(e,0,i<0?0:i)):[]}function Sm(e,i,a){var c=e==null?0:e.length;return c?(i=a||i===r?1:ye(i),i=c-i,Or(e,i<0?0:i,c)):[]}function xm(e,i){return e&&e.length?Js(e,ue(i,3),!1,!0):[]}function Pm(e,i){return e&&e.length?Js(e,ue(i,3)):[]}var Om=_e(function(e){return bi(kt(e,1,Et,!0))}),Nm=_e(function(e){var i=Nr(e);return Et(i)&&(i=r),bi(kt(e,1,Et,!0),ue(i,2))}),Tm=_e(function(e){var i=Nr(e);return i=typeof i=="function"?i:r,bi(kt(e,1,Et,!0),r,i)});function Am(e){return e&&e.length?bi(e):[]}function Rm(e,i){return e&&e.length?bi(e,ue(i,2)):[]}function Cm(e,i){return i=typeof i=="function"?i:r,e&&e.length?bi(e,r,i):[]}function tc(e){if(!(e&&e.length))return[];var i=0;return e=gi(e,function(a){if(Et(a))return i=jt(a.length,i),!0}),vo(i,function(a){return nt(e,go(a))})}function Lh(e,i){if(!(e&&e.length))return[];var a=tc(e);return i==null?a:nt(a,function(c){return qt(i,r,c)})}var $m=_e(function(e,i){return Et(e)?Dn(e,i):[]}),Dm=_e(function(e){return Mo(gi(e,Et))}),Um=_e(function(e){var i=Nr(e);return Et(i)&&(i=r),Mo(gi(e,Et),ue(i,2))}),jm=_e(function(e){var i=Nr(e);return i=typeof i=="function"?i:r,Mo(gi(e,Et),r,i)}),Lm=_e(tc);function qm(e,i){return th(e||[],i||[],$n)}function Mm(e,i){return th(e||[],i||[],Ln)}var zm=_e(function(e){var i=e.length,a=i>1?e[i-1]:r;return a=typeof a=="function"?(e.pop(),a):r,Lh(e,a)});function qh(e){var i=v(e);return i.__chain__=!0,i}function Fm(e,i){return i(e),e}function sa(e,i){return i(e)}var Hm=ii(function(e){var i=e.length,a=i?e[0]:0,c=this.__wrapped__,f=function(w){return Po(w,e)};return i>1||this.__actions__.length||!(c instanceof xe)||!ni(a)?this.thru(f):(c=c.slice(a,+a+(i?1:0)),c.__actions__.push({func:sa,args:[f],thisArg:r}),new xr(c,this.__chain__).thru(function(w){return i&&!w.length&&w.push(r),w}))});function km(){return qh(this)}function Km(){return new xr(this.value(),this.__chain__)}function Vm(){this.__values__===r&&(this.__values__=Zh(this.value()));var e=this.__index__>=this.__values__.length,i=e?r:this.__values__[this.__index__++];return{done:e,value:i}}function Bm(){return this}function Gm(e){for(var i,a=this;a instanceof Ks;){var c=Rh(a);c.__index__=0,c.__values__=r,i?f.__wrapped__=c:i=c;var f=c;a=a.__wrapped__}return f.__wrapped__=e,i}function Wm(){var e=this.__wrapped__;if(e instanceof xe){var i=e;return this.__actions__.length&&(i=new xe(this)),i=i.reverse(),i.__actions__.push({func:sa,args:[ec],thisArg:r}),new xr(i,this.__chain__)}return this.thru(ec)}function Qm(){return eh(this.__wrapped__,this.__actions__)}var Jm=Ys(function(e,i,a){qe.call(e,a)?++e[a]:ti(e,a,1)});function Ym(e,i,a){var c=me(e)?du:Fp;return a&&tr(e,i,a)&&(i=r),c(e,ue(i,3))}function Zm(e,i){var a=me(e)?gi:Lu;return a(e,ue(i,3))}var Xm=lh(Ch),ey=lh($h);function ty(e,i){return kt(aa(e,i),1)}function ry(e,i){return kt(aa(e,i),Ae)}function iy(e,i,a){return a=a===r?1:ye(a),kt(aa(e,i),a)}function Mh(e,i){var a=me(e)?Ir:wi;return a(e,ue(i,3))}function zh(e,i){var a=me(e)?Ed:ju;return a(e,ue(i,3))}var ny=Ys(function(e,i,a){qe.call(e,a)?e[a].push(i):ti(e,a,[i])});function sy(e,i,a,c){e=ur(e)?e:gn(e),a=a&&!c?ye(a):0;var f=e.length;return a<0&&(a=jt(f+a,0)),la(e)?a<=f&&e.indexOf(i,a)>-1:!!f&&rn(e,i,a)>-1}var ay=_e(function(e,i,a){var c=-1,f=typeof i=="function",w=ur(e)?j(e.length):[];return wi(e,function(S){w[++c]=f?qt(i,S,a):Un(S,i,a)}),w}),oy=Ys(function(e,i,a){ti(e,a,i)});function aa(e,i){var a=me(e)?nt:ku;return a(e,ue(i,3))}function cy(e,i,a,c){return e==null?[]:(me(i)||(i=i==null?[]:[i]),a=c?r:a,me(a)||(a=a==null?[]:[a]),Gu(e,i,a))}var uy=Ys(function(e,i,a){e[a?0:1].push(i)},function(){return[[],[]]});function hy(e,i,a){var c=me(e)?fo:yu,f=arguments.length<3;return c(e,ue(i,4),a,f,wi)}function ly(e,i,a){var c=me(e)?Id:yu,f=arguments.length<3;return c(e,ue(i,4),a,f,ju)}function fy(e,i){var a=me(e)?gi:Lu;return a(e,ua(ue(i,3)))}function dy(e){var i=me(e)?Cu:sg;return i(e)}function py(e,i,a){(a?tr(e,i,a):i===r)?i=1:i=ye(i);var c=me(e)?jp:ag;return c(e,i)}function gy(e){var i=me(e)?Lp:cg;return i(e)}function my(e){if(e==null)return 0;if(ur(e))return la(e)?sn(e):e.length;var i=Gt(e);return i==ve||i==Ue?e.size:Co(e).length}function yy(e,i,a){var c=me(e)?po:ug;return a&&tr(e,i,a)&&(i=r),c(e,ue(i,3))}var vy=_e(function(e,i){if(e==null)return[];var a=i.length;return a>1&&tr(e,i[0],i[1])?i=[]:a>2&&tr(i[0],i[1],i[2])&&(i=[i[0]]),Gu(e,kt(i,1),[])}),oa=Zd||function(){return Pe.Date.now()};function wy(e,i){if(typeof i!="function")throw new Sr(y);return e=ye(e),function(){if(--e<1)return i.apply(this,arguments)}}function Fh(e,i,a){return i=a?r:i,i=e&&i==null?e.length:i,ri(e,N,r,r,r,r,i)}function Hh(e,i){var a;if(typeof i!="function")throw new Sr(y);return e=ye(e),function(){return--e>0&&(a=i.apply(this,arguments)),e<=1&&(i=r),a}}var rc=_e(function(e,i,a){var c=ie;if(a.length){var f=yi(a,dn(rc));c|=g}return ri(e,c,i,a,f)}),kh=_e(function(e,i,a){var c=ie|ce;if(a.length){var f=yi(a,dn(kh));c|=g}return ri(i,c,e,a,f)});function Kh(e,i,a){i=a?r:i;var c=ri(e,d,r,r,r,r,r,i);return c.placeholder=Kh.placeholder,c}function Vh(e,i,a){i=a?r:i;var c=ri(e,m,r,r,r,r,r,i);return c.placeholder=Vh.placeholder,c}function Bh(e,i,a){var c,f,w,S,T,$,k=0,K=!1,G=!1,X=!0;if(typeof e!="function")throw new Sr(y);i=Tr(i)||0,ut(a)&&(K=!!a.leading,G="maxWait"in a,w=G?jt(Tr(a.maxWait)||0,i):w,X="trailing"in a?!!a.trailing:X);function oe(It){var Lr=c,oi=f;return c=f=r,k=It,S=e.apply(oi,Lr),S}function he(It){return k=It,T=zn(Ie,i),K?oe(It):S}function we(It){var Lr=It-$,oi=It-k,ll=i-Lr;return G?Bt(ll,w-oi):ll}function le(It){var Lr=It-$,oi=It-k;return $===r||Lr>=i||Lr<0||G&&oi>=w}function Ie(){var It=oa();if(le(It))return Oe(It);T=zn(Ie,we(It))}function Oe(It){return T=r,X&&c?oe(It):(c=f=r,S)}function vr(){T!==r&&rh(T),k=0,c=$=f=T=r}function rr(){return T===r?S:Oe(oa())}function wr(){var It=oa(),Lr=le(It);if(c=arguments,f=this,$=It,Lr){if(T===r)return he($);if(G)return rh(T),T=zn(Ie,i),oe($)}return T===r&&(T=zn(Ie,i)),S}return wr.cancel=vr,wr.flush=rr,wr}var by=_e(function(e,i){return Uu(e,1,i)}),_y=_e(function(e,i,a){return Uu(e,Tr(i)||0,a)});function Ey(e){return ri(e,Q)}function ca(e,i){if(typeof e!="function"||i!=null&&typeof i!="function")throw new Sr(y);var a=function(){var c=arguments,f=i?i.apply(this,c):c[0],w=a.cache;if(w.has(f))return w.get(f);var S=e.apply(this,c);return a.cache=w.set(f,S)||w,S};return a.cache=new(ca.Cache||ei),a}ca.Cache=ei;function ua(e){if(typeof e!="function")throw new Sr(y);return function(){var i=arguments;switch(i.length){case 0:return!e.call(this);case 1:return!e.call(this,i[0]);case 2:return!e.call(this,i[0],i[1]);case 3:return!e.call(this,i[0],i[1],i[2])}return!e.apply(this,i)}}function Iy(e){return Hh(2,e)}var Sy=hg(function(e,i){i=i.length==1&&me(i[0])?nt(i[0],gr(ue())):nt(kt(i,1),gr(ue()));var a=i.length;return _e(function(c){for(var f=-1,w=Bt(c.length,a);++f<w;)c[f]=i[f].call(this,c[f]);return qt(e,this,c)})}),ic=_e(function(e,i){var a=yi(i,dn(ic));return ri(e,g,r,i,a)}),Gh=_e(function(e,i){var a=yi(i,dn(Gh));return ri(e,p,r,i,a)}),xy=ii(function(e,i){return ri(e,x,r,r,r,i)});function Py(e,i){if(typeof e!="function")throw new Sr(y);return i=i===r?i:ye(i),_e(e,i)}function Oy(e,i){if(typeof e!="function")throw new Sr(y);return i=i==null?0:jt(ye(i),0),_e(function(a){var c=a[i],f=Ei(a,0,i);return c&&mi(f,c),qt(e,this,f)})}function Ny(e,i,a){var c=!0,f=!0;if(typeof e!="function")throw new Sr(y);return ut(a)&&(c="leading"in a?!!a.leading:c,f="trailing"in a?!!a.trailing:f),Bh(e,i,{leading:c,maxWait:i,trailing:f})}function Ty(e){return Fh(e,1)}function Ay(e,i){return ic(Fo(i),e)}function Ry(){if(!arguments.length)return[];var e=arguments[0];return me(e)?e:[e]}function Cy(e){return Pr(e,H)}function $y(e,i){return i=typeof i=="function"?i:r,Pr(e,H,i)}function Dy(e){return Pr(e,O|H)}function Uy(e,i){return i=typeof i=="function"?i:r,Pr(e,O|H,i)}function jy(e,i){return i==null||Du(e,i,Mt(i))}function jr(e,i){return e===i||e!==e&&i!==i}var Ly=ta(To),qy=ta(function(e,i){return e>=i}),Fi=zu(function(){return arguments}())?zu:function(e){return vt(e)&&qe.call(e,"callee")&&!Pu.call(e,"callee")},me=j.isArray,My=Xt?gr(Xt):Gp;function ur(e){return e!=null&&ha(e.length)&&!si(e)}function Et(e){return vt(e)&&ur(e)}function zy(e){return e===!0||e===!1||vt(e)&&er(e)==q}var Ii=ep||pc,Fy=$r?gr($r):Wp;function Hy(e){return vt(e)&&e.nodeType===1&&!Fn(e)}function ky(e){if(e==null)return!0;if(ur(e)&&(me(e)||typeof e=="string"||typeof e.splice=="function"||Ii(e)||pn(e)||Fi(e)))return!e.length;var i=Gt(e);if(i==ve||i==Ue)return!e.size;if(Mn(e))return!Co(e).length;for(var a in e)if(qe.call(e,a))return!1;return!0}function Ky(e,i){return jn(e,i)}function Vy(e,i,a){a=typeof a=="function"?a:r;var c=a?a(e,i):r;return c===r?jn(e,i,r,a):!!c}function nc(e){if(!vt(e))return!1;var i=er(e);return i==A||i==h||typeof e.message=="string"&&typeof e.name=="string"&&!Fn(e)}function By(e){return typeof e=="number"&&Nu(e)}function si(e){if(!ut(e))return!1;var i=er(e);return i==ae||i==de||i==z||i==wt}function Wh(e){return typeof e=="number"&&e==ye(e)}function ha(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=ee}function ut(e){var i=typeof e;return e!=null&&(i=="object"||i=="function")}function vt(e){return e!=null&&typeof e=="object"}var Qh=Er?gr(Er):Jp;function Gy(e,i){return e===i||Ro(e,i,Wo(i))}function Wy(e,i,a){return a=typeof a=="function"?a:r,Ro(e,i,Wo(i),a)}function Qy(e){return Jh(e)&&e!=+e}function Jy(e){if($g(e))throw new pe(l);return Fu(e)}function Yy(e){return e===null}function Zy(e){return e==null}function Jh(e){return typeof e=="number"||vt(e)&&er(e)==Re}function Fn(e){if(!vt(e)||er(e)!=Se)return!1;var i=Ls(e);if(i===null)return!0;var a=qe.call(i,"constructor")&&i.constructor;return typeof a=="function"&&a instanceof a&&$s.call(a)==Wd}var sc=Kr?gr(Kr):Yp;function Xy(e){return Wh(e)&&e>=-ee&&e<=ee}var Yh=Pn?gr(Pn):Zp;function la(e){return typeof e=="string"||!me(e)&&vt(e)&&er(e)==Je}function yr(e){return typeof e=="symbol"||vt(e)&&er(e)==Ye}var pn=$i?gr($i):Xp;function e0(e){return e===r}function t0(e){return vt(e)&&Gt(e)==ze}function r0(e){return vt(e)&&er(e)==Ze}var i0=ta($o),n0=ta(function(e,i){return e<=i});function Zh(e){if(!e)return[];if(ur(e))return la(e)?Dr(e):cr(e);if(Nn&&e[Nn])return jd(e[Nn]());var i=Gt(e),a=i==ve?bo:i==Ue?As:gn;return a(e)}function ai(e){if(!e)return e===0?e:0;if(e=Tr(e),e===Ae||e===-Ae){var i=e<0?-1:1;return i*Y}return e===e?e:0}function ye(e){var i=ai(e),a=i%1;return i===i?a?i-a:i:0}function Xh(e){return e?Li(ye(e),0,Z):0}function Tr(e){if(typeof e=="number")return e;if(yr(e))return J;if(ut(e)){var i=typeof e.valueOf=="function"?e.valueOf():e;e=ut(i)?i+"":i}if(typeof e!="string")return e===0?e:+e;e=vu(e);var a=Wa.test(e);return a||Ja.test(e)?ge(e.slice(2),a?2:8):Ga.test(e)?J:+e}function el(e){return Br(e,hr(e))}function s0(e){return e?Li(ye(e),-ee,ee):e===0?e:0}function je(e){return e==null?"":mr(e)}var a0=ln(function(e,i){if(Mn(i)||ur(i)){Br(i,Mt(i),e);return}for(var a in i)qe.call(i,a)&&$n(e,a,i[a])}),tl=ln(function(e,i){Br(i,hr(i),e)}),fa=ln(function(e,i,a,c){Br(i,hr(i),e,c)}),o0=ln(function(e,i,a,c){Br(i,Mt(i),e,c)}),c0=ii(Po);function u0(e,i){var a=hn(e);return i==null?a:$u(a,i)}var h0=_e(function(e,i){e=We(e);var a=-1,c=i.length,f=c>2?i[2]:r;for(f&&tr(i[0],i[1],f)&&(c=1);++a<c;)for(var w=i[a],S=hr(w),T=-1,$=S.length;++T<$;){var k=S[T],K=e[k];(K===r||jr(K,on[k])&&!qe.call(e,k))&&(e[k]=w[k])}return e}),l0=_e(function(e){return e.push(r,vh),qt(rl,r,e)});function f0(e,i){return pu(e,ue(i,3),Vr)}function d0(e,i){return pu(e,ue(i,3),No)}function p0(e,i){return e==null?e:Oo(e,ue(i,3),hr)}function g0(e,i){return e==null?e:qu(e,ue(i,3),hr)}function m0(e,i){return e&&Vr(e,ue(i,3))}function y0(e,i){return e&&No(e,ue(i,3))}function v0(e){return e==null?[]:Gs(e,Mt(e))}function w0(e){return e==null?[]:Gs(e,hr(e))}function ac(e,i,a){var c=e==null?r:qi(e,i);return c===r?a:c}function b0(e,i){return e!=null&&_h(e,i,kp)}function oc(e,i){return e!=null&&_h(e,i,Kp)}var _0=dh(function(e,i,a){i!=null&&typeof i.toString!="function"&&(i=Ds.call(i)),e[i]=a},uc(lr)),E0=dh(function(e,i,a){i!=null&&typeof i.toString!="function"&&(i=Ds.call(i)),qe.call(e,i)?e[i].push(a):e[i]=[a]},ue),I0=_e(Un);function Mt(e){return ur(e)?Ru(e):Co(e)}function hr(e){return ur(e)?Ru(e,!0):eg(e)}function S0(e,i){var a={};return i=ue(i,3),Vr(e,function(c,f,w){ti(a,i(c,f,w),c)}),a}function x0(e,i){var a={};return i=ue(i,3),Vr(e,function(c,f,w){ti(a,f,i(c,f,w))}),a}var P0=ln(function(e,i,a){Ws(e,i,a)}),rl=ln(function(e,i,a,c){Ws(e,i,a,c)}),O0=ii(function(e,i){var a={};if(e==null)return a;var c=!1;i=nt(i,function(w){return w=_i(w,e),c||(c=w.length>1),w}),Br(e,Bo(e),a),c&&(a=Pr(a,O|U|H,_g));for(var f=i.length;f--;)qo(a,i[f]);return a});function N0(e,i){return il(e,ua(ue(i)))}var T0=ii(function(e,i){return e==null?{}:rg(e,i)});function il(e,i){if(e==null)return{};var a=nt(Bo(e),function(c){return[c]});return i=ue(i),Wu(e,a,function(c,f){return i(c,f[0])})}function A0(e,i,a){i=_i(i,e);var c=-1,f=i.length;for(f||(f=1,e=r);++c<f;){var w=e==null?r:e[Gr(i[c])];w===r&&(c=f,w=a),e=si(w)?w.call(e):w}return e}function R0(e,i,a){return e==null?e:Ln(e,i,a)}function C0(e,i,a,c){return c=typeof c=="function"?c:r,e==null?e:Ln(e,i,a,c)}var nl=mh(Mt),sl=mh(hr);function $0(e,i,a){var c=me(e),f=c||Ii(e)||pn(e);if(i=ue(i,4),a==null){var w=e&&e.constructor;f?a=c?new w:[]:ut(e)?a=si(w)?hn(Ls(e)):{}:a={}}return(f?Ir:Vr)(e,function(S,T,$){return i(a,S,T,$)}),a}function D0(e,i){return e==null?!0:qo(e,i)}function U0(e,i,a){return e==null?e:Xu(e,i,Fo(a))}function j0(e,i,a,c){return c=typeof c=="function"?c:r,e==null?e:Xu(e,i,Fo(a),c)}function gn(e){return e==null?[]:wo(e,Mt(e))}function L0(e){return e==null?[]:wo(e,hr(e))}function q0(e,i,a){return a===r&&(a=i,i=r),a!==r&&(a=Tr(a),a=a===a?a:0),i!==r&&(i=Tr(i),i=i===i?i:0),Li(Tr(e),i,a)}function M0(e,i,a){return i=ai(i),a===r?(a=i,i=0):a=ai(a),e=Tr(e),Vp(e,i,a)}function z0(e,i,a){if(a&&typeof a!="boolean"&&tr(e,i,a)&&(i=a=r),a===r&&(typeof i=="boolean"?(a=i,i=r):typeof e=="boolean"&&(a=e,e=r)),e===r&&i===r?(e=0,i=1):(e=ai(e),i===r?(i=e,e=0):i=ai(i)),e>i){var c=e;e=i,i=c}if(a||e%1||i%1){var f=Tu();return Bt(e+f*(i-e+Be("1e-"+((f+"").length-1))),i)}return Uo(e,i)}var F0=fn(function(e,i,a){return i=i.toLowerCase(),e+(a?al(i):i)});function al(e){return cc(je(e).toLowerCase())}function ol(e){return e=je(e),e&&e.replace(Yr,Rd).replace(uo,"")}function H0(e,i,a){e=je(e),i=mr(i);var c=e.length;a=a===r?c:Li(ye(a),0,c);var f=a;return a-=i.length,a>=0&&e.slice(a,f)==i}function k0(e){return e=je(e),e&&rt.test(e)?e.replace(Ni,Cd):e}function K0(e){return e=je(e),e&&Tt.test(e)?e.replace(gt,"\\$&"):e}var V0=fn(function(e,i,a){return e+(a?"-":"")+i.toLowerCase()}),B0=fn(function(e,i,a){return e+(a?" ":"")+i.toLowerCase()}),G0=hh("toLowerCase");function W0(e,i,a){e=je(e),i=ye(i);var c=i?sn(e):0;if(!i||c>=i)return e;var f=(i-c)/2;return ea(Fs(f),a)+e+ea(zs(f),a)}function Q0(e,i,a){e=je(e),i=ye(i);var c=i?sn(e):0;return i&&c<i?e+ea(i-c,a):e}function J0(e,i,a){e=je(e),i=ye(i);var c=i?sn(e):0;return i&&c<i?ea(i-c,a)+e:e}function Y0(e,i,a){return a||i==null?i=0:i&&(i=+i),np(je(e).replace(mt,""),i||0)}function Z0(e,i,a){return(a?tr(e,i,a):i===r)?i=1:i=ye(i),jo(je(e),i)}function X0(){var e=arguments,i=je(e[0]);return e.length<3?i:i.replace(e[1],e[2])}var ev=fn(function(e,i,a){return e+(a?"_":"")+i.toLowerCase()});function tv(e,i,a){return a&&typeof a!="number"&&tr(e,i,a)&&(i=a=r),a=a===r?Z:a>>>0,a?(e=je(e),e&&(typeof i=="string"||i!=null&&!sc(i))&&(i=mr(i),!i&&nn(e))?Ei(Dr(e),0,a):e.split(i,a)):[]}var rv=fn(function(e,i,a){return e+(a?" ":"")+cc(i)});function iv(e,i,a){return e=je(e),a=a==null?0:Li(ye(a),0,e.length),i=mr(i),e.slice(a,a+i.length)==i}function nv(e,i,a){var c=v.templateSettings;a&&tr(e,i,a)&&(i=r),e=je(e),i=fa({},i,c,yh);var f=fa({},i.imports,c.imports,yh),w=Mt(f),S=wo(f,w),T,$,k=0,K=i.interpolate||Qi,G="__p += '",X=_o((i.escape||Qi).source+"|"+K.source+"|"+(K===ct?Ba:Qi).source+"|"+(i.evaluate||Qi).source+"|$","g"),oe="//# sourceURL="+(qe.call(i,"sourceURL")?(i.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++ho+"]")+`
`;e.replace(X,function(le,Ie,Oe,vr,rr,wr){return Oe||(Oe=vr),G+=e.slice(k,wr).replace(Za,$d),Ie&&(T=!0,G+=`' +
__e(`+Ie+`) +
'`),rr&&($=!0,G+=`';
`+rr+`;
__p += '`),Oe&&(G+=`' +
((__t = (`+Oe+`)) == null ? '' : __t) +
'`),k=wr+le.length,le}),G+=`';
`;var he=qe.call(i,"variable")&&i.variable;if(!he)G=`with (obj) {
`+G+`
}
`;else if(Ka.test(he))throw new pe(b);G=($?G.replace(Hr,""):G).replace(Zt,"$1").replace(Jr,"$1;"),G="function("+(he||"obj")+`) {
`+(he?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(T?", __e = _.escape":"")+($?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+G+`return __p
}`;var we=ul(function(){return De(w,oe+"return "+G).apply(r,S)});if(we.source=G,nc(we))throw we;return we}function sv(e){return je(e).toLowerCase()}function av(e){return je(e).toUpperCase()}function ov(e,i,a){if(e=je(e),e&&(a||i===r))return vu(e);if(!e||!(i=mr(i)))return e;var c=Dr(e),f=Dr(i),w=wu(c,f),S=bu(c,f)+1;return Ei(c,w,S).join("")}function cv(e,i,a){if(e=je(e),e&&(a||i===r))return e.slice(0,Eu(e)+1);if(!e||!(i=mr(i)))return e;var c=Dr(e),f=bu(c,Dr(i))+1;return Ei(c,0,f).join("")}function uv(e,i,a){if(e=je(e),e&&(a||i===r))return e.replace(mt,"");if(!e||!(i=mr(i)))return e;var c=Dr(e),f=wu(c,Dr(i));return Ei(c,f).join("")}function hv(e,i){var a=se,c=Ee;if(ut(i)){var f="separator"in i?i.separator:f;a="length"in i?ye(i.length):a,c="omission"in i?mr(i.omission):c}e=je(e);var w=e.length;if(nn(e)){var S=Dr(e);w=S.length}if(a>=w)return e;var T=a-sn(c);if(T<1)return c;var $=S?Ei(S,0,T).join(""):e.slice(0,T);if(f===r)return $+c;if(S&&(T+=$.length-T),sc(f)){if(e.slice(T).search(f)){var k,K=$;for(f.global||(f=_o(f.source,je(_r.exec(f))+"g")),f.lastIndex=0;k=f.exec(K);)var G=k.index;$=$.slice(0,G===r?T:G)}}else if(e.indexOf(mr(f),T)!=T){var X=$.lastIndexOf(f);X>-1&&($=$.slice(0,X))}return $+c}function lv(e){return e=je(e),e&&ft.test(e)?e.replace(di,zd):e}var fv=fn(function(e,i,a){return e+(a?" ":"")+i.toUpperCase()}),cc=hh("toUpperCase");function cl(e,i,a){return e=je(e),i=a?r:i,i===r?Ud(e)?kd(e):Pd(e):e.match(i)||[]}var ul=_e(function(e,i){try{return qt(e,r,i)}catch(a){return nc(a)?a:new pe(a)}}),dv=ii(function(e,i){return Ir(i,function(a){a=Gr(a),ti(e,a,rc(e[a],e))}),e});function pv(e){var i=e==null?0:e.length,a=ue();return e=i?nt(e,function(c){if(typeof c[1]!="function")throw new Sr(y);return[a(c[0]),c[1]]}):[],_e(function(c){for(var f=-1;++f<i;){var w=e[f];if(qt(w[0],this,c))return qt(w[1],this,c)}})}function gv(e){return zp(Pr(e,O))}function uc(e){return function(){return e}}function mv(e,i){return e==null||e!==e?i:e}var yv=fh(),vv=fh(!0);function lr(e){return e}function hc(e){return Hu(typeof e=="function"?e:Pr(e,O))}function wv(e){return Ku(Pr(e,O))}function bv(e,i){return Vu(e,Pr(i,O))}var _v=_e(function(e,i){return function(a){return Un(a,e,i)}}),Ev=_e(function(e,i){return function(a){return Un(e,a,i)}});function lc(e,i,a){var c=Mt(i),f=Gs(i,c);a==null&&!(ut(i)&&(f.length||!c.length))&&(a=i,i=e,e=this,f=Gs(i,Mt(i)));var w=!(ut(a)&&"chain"in a)||!!a.chain,S=si(e);return Ir(f,function(T){var $=i[T];e[T]=$,S&&(e.prototype[T]=function(){var k=this.__chain__;if(w||k){var K=e(this.__wrapped__),G=K.__actions__=cr(this.__actions__);return G.push({func:$,args:arguments,thisArg:e}),K.__chain__=k,K}return $.apply(e,mi([this.value()],arguments))})}),e}function Iv(){return Pe._===this&&(Pe._=Qd),this}function fc(){}function Sv(e){return e=ye(e),_e(function(i){return Bu(i,e)})}var xv=ko(nt),Pv=ko(du),Ov=ko(po);function hl(e){return Jo(e)?go(Gr(e)):ig(e)}function Nv(e){return function(i){return e==null?r:qi(e,i)}}var Tv=ph(),Av=ph(!0);function dc(){return[]}function pc(){return!1}function Rv(){return{}}function Cv(){return""}function $v(){return!0}function Dv(e,i){if(e=ye(e),e<1||e>ee)return[];var a=Z,c=Bt(e,Z);i=ue(i),e-=Z;for(var f=vo(c,i);++a<e;)i(a);return f}function Uv(e){return me(e)?nt(e,Gr):yr(e)?[e]:cr(Ah(je(e)))}function jv(e){var i=++Gd;return je(e)+i}var Lv=Xs(function(e,i){return e+i},0),qv=Ko("ceil"),Mv=Xs(function(e,i){return e/i},1),zv=Ko("floor");function Fv(e){return e&&e.length?Bs(e,lr,To):r}function Hv(e,i){return e&&e.length?Bs(e,ue(i,2),To):r}function kv(e){return mu(e,lr)}function Kv(e,i){return mu(e,ue(i,2))}function Vv(e){return e&&e.length?Bs(e,lr,$o):r}function Bv(e,i){return e&&e.length?Bs(e,ue(i,2),$o):r}var Gv=Xs(function(e,i){return e*i},1),Wv=Ko("round"),Qv=Xs(function(e,i){return e-i},0);function Jv(e){return e&&e.length?yo(e,lr):0}function Yv(e,i){return e&&e.length?yo(e,ue(i,2)):0}return v.after=wy,v.ary=Fh,v.assign=a0,v.assignIn=tl,v.assignInWith=fa,v.assignWith=o0,v.at=c0,v.before=Hh,v.bind=rc,v.bindAll=dv,v.bindKey=kh,v.castArray=Ry,v.chain=qh,v.chunk=zg,v.compact=Fg,v.concat=Hg,v.cond=pv,v.conforms=gv,v.constant=uc,v.countBy=Jm,v.create=u0,v.curry=Kh,v.curryRight=Vh,v.debounce=Bh,v.defaults=h0,v.defaultsDeep=l0,v.defer=by,v.delay=_y,v.difference=kg,v.differenceBy=Kg,v.differenceWith=Vg,v.drop=Bg,v.dropRight=Gg,v.dropRightWhile=Wg,v.dropWhile=Qg,v.fill=Jg,v.filter=Zm,v.flatMap=ty,v.flatMapDeep=ry,v.flatMapDepth=iy,v.flatten=Dh,v.flattenDeep=Yg,v.flattenDepth=Zg,v.flip=Ey,v.flow=yv,v.flowRight=vv,v.fromPairs=Xg,v.functions=v0,v.functionsIn=w0,v.groupBy=ny,v.initial=tm,v.intersection=rm,v.intersectionBy=im,v.intersectionWith=nm,v.invert=_0,v.invertBy=E0,v.invokeMap=ay,v.iteratee=hc,v.keyBy=oy,v.keys=Mt,v.keysIn=hr,v.map=aa,v.mapKeys=S0,v.mapValues=x0,v.matches=wv,v.matchesProperty=bv,v.memoize=ca,v.merge=P0,v.mergeWith=rl,v.method=_v,v.methodOf=Ev,v.mixin=lc,v.negate=ua,v.nthArg=Sv,v.omit=O0,v.omitBy=N0,v.once=Iy,v.orderBy=cy,v.over=xv,v.overArgs=Sy,v.overEvery=Pv,v.overSome=Ov,v.partial=ic,v.partialRight=Gh,v.partition=uy,v.pick=T0,v.pickBy=il,v.property=hl,v.propertyOf=Nv,v.pull=cm,v.pullAll=jh,v.pullAllBy=um,v.pullAllWith=hm,v.pullAt=lm,v.range=Tv,v.rangeRight=Av,v.rearg=xy,v.reject=fy,v.remove=fm,v.rest=Py,v.reverse=ec,v.sampleSize=py,v.set=R0,v.setWith=C0,v.shuffle=gy,v.slice=dm,v.sortBy=vy,v.sortedUniq=bm,v.sortedUniqBy=_m,v.split=tv,v.spread=Oy,v.tail=Em,v.take=Im,v.takeRight=Sm,v.takeRightWhile=xm,v.takeWhile=Pm,v.tap=Fm,v.throttle=Ny,v.thru=sa,v.toArray=Zh,v.toPairs=nl,v.toPairsIn=sl,v.toPath=Uv,v.toPlainObject=el,v.transform=$0,v.unary=Ty,v.union=Om,v.unionBy=Nm,v.unionWith=Tm,v.uniq=Am,v.uniqBy=Rm,v.uniqWith=Cm,v.unset=D0,v.unzip=tc,v.unzipWith=Lh,v.update=U0,v.updateWith=j0,v.values=gn,v.valuesIn=L0,v.without=$m,v.words=cl,v.wrap=Ay,v.xor=Dm,v.xorBy=Um,v.xorWith=jm,v.zip=Lm,v.zipObject=qm,v.zipObjectDeep=Mm,v.zipWith=zm,v.entries=nl,v.entriesIn=sl,v.extend=tl,v.extendWith=fa,lc(v,v),v.add=Lv,v.attempt=ul,v.camelCase=F0,v.capitalize=al,v.ceil=qv,v.clamp=q0,v.clone=Cy,v.cloneDeep=Dy,v.cloneDeepWith=Uy,v.cloneWith=$y,v.conformsTo=jy,v.deburr=ol,v.defaultTo=mv,v.divide=Mv,v.endsWith=H0,v.eq=jr,v.escape=k0,v.escapeRegExp=K0,v.every=Ym,v.find=Xm,v.findIndex=Ch,v.findKey=f0,v.findLast=ey,v.findLastIndex=$h,v.findLastKey=d0,v.floor=zv,v.forEach=Mh,v.forEachRight=zh,v.forIn=p0,v.forInRight=g0,v.forOwn=m0,v.forOwnRight=y0,v.get=ac,v.gt=Ly,v.gte=qy,v.has=b0,v.hasIn=oc,v.head=Uh,v.identity=lr,v.includes=sy,v.indexOf=em,v.inRange=M0,v.invoke=I0,v.isArguments=Fi,v.isArray=me,v.isArrayBuffer=My,v.isArrayLike=ur,v.isArrayLikeObject=Et,v.isBoolean=zy,v.isBuffer=Ii,v.isDate=Fy,v.isElement=Hy,v.isEmpty=ky,v.isEqual=Ky,v.isEqualWith=Vy,v.isError=nc,v.isFinite=By,v.isFunction=si,v.isInteger=Wh,v.isLength=ha,v.isMap=Qh,v.isMatch=Gy,v.isMatchWith=Wy,v.isNaN=Qy,v.isNative=Jy,v.isNil=Zy,v.isNull=Yy,v.isNumber=Jh,v.isObject=ut,v.isObjectLike=vt,v.isPlainObject=Fn,v.isRegExp=sc,v.isSafeInteger=Xy,v.isSet=Yh,v.isString=la,v.isSymbol=yr,v.isTypedArray=pn,v.isUndefined=e0,v.isWeakMap=t0,v.isWeakSet=r0,v.join=sm,v.kebabCase=V0,v.last=Nr,v.lastIndexOf=am,v.lowerCase=B0,v.lowerFirst=G0,v.lt=i0,v.lte=n0,v.max=Fv,v.maxBy=Hv,v.mean=kv,v.meanBy=Kv,v.min=Vv,v.minBy=Bv,v.stubArray=dc,v.stubFalse=pc,v.stubObject=Rv,v.stubString=Cv,v.stubTrue=$v,v.multiply=Gv,v.nth=om,v.noConflict=Iv,v.noop=fc,v.now=oa,v.pad=W0,v.padEnd=Q0,v.padStart=J0,v.parseInt=Y0,v.random=z0,v.reduce=hy,v.reduceRight=ly,v.repeat=Z0,v.replace=X0,v.result=A0,v.round=Wv,v.runInContext=C,v.sample=dy,v.size=my,v.snakeCase=ev,v.some=yy,v.sortedIndex=pm,v.sortedIndexBy=gm,v.sortedIndexOf=mm,v.sortedLastIndex=ym,v.sortedLastIndexBy=vm,v.sortedLastIndexOf=wm,v.startCase=rv,v.startsWith=iv,v.subtract=Qv,v.sum=Jv,v.sumBy=Yv,v.template=nv,v.times=Dv,v.toFinite=ai,v.toInteger=ye,v.toLength=Xh,v.toLower=sv,v.toNumber=Tr,v.toSafeInteger=s0,v.toString=je,v.toUpper=av,v.trim=ov,v.trimEnd=cv,v.trimStart=uv,v.truncate=hv,v.unescape=lv,v.uniqueId=jv,v.upperCase=fv,v.upperFirst=cc,v.each=Mh,v.eachRight=zh,v.first=Uh,lc(v,function(){var e={};return Vr(v,function(i,a){qe.call(v.prototype,a)||(e[a]=i)}),e}(),{chain:!1}),v.VERSION=n,Ir(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){v[e].placeholder=v}),Ir(["drop","take"],function(e,i){xe.prototype[e]=function(a){a=a===r?1:jt(ye(a),0);var c=this.__filtered__&&!i?new xe(this):this.clone();return c.__filtered__?c.__takeCount__=Bt(a,c.__takeCount__):c.__views__.push({size:Bt(a,Z),type:e+(c.__dir__<0?"Right":"")}),c},xe.prototype[e+"Right"]=function(a){return this.reverse()[e](a).reverse()}}),Ir(["filter","map","takeWhile"],function(e,i){var a=i+1,c=a==L||a==Me;xe.prototype[e]=function(f){var w=this.clone();return w.__iteratees__.push({iteratee:ue(f,3),type:a}),w.__filtered__=w.__filtered__||c,w}}),Ir(["head","last"],function(e,i){var a="take"+(i?"Right":"");xe.prototype[e]=function(){return this[a](1).value()[0]}}),Ir(["initial","tail"],function(e,i){var a="drop"+(i?"":"Right");xe.prototype[e]=function(){return this.__filtered__?new xe(this):this[a](1)}}),xe.prototype.compact=function(){return this.filter(lr)},xe.prototype.find=function(e){return this.filter(e).head()},xe.prototype.findLast=function(e){return this.reverse().find(e)},xe.prototype.invokeMap=_e(function(e,i){return typeof e=="function"?new xe(this):this.map(function(a){return Un(a,e,i)})}),xe.prototype.reject=function(e){return this.filter(ua(ue(e)))},xe.prototype.slice=function(e,i){e=ye(e);var a=this;return a.__filtered__&&(e>0||i<0)?new xe(a):(e<0?a=a.takeRight(-e):e&&(a=a.drop(e)),i!==r&&(i=ye(i),a=i<0?a.dropRight(-i):a.take(i-e)),a)},xe.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},xe.prototype.toArray=function(){return this.take(Z)},Vr(xe.prototype,function(e,i){var a=/^(?:filter|find|map|reject)|While$/.test(i),c=/^(?:head|last)$/.test(i),f=v[c?"take"+(i=="last"?"Right":""):i],w=c||/^find/.test(i);f&&(v.prototype[i]=function(){var S=this.__wrapped__,T=c?[1]:arguments,$=S instanceof xe,k=T[0],K=$||me(S),G=function(Ie){var Oe=f.apply(v,mi([Ie],T));return c&&X?Oe[0]:Oe};K&&a&&typeof k=="function"&&k.length!=1&&($=K=!1);var X=this.__chain__,oe=!!this.__actions__.length,he=w&&!X,we=$&&!oe;if(!w&&K){S=we?S:new xe(this);var le=e.apply(S,T);return le.__actions__.push({func:sa,args:[G],thisArg:r}),new xr(le,X)}return he&&we?e.apply(this,T):(le=this.thru(G),he?c?le.value()[0]:le.value():le)})}),Ir(["pop","push","shift","sort","splice","unshift"],function(e){var i=Rs[e],a=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",c=/^(?:pop|shift)$/.test(e);v.prototype[e]=function(){var f=arguments;if(c&&!this.__chain__){var w=this.value();return i.apply(me(w)?w:[],f)}return this[a](function(S){return i.apply(me(S)?S:[],f)})}}),Vr(xe.prototype,function(e,i){var a=v[i];if(a){var c=a.name+"";qe.call(un,c)||(un[c]=[]),un[c].push({name:i,func:a})}}),un[Zs(r,ce).name]=[{name:"wrapper",func:r}],xe.prototype.clone=lp,xe.prototype.reverse=fp,xe.prototype.value=dp,v.prototype.at=Hm,v.prototype.chain=km,v.prototype.commit=Km,v.prototype.next=Vm,v.prototype.plant=Gm,v.prototype.reverse=Wm,v.prototype.toJSON=v.prototype.valueOf=v.prototype.value=Qm,v.prototype.first=v.prototype.head,Nn&&(v.prototype[Nn]=Bm),v},an=Kd();_t?((_t.exports=an)._=an,Ge._=an):Pe._=an}).call(Qn)})(Gc,Gc.exports);var dS=Object.defineProperty,pS=Object.defineProperties,gS=Object.getOwnPropertyDescriptors,vf=Object.getOwnPropertySymbols,mS=Object.prototype.hasOwnProperty,yS=Object.prototype.propertyIsEnumerable,wf=(s,t,r)=>t in s?dS(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,va=(s,t)=>{for(var r in t||(t={}))mS.call(t,r)&&wf(s,r,t[r]);if(vf)for(var r of vf(t))yS.call(t,r)&&wf(s,r,t[r]);return s},vS=(s,t)=>pS(s,gS(t));function Pi(s,t,r){var n;const o=aS(s);return((n=t.rpcMap)==null?void 0:n[o.reference])||`${fS}?chainId=${o.namespace}:${o.reference}&projectId=${r}`}function Wi(s){return s.includes(":")?s.split(":")[1]:s}function wd(s){return s.map(t=>`${t.split(":")[0]}:${t.split(":")[1]}`)}function wS(s,t){const r=Object.keys(t.namespaces).filter(o=>o.includes(s));if(!r.length)return[];const n=[];return r.forEach(o=>{const l=t.namespaces[o].accounts;n.push(...l)}),n}function bS(s={},t={}){const r=bf(s),n=bf(t);return Gc.exports.merge(r,n)}function bf(s){var t,r,n,o;const l={};if(!cS(s))return l;for(const[y,b]of Object.entries(s)){const P=hu(y)?[y]:b.chains,_=b.methods||[],E=b.events||[],O=b.rpcMap||{},U=Zn(y);l[U]=vS(va(va({},l[U]),b),{chains:Rc(P,(t=l[U])==null?void 0:t.chains),methods:Rc(_,(r=l[U])==null?void 0:r.methods),events:Rc(E,(n=l[U])==null?void 0:n.events),rpcMap:va(va({},O),(o=l[U])==null?void 0:o.rpcMap)})}return l}function _S(s){return s.includes(":")?s.split(":")[2]:s}function ES(s){const t={};for(const[r,n]of Object.entries(s)){const o=n.methods||[],l=n.events||[],y=n.accounts||[],b=hu(r)?[r]:n.chains?n.chains:wd(n.accounts);t[r]={chains:b,methods:o,events:l,accounts:y}}return t}function Cc(s){return typeof s=="number"?s:s.includes("0x")?parseInt(s,16):s.includes(":")?Number(s.split(":")[1]):Number(s)}const bd={},st=s=>bd[s],$c=(s,t)=>{bd[s]=t};class IS{constructor(t){this.name="polkadot",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(fi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const o=Wi(r);t[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||Pi(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new li(new Oi(n,st("disableProviderPing")))}}class SS{constructor(t){this.name="eip155",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(t){switch(t.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(t);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(t.request.method)?await this.client.request(t):this.getHttpProvider().request(t.request)}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(parseInt(t),r),this.chainId=parseInt(t),this.events.emit(fi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}createHttpProvider(t,r){const n=r||Pi(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new li(new Oi(n,st("disableProviderPing")))}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const o=parseInt(Wi(r));t[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const t=this.chainId,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}async handleSwitchChain(t){var r,n;let o=t.request.params?(r=t.request.params[0])==null?void 0:r.chainId:"0x0";o=o.startsWith("0x")?o:`0x${o}`;const l=parseInt(o,16);if(this.isChainApproved(l))this.setDefaultChain(`${l}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:t.topic,request:{method:t.request.method,params:[{chainId:o}]},chainId:(n=this.namespace.chains)==null?void 0:n[0]}),this.setDefaultChain(`${l}`);else throw new Error(`Failed to switch to chain 'eip155:${l}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(t){return this.namespace.chains.includes(`${this.name}:${t}`)}}class xS{constructor(t){this.name="solana",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(fi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const o=Wi(r);t[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||Pi(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new li(new Oi(n,st("disableProviderPing")))}}class PS{constructor(t){this.name="cosmos",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(fi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const o=Wi(r);t[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||Pi(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new li(new Oi(n,st("disableProviderPing")))}}class OS{constructor(t){this.name="cip34",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(fi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{const n=this.getCardanoRPCUrl(r),o=Wi(r);t[o]=this.createHttpProvider(o,n)}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}getCardanoRPCUrl(t){const r=this.namespace.rpcMap;if(r)return r[t]}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||this.getCardanoRPCUrl(t);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new li(new Oi(n,st("disableProviderPing")))}}class NS{constructor(t){this.name="elrond",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(fi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const o=Wi(r);t[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||Pi(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new li(new Oi(n,st("disableProviderPing")))}}class TS{constructor(t){this.name="multiversx",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(fi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const o=Wi(r);t[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||Pi(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new li(new Oi(n,st("disableProviderPing")))}}class AS{constructor(t){this.name="near",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(this.chainId=t,!this.httpProviders[t]){const n=r||Pi(`${this.name}:${t}`,this.namespace);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,n)}this.events.emit(fi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;t[r]=this.createHttpProvider(r,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||Pi(t,this.namespace);return typeof n>"u"?void 0:new li(new Oi(n,st("disableProviderPing")))}}var RS=Object.defineProperty,CS=Object.defineProperties,$S=Object.getOwnPropertyDescriptors,_f=Object.getOwnPropertySymbols,DS=Object.prototype.hasOwnProperty,US=Object.prototype.propertyIsEnumerable,Ef=(s,t,r)=>t in s?RS(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,wa=(s,t)=>{for(var r in t||(t={}))DS.call(t,r)&&Ef(s,r,t[r]);if(_f)for(var r of _f(t))US.call(t,r)&&Ef(s,r,t[r]);return s},Dc=(s,t)=>CS(s,$S(t));class lu{constructor(t){this.events=new Jc,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=t,this.logger=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Ne.pino(Ne.getDefaultLoggerOptions({level:(t==null?void 0:t.logger)||mf})),this.disableProviderPing=(t==null?void 0:t.disableProviderPing)||!1}static async init(t){const r=new lu(t);return await r.initialize(),r}async request(t,r){const[n,o]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(n).request({request:wa({},t),chainId:`${n}:${o}`,topic:this.session.topic})}sendAsync(t,r,n){this.request(t,n).then(o=>r(null,o)).catch(o=>r(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var t;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(t=this.session)==null?void 0:t.topic,reason:pf("USER_DISCONNECTED")}),await this.cleanup()}async connect(t){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(t),await this.cleanupPendingPairings(),!t.skipPairing)return await this.pair(t.pairingTopic)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}removeListener(t,r){this.events.removeListener(t,r)}off(t,r){this.events.off(t,r)}get isWalletConnect(){return!0}async pair(t){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:n,approval:o}=await this.client.connect({pairingTopic:t,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});n&&(this.uri=n,this.events.emit("display_uri",n)),await o().then(l=>{this.session=l,this.namespaces||(this.namespaces=ES(l.namespaces),this.persist("namespaces",this.namespaces))}).catch(l=>{if(l.message!==yd)throw l;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(t,r){try{if(!this.session)return;const[n,o]=this.validateChain(t);this.getProvider(n).setDefaultChain(o,r)}catch(n){if(!/Please call connect/.test(n.message))throw n}}async cleanupPendingPairings(t={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(gf(r)){for(const n of r)t.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const t=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[t]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await iS.init({logger:this.providerOpts.logger||mf,relayUrl:this.providerOpts.relayUrl||uS,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const t=[...new Set(Object.keys(this.session.namespaces).map(r=>Zn(r)))];$c("client",this.client),$c("events",this.events),$c("disableProviderPing",this.disableProviderPing),t.forEach(r=>{if(!this.session)return;const n=wS(r,this.session),o=wd(n),l=bS(this.namespaces,this.optionalNamespaces),y=Dc(wa({},l[r]),{accounts:n,chains:o});switch(r){case"eip155":this.rpcProviders[r]=new SS({namespace:y});break;case"solana":this.rpcProviders[r]=new xS({namespace:y});break;case"cosmos":this.rpcProviders[r]=new PS({namespace:y});break;case"polkadot":this.rpcProviders[r]=new IS({namespace:y});break;case"cip34":this.rpcProviders[r]=new OS({namespace:y});break;case"elrond":this.rpcProviders[r]=new NS({namespace:y});break;case"multiversx":this.rpcProviders[r]=new TS({namespace:y});break;case"near":this.rpcProviders[r]=new AS({namespace:y});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",t=>{this.events.emit("session_ping",t)}),this.client.on("session_event",t=>{const{params:r}=t,{event:n}=r;if(n.name==="accountsChanged"){const o=n.data;o&&gf(o)&&this.events.emit("accountsChanged",o.map(_S))}else if(n.name==="chainChanged"){const o=r.chainId,l=r.event.data,y=Zn(o),b=Cc(o)!==Cc(l)?`${y}:${Cc(l)}`:o;this.onChainChanged(b)}else this.events.emit(n.name,n.data);this.events.emit("session_event",t)}),this.client.on("session_update",({topic:t,params:r})=>{var n;const{namespaces:o}=r,l=(n=this.client)==null?void 0:n.session.get(t);this.session=Dc(wa({},l),{namespaces:o}),this.onSessionUpdate(),this.events.emit("session_update",{topic:t,params:r})}),this.client.on("session_delete",async t=>{await this.cleanup(),this.events.emit("session_delete",t),this.events.emit("disconnect",Dc(wa({},pf("USER_DISCONNECTED")),{data:t.topic}))}),this.on(fi.DEFAULT_CHAIN_CHANGED,t=>{this.onChainChanged(t,!0)})}getProvider(t){if(!this.rpcProviders[t])throw new Error(`Provider not found: ${t}`);return this.rpcProviders[t]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(t=>{var r;this.getProvider(t).updateNamespace((r=this.session)==null?void 0:r.namespaces[t])})}setNamespaces(t){const{namespaces:r,optionalNamespaces:n,sessionProperties:o}=t;r&&Object.keys(r).length&&(this.namespaces=r),n&&Object.keys(n).length&&(this.optionalNamespaces=n),this.sessionProperties=o,this.persist("namespaces",r),this.persist("optionalNamespaces",n)}validateChain(t){const[r,n]=(t==null?void 0:t.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,n];if(r&&!Object.keys(this.namespaces||{}).map(y=>Zn(y)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&n)return[r,n];const o=Zn(Object.keys(this.namespaces)[0]),l=this.rpcProviders[o].getDefaultChain();return[o,l]}async requestAccounts(){const[t]=this.validateChain();return await this.getProvider(t).requestAccounts()}onChainChanged(t,r=!1){var n;if(!this.namespaces)return;const[o,l]=this.validateChain(t);r||this.getProvider(o).setDefaultChain(l),((n=this.namespaces[o])!=null?n:this.namespaces[`${o}:${l}`]).defaultChain=l,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",l)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(t,r){this.client.core.storage.setItem(`${yf}/${t}`,r)}async getFromStore(t){return await this.client.core.storage.getItem(`${yf}/${t}`)}}const jS=lu,LS="wc",qS="ethereum_provider",MS=`${LS}@2:${qS}:`,zS="https://rpc.walletconnect.com/v1/",Wc=["eth_sendTransaction","personal_sign"],FS=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],Qc=["chainChanged","accountsChanged"],HS=["chainChanged","accountsChanged","message","disconnect","connect"];var kS=Object.defineProperty,KS=Object.defineProperties,VS=Object.getOwnPropertyDescriptors,If=Object.getOwnPropertySymbols,BS=Object.prototype.hasOwnProperty,GS=Object.prototype.propertyIsEnumerable,Sf=(s,t,r)=>t in s?kS(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,Xn=(s,t)=>{for(var r in t||(t={}))BS.call(t,r)&&Sf(s,r,t[r]);if(If)for(var r of If(t))GS.call(t,r)&&Sf(s,r,t[r]);return s},xf=(s,t)=>KS(s,VS(t));function Aa(s){return Number(s[0].split(":")[1])}function Uc(s){return`0x${s.toString(16)}`}function WS(s){const{chains:t,optionalChains:r,methods:n,optionalMethods:o,events:l,optionalEvents:y,rpcMap:b}=s;if(!Lc(t))throw new Error("Invalid chains");const P={chains:t,methods:n||Wc,events:l||Qc,rpcMap:Xn({},t.length?{[Aa(t)]:b[Aa(t)]}:{})},_=l==null?void 0:l.filter(H=>!Qc.includes(H)),E=n==null?void 0:n.filter(H=>!Wc.includes(H));if(!r&&!y&&!o&&!(_!=null&&_.length)&&!(E!=null&&E.length))return{required:t.length?P:void 0};const O=(_==null?void 0:_.length)&&(E==null?void 0:E.length)||!r,U={chains:[...new Set(O?P.chains.concat(r||[]):r)],methods:[...new Set(P.methods.concat(o!=null&&o.length?o:FS))],events:[...new Set(P.events.concat(y!=null&&y.length?y:HS))],rpcMap:b};return{required:t.length?P:void 0,optional:r.length?U:void 0}}class fu{constructor(){this.events=new Qr.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=MS,this.on=(t,r)=>(this.events.on(t,r),this),this.once=(t,r)=>(this.events.once(t,r),this),this.removeListener=(t,r)=>(this.events.removeListener(t,r),this),this.off=(t,r)=>(this.events.off(t,r),this),this.parseAccount=t=>this.isCompatibleChainId(t)?this.parseAccountId(t).address:t,this.signer={},this.rpc={}}static async init(t){const r=new fu;return await r.initialize(t),r}async request(t){return await this.signer.request(t,this.formatChainId(this.chainId))}sendAsync(t,r){this.signer.sendAsync(t,r,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(t){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(t);const{required:r,optional:n}=WS(this.rpc);try{const o=await new Promise(async(y,b)=>{var P;this.rpc.showQrModal&&((P=this.modal)==null||P.subscribeModal(_=>{!_.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),b(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(xf(Xn({namespaces:Xn({},r&&{[this.namespace]:r})},n&&{optionalNamespaces:{[this.namespace]:n}}),{pairingTopic:t==null?void 0:t.pairingTopic})).then(_=>{y(_)}).catch(_=>{b(new Error(_.message))})});if(!o)return;const l=Iw(o.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:l),this.setAccounts(l),this.events.emit("connect",{chainId:Uc(this.chainId)})}catch(o){throw this.signer.logger.error(o),o}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",t=>{const{params:r}=t,{event:n}=r;n.name==="accountsChanged"?(this.accounts=this.parseAccounts(n.data),this.events.emit("accountsChanged",this.accounts)):n.name==="chainChanged"?this.setChainId(this.formatChainId(n.data)):this.events.emit(n.name,n.data),this.events.emit("session_event",t)}),this.signer.on("chainChanged",t=>{const r=parseInt(t);this.chainId=r,this.events.emit("chainChanged",Uc(this.chainId)),this.persist()}),this.signer.on("session_update",t=>{this.events.emit("session_update",t)}),this.signer.on("session_delete",t=>{this.reset(),this.events.emit("session_delete",t),this.events.emit("disconnect",xf(Xn({},xw("USER_DISCONNECTED")),{data:t.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",t=>{var r,n;this.rpc.showQrModal&&((r=this.modal)==null||r.closeModal(),(n=this.modal)==null||n.openModal({uri:t})),this.events.emit("display_uri",t)})}switchEthereumChain(t){this.request({method:"wallet_switchEthereumChain",params:[{chainId:t.toString(16)}]})}isCompatibleChainId(t){return typeof t=="string"?t.startsWith(`${this.namespace}:`):!1}formatChainId(t){return`${this.namespace}:${t}`}parseChainId(t){return Number(t.split(":")[1])}setChainIds(t){const r=t.filter(n=>this.isCompatibleChainId(n)).map(n=>this.parseChainId(n));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",Uc(this.chainId)),this.persist())}setChainId(t){if(this.isCompatibleChainId(t)){const r=this.parseChainId(t);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(t){const[r,n,o]=t.split(":");return{chainId:`${r}:${n}`,address:o}}setAccounts(t){this.accounts=t.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(t){var r,n;const o=(r=t==null?void 0:t.chains)!=null?r:[],l=(n=t==null?void 0:t.optionalChains)!=null?n:[],y=o.concat(l);if(!y.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const b=o.length?(t==null?void 0:t.methods)||Wc:[],P=o.length?(t==null?void 0:t.events)||Qc:[],_=(t==null?void 0:t.optionalMethods)||[],E=(t==null?void 0:t.optionalEvents)||[],O=(t==null?void 0:t.rpcMap)||this.buildRpcMap(y,t.projectId),U=(t==null?void 0:t.qrModalOptions)||void 0;return{chains:o==null?void 0:o.map(H=>this.formatChainId(H)),optionalChains:l.map(H=>this.formatChainId(H)),methods:b,events:P,optionalMethods:_,optionalEvents:E,rpcMap:O,showQrModal:!!(t!=null&&t.showQrModal),qrModalOptions:U,projectId:t.projectId,metadata:t.metadata}}buildRpcMap(t,r){const n={};return t.forEach(o=>{n[o]=this.getRpcUrl(o,r)}),n}async initialize(t){if(this.rpc=this.getRpcConfig(t),this.chainId=this.rpc.chains.length?Aa(this.rpc.chains):Aa(this.rpc.optionalChains),this.signer=await jS.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:t.disableProviderPing,relayUrl:t.relayUrl,storageOptions:t.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const{WalletConnectModal:n}=await pw(()=>import("./index-cyPAkukG.js").then(o=>o.i),__vite__mapDeps([0,1,2]));r=n}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(r)try{this.modal=new r(Xn({walletConnectVersion:2,projectId:this.rpc.projectId,standaloneChains:this.rpc.chains},this.rpc.qrModalOptions))}catch(n){throw this.signer.logger.error(n),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(t){if(!t)return;const{chains:r,optionalChains:n,rpcMap:o}=t;r&&Lc(r)&&(this.rpc.chains=r.map(l=>this.formatChainId(l)),r.forEach(l=>{this.rpc.rpcMap[l]=(o==null?void 0:o[l])||this.getRpcUrl(l)})),n&&Lc(n)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=n==null?void 0:n.map(l=>this.formatChainId(l)),n.forEach(l=>{this.rpc.rpcMap[l]=(o==null?void 0:o[l])||this.getRpcUrl(l)}))}getRpcUrl(t,r){var n;return((n=this.rpc.rpcMap)==null?void 0:n[t])||`${zS}?chainId=eip155:${t}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const t=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${t}`]?this.session.namespaces[`${this.namespace}:${t}`]:this.session.namespaces[this.namespace];this.setChainIds(t?[this.formatChainId(t)]:r==null?void 0:r.accounts),this.setAccounts(r==null?void 0:r.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(t){return typeof t=="string"||t instanceof String?[this.parseAccount(t)]:t.map(r=>this.parseAccount(r))}}const px=fu;export{px as EthereumProvider,HS as OPTIONAL_EVENTS,FS as OPTIONAL_METHODS,Qc as REQUIRED_EVENTS,Wc as REQUIRED_METHODS,fu as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/index-cyPAkukG.js","assets/index-vBIxONE0.js","assets/index-MoPkJ8az.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}